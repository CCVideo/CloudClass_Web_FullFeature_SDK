!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=e()}}(function(){return function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return r(n||e)},u,u.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){"use strict";var i={};i.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},i.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},i.matchPrefix=function(e,t){return i.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},i.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1]}return n},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},i.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},i.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach(function(t){i.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},i.getDtlsParameters=function(e,t){var n=i.splitLines(e),r=(n=n.concat(i.splitLines(t))).filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:r.split(" ")[0],value:r.split(" ")[1]}]}},i.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},i.getIceParameters=function(e,t){var n=i.splitLines(e);return{usernameFragment:(n=n.concat(i.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var o=n[r],a=i.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=i.parseRtpMap(a),c=i.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?i.parseFmtp(c[0]):{},s.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(i.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(i.parseExtmap(e))}),t},i.writeRtpDescription=function(e,t){var n="";return n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=i.writeRtpMap(e),n+=i.writeFmtp(e),n+=i.writeRtcpFb(e)}),n+="a=rtcp-mux\r\n"},i.parseRtpEncodingParameters=function(e){var t,n=[],r=i.parseRtpParameters(e),o=-1!==r.fecMechanisms.indexOf("RED"),a=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=i.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),r.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{payloadType:e.payloadType,ssrc:t}};n.push(i),o&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(i))}}),0===n.length&&c&&n.push({ssrc:c});var u=i.matchPrefix(e,"b=");return u.length&&(0===u[0].indexOf("b=TIAS:")?u=parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")&&(u=parseInt(u[0].substr(5),10)),n.forEach(function(e){e.maxBitrate=u})),n},i.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,n,r){var o=i.writeRtpDescription(e.kind,t);if(o+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n"},i.getDirection=function(e,t){for(var n=i.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?i.getDirection(t):"sendrecv"},t.exports=i},{}],2:[function(e,t,n){"use strict";!function(){var n=e("./utils").log,i=e("./utils").browserDetails;t.exports.browserDetails=i,t.exports.extractVersion=e("./utils").extractVersion,t.exports.disableLog=e("./utils").disableLog;var r=e("./chrome/chrome_shim")||null,o=e("./edge/edge_shim")||null,a=e("./firefox/firefox_shim")||null,s=e("./safari/safari_shim")||null;switch(i.browser){case"opera":case"chrome":if(!r||!r.shimPeerConnection)return void n("Chrome shim is not included in this adapter release.");n("adapter.js shimming chrome."),t.exports.browserShim=r,r.shimGetUserMedia(),r.shimMediaStream(),r.shimSourceObject(),r.shimPeerConnection(),r.shimOnTrack();break;case"firefox":if(!a||!a.shimPeerConnection)return void n("Firefox shim is not included in this adapter release.");n("adapter.js shimming firefox."),t.exports.browserShim=a,a.shimGetUserMedia(),a.shimSourceObject(),a.shimPeerConnection(),a.shimOnTrack();break;case"edge":if(!o||!o.shimPeerConnection)return void n("MS edge shim is not included in this adapter release.");n("adapter.js shimming edge."),t.exports.browserShim=o,o.shimGetUserMedia(),o.shimPeerConnection();break;case"safari":if(!s)return void n("Safari shim is not included in this adapter release.");n("adapter.js shimming safari."),t.exports.browserShim=s,s.shimGetUserMedia();break;default:n("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(e,t,n){"use strict";var i=e("../utils.js").log,r=e("../utils.js").browserDetails,o={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(n){var i=new Event("track");i.track=n.track,i.receiver={track:n.track},i.streams=[e.stream],t.dispatchEvent(i)}),e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):this.src=""}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(e,t){i("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new webkitRTCPeerConnection(e,t),r=n.getStats.bind(n);return n.getStats=function(e,t,n){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return r(e,t);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e,t){var n=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return t=t||e,Object.keys(t).forEach(function(e){n[e]=t[e]}),n};if(arguments.length>=2){return r.apply(this,[function(e){o[1](s(a(e)))},arguments[0]])}return new Promise(function(t,n){1===o.length&&"object"==typeof e?r.apply(i,[function(e){t(s(a(e)))},n]):r.apply(i,[function(e){t(s(a(e),e.result()))},n])}).then(t,n)},n},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),r.version<51&&(["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(i,r){t.apply(e,[i,r,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this,i=new Promise(function(i,r){t.apply(n,[e[0],i,r])});return e.length<2?i:i.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}));var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)},["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}})},attachMediaStream:function(e,t){i("DEPRECATED, attachMediaStream will soon be removed."),r.version>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):i("Error attaching stream to element.")},reattachMediaStream:function(e,t){i("DEPRECATED, reattachMediaStream will soon be removed."),r.version>=43?e.srcObject=t.srcObject:e.src=t.src}};t.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:o.attachMediaStream,reattachMediaStream:o.reattachMediaStream}},{"../utils.js":10,"./getusermedia":4}],4:[function(e,t,n){"use strict";var i=e("../utils.js").log,r=e("../utils.js").browserDetails;t.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};if("number"==typeof i.ideal){r.version;a[o("min",n)]=i.ideal,t.optional.push(a),(a={})[o("max",n)]=i.ideal,t.optional.push(a)}else a[o("",n)]=i.ideal,t.optional.push(a)}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,n){if((t=JSON.parse(JSON.stringify(t)))&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var r=t.video.facingMode;if((r=r&&("object"==typeof r?r:{ideal:r}))&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete t.video.facingMode,"environment"===r.exact||"environment"===r.ideal))return navigator.mediaDevices.enumerateDevices().then(function(o){var a=(o=o.filter(function(e){return"videoinput"===e.kind})).find(function(e){return-1!==e.label.toLowerCase().indexOf("back")})||o.length&&o[o.length-1];return a&&(t.video.deviceId=r.exact?{exact:a.deviceId}:{ideal:a.deviceId}),t.video=e(t.video),i("chrome: "+JSON.stringify(t)),n(t)});t.video=e(t.video)}return i("chrome: "+JSON.stringify(t)),n(t)},n=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};navigator.getUserMedia=function(e,i,r){t(e,function(e){navigator.webkitGetUserMedia(e,i,function(e){r(n(e))})})};var o=function(e){return new Promise(function(t,n){navigator.getUserMedia(e,t,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:o,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var a=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return a(e).catch(function(e){return Promise.reject(n(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return o(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(e,t,n){"use strict";var i=e("sdp"),r=e("../utils").log,o={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e})),window.RTCPeerConnection=function(e){var t=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers&&(this.iceOptions.iceServers=e.iceServers.filter(function(e){return!(!e||!e.urls)&&(e.urls=e.urls.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")})[0],!!e.urls)})),this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=i.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){if(!n.candidate||0===Object.keys(n.candidate).length)for(var i=1;i<t.length;i++)-1===t[i].indexOf("\r\na=end-of-candidates\r\n")&&(t[i]+="a=end-of-candidates\r\n");else-1===n.candidate.candidate.indexOf("typ endOfCandidates")&&(t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n");e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),n.candidate||"complete"===e.iceGatheringState||e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&(e.iceGatheringState="complete")}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var i=0;i<t.codecs.length;i++){var r=t.codecs[i];if(e.name.toLowerCase()===r.name.toLowerCase()&&e.clockRate===r.clockRate&&e.numChannels===r.numChannels){n.codecs.push(r);break}}}),e.headerExtensions.forEach(function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}}),n},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var n=this,r=new RTCIceGatherer(n.iceOptions),o=new RTCIceTransport(r);r.onlocalcandidate=function(a){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:t};var c=a.candidate,d=!c||0===Object.keys(c).length;d?(void 0===r.state&&(r.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(c.component="RTCP"===o.component?2:1,s.candidate.candidate=i.writeCandidate(c));var u=i.splitSections(n.localDescription.sdp);-1===s.candidate.candidate.indexOf("typ endOfCandidates")?u[s.candidate.sdpMLineIndex+1]+="a="+s.candidate.candidate+"\r\n":u[s.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",n.localDescription.sdp=u.join("");var l=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(n.iceGatheringState){case"new":n._localIceCandidatesBuffer.push(s),d&&l&&n._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":n._emitBufferedCandidates(),n.dispatchEvent(s),null!==n.onicecandidate&&n.onicecandidate(s),l&&(n.dispatchEvent(new Event("icecandidate")),null!==n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete")}},o.onicestatechange=function(){n._updateConnectionState()};var a=new RTCDtlsTransport(o);return a.ondtlsstatechange=function(){n._updateConnectionState()},a.onerror=function(){a.state="failed",n._updateConnectionState()},{iceGatherer:r,iceTransport:o,dtlsTransport:a}},window.RTCPeerConnection.prototype._transceive=function(e,t,n){var r=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={cname:i.localCName},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),n&&e.rtpReceiver&&(r.encodings=e.recvEncodingParameters,r.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t,n,r=this;if("offer"===e.type)this._pendingOffer&&(t=i.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=i.parseRtpParameters(e);r._pendingOffer[t].localCapabilities=n}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=i.splitSections(r.remoteDescription.sdp),n=t.shift();var o=i.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var a=r.transceivers[t],s=a.iceGatherer,c=a.iceTransport,d=a.dtlsTransport,u=a.localCapabilities,l=a.remoteCapabilities;if(!("0"===e.split("\n",1)[0].split(" ",2)[1])){var p=i.getIceParameters(e,n);if(o){var f=i.matchPrefix(e,"a=candidate:").map(function(e){return i.parseCandidate(e)}).filter(function(e){return"1"===e.component});f.length&&c.setRemoteCandidates(f)}var h=i.getDtlsParameters(e,n);o&&(h.role="server"),r.usingBundle&&0!==t||(c.start(s,p,o?"controlling":"controlled"),d.start(h));var m=r._getCommonCapabilities(u,l);r._transceive(a,m.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var a=arguments.length>1&&"function"==typeof arguments[1];if(a){var s=arguments[1];window.setTimeout(function(){s(),"new"===r.iceGatheringState&&(r.iceGatheringState="gathering"),r._emitBufferedCandidates()},0)}var c=Promise.resolve();return c.then(function(){a||("new"===r.iceGatheringState&&(r.iceGatheringState="gathering"),window.setTimeout(r._emitBufferedCandidates.bind(r),500))}),c},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,n=new MediaStream,r=[],o=i.splitSections(e.sdp),a=o.shift(),s=i.matchPrefix(a,"a=ice-lite").length>0;switch(this.usingBundle=i.matchPrefix(a,"a=group:BUNDLE ").length>0,o.forEach(function(o,c){var d,u,l,p,f,h,m,g,v,y,b,S,C=i.splitLines(o)[0].substr(2).split(" "),w=C[0],k="0"===C[1],E=i.getDirection(o,a),T=i.parseRtpParameters(o);k||(b=i.getIceParameters(o,a),(S=i.getDtlsParameters(o,a)).role="client"),g=i.parseRtpEncodingParameters(o);var A=i.matchPrefix(o,"a=mid:");A=A.length?A[0].substr(6):i.generateIdentifier();var R,_=i.matchPrefix(o,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];_&&(R=_.value);var x=i.matchPrefix(o,"a=end-of-candidates").length>0,P=i.matchPrefix(o,"a=candidate:").map(function(e){return i.parseCandidate(e)}).filter(function(e){return"1"===e.component});if("offer"!==e.type||k)"answer"!==e.type||k||(u=(d=t.transceivers[c]).iceGatherer,l=d.iceTransport,p=d.dtlsTransport,f=d.rtpSender,h=d.rtpReceiver,m=d.sendEncodingParameters,v=d.localCapabilities,t.transceivers[c].recvEncodingParameters=g,t.transceivers[c].remoteCapabilities=T,t.transceivers[c].cname=R,(s||x)&&P.length&&l.setRemoteCandidates(P),t.usingBundle&&0!==c||(l.start(u,b,"controlling"),p.start(S)),t._transceive(d,"sendrecv"===E||"recvonly"===E,"sendrecv"===E||"sendonly"===E),!h||"sendrecv"!==E&&"sendonly"!==E?delete d.rtpReceiver:(y=h.track,r.push([y,h]),n.addTrack(y)));else{var O=t.usingBundle&&c>0?{iceGatherer:t.transceivers[0].iceGatherer,iceTransport:t.transceivers[0].iceTransport,dtlsTransport:t.transceivers[0].dtlsTransport}:t._createIceAndDtlsTransports(A,c);if(x&&O.iceTransport.setRemoteCandidates(P),v=RTCRtpReceiver.getCapabilities(w),m=[{ssrc:1001*(2*c+2)}],h=new RTCRtpReceiver(O.dtlsTransport,w),y=h.track,r.push([y,h]),n.addTrack(y),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=c){var L=t.localStreams[0].getTracks()[c];f=new RTCRtpSender(L,O.dtlsTransport)}t.transceivers[c]={iceGatherer:O.iceGatherer,iceTransport:O.iceTransport,dtlsTransport:O.dtlsTransport,localCapabilities:v,remoteCapabilities:T,rtpSender:f,rtpReceiver:h,kind:w,mid:A,cname:R,sendEncodingParameters:m,recvEncodingParameters:g},t._transceive(t.transceivers[c],!1,"sendrecv"===E||"sendonly"===E)}}),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return n.getTracks().length&&(t.remoteStreams.push(n),window.setTimeout(function(){var e=new Event("addstream");e.stream=n,t.dispatchEvent(e),null!==t.onaddstream&&window.setTimeout(function(){t.onaddstream(e)},0),r.forEach(function(i){var r=i[0],o=i[1],a=new Event("track");a.track=r,a.receiver=o,a.streams=[n],t.dispatchEvent(e),null!==t.ontrack&&window.setTimeout(function(){t.ontrack(a)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var i=new Event("iceconnectionstatechange");this.dispatchEvent(i),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(i)}},window.RTCPeerConnection.prototype.createOffer=function(){var e=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var t;1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var n=[],r=0,o=0;if(this.localStreams.length&&(r=this.localStreams[0].getAudioTracks().length,o=this.localStreams[0].getVideoTracks().length),t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(r=t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(o=t.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){n.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?r>0:o>0}),"audio"===e.kind?r--:"video"===e.kind&&o--});r>0||o>0;)r>0&&(n.push({kind:"audio",wantReceive:!0}),r--),o>0&&(n.push({kind:"video",wantReceive:!0}),o--);var a=i.writeSessionBoilerplate(),s=[];n.forEach(function(t,n){var r,o,a=t.track,c=t.kind,d=i.generateIdentifier(),u=e.usingBundle&&n>0?{iceGatherer:s[0].iceGatherer,iceTransport:s[0].iceTransport,dtlsTransport:s[0].dtlsTransport}:e._createIceAndDtlsTransports(d,n),l=RTCRtpSender.getCapabilities(c),p=[{ssrc:1001*(2*n+1)}];a&&(r=new RTCRtpSender(a,u.dtlsTransport)),t.wantReceive&&(o=new RTCRtpReceiver(u.dtlsTransport,c)),s[n]={iceGatherer:u.iceGatherer,iceTransport:u.iceTransport,dtlsTransport:u.dtlsTransport,localCapabilities:l,remoteCapabilities:null,rtpSender:r,rtpReceiver:o,kind:c,mid:d,sendEncodingParameters:p,recvEncodingParameters:null}}),this.usingBundle&&(a+="a=group:BUNDLE "+s.map(function(e){return e.mid}).join(" ")+"\r\n"),n.forEach(function(t,n){var r=s[n];a+=i.writeMediaSection(r,r.localCapabilities,"offer",e.localStreams[0])}),this._pendingOffer=s;var c=new RTCSessionDescription({type:"offer",sdp:a});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=i.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(n){var r=e._getCommonCapabilities(n.localCapabilities,n.remoteCapabilities);t+=i.writeMediaSection(n,r,"answer",e.localStreams[0])});var n=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,n),Promise.resolve(n)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(null===e)this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});else{var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var r=this.transceivers[t];if(r){var o=Object.keys(e.candidate).length>0?i.parseCandidate(e.candidate):{};if("tcp"===o.protocol&&0===o.port)return;if("1"!==o.component)return;"endOfCandidates"===o.type&&(o={}),r.iceTransport.addRemoteCandidate(o);var a=i.splitSections(this.remoteDescription.sdp);a[t+1]+=(o.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(n){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){i.set(t,e[t]),i[t]=e[t]})}),t&&window.setTimeout(t,0,i),n(i)})})}},attachMediaStream:function(e,t){r("DEPRECATED, attachMediaStream will soon be removed."),e.srcObject=t},reattachMediaStream:function(e,t){r("DEPRECATED, reattachMediaStream will soon be removed."),e.srcObject=t.srcObject}};t.exports={shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:o.attachMediaStream,reattachMediaStream:o.reattachMediaStream}},{"../utils":10,"./getusermedia":6,sdp:1}],6:[function(e,t,n){"use strict";t.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return t(n).catch(function(t){return Promise.reject(e(t))})}}},{}],7:[function(e,t,n){"use strict";var i=e("../utils").log,r=e("../utils").browserDetails,o={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(r.version<38&&e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var s={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(s.username=o.username,s.credential=o.credential),n.push(s)}else n.push(e.iceServers[i])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)};var t=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},n=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,i,r){return n.apply(this,[e||null]).then(function(e){return t(e)}).then(i,r)}}},attachMediaStream:function(e,t){i("DEPRECATED, attachMediaStream will soon be removed."),e.srcObject=t},reattachMediaStream:function(e,t){i("DEPRECATED, reattachMediaStream will soon be removed."),e.srcObject=t.srcObject}};t.exports={shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:o.attachMediaStream,reattachMediaStream:o.reattachMediaStream}},{"../utils":10,"./getusermedia":8}],8:[function(e,t,n){"use strict";var i=e("../utils").log,r=e("../utils").browserDetails;t.exports=function(){var e=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,n,o){var a=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(n),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[n]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var r={};"number"==typeof i.ideal?r[n]={min:i.ideal,max:i.ideal}:r[n]=i.ideal,e.advanced.push(r),delete i.ideal,Object.keys(i).length||delete e[n]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),r.version<38&&(i("spec: "+JSON.stringify(t)),t.audio&&(t.audio=a(t.audio)),t.video&&(t.video=a(t.video)),i("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,n,function(t){o(e(t))})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:function(e){return new Promise(function(n,i){t(e,n,i)})},addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},r.version<41){var n=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return n().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(r.version<49){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return o(t).catch(function(t){return Promise.reject(e(t))})}}navigator.getUserMedia=function(e,n,i){if(r.version<44)return t(e,n,i);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(n,i)}}},{"../utils":10}],9:[function(e,t,n){"use strict";var i={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};t.exports={shimGetUserMedia:i.shimGetUserMedia}},{}],10:[function(e,t,n){"use strict";var i=!0,r={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,t,n){var i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,e.minVersion=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),e.minVersion=31;else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),e.minVersion=38;else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1),e.minVersion=602}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),e.minVersion=10547}return e.version<e.minVersion&&r.log("Browser: "+e.browser+" Version: "+e.version+" < minimum supported version: "+e.minVersion+"\n some things might not work!"),e}};t.exports={log:r.log,disableLog:r.disableLog,browserDetails:r.detectBrowser(),extractVersion:r.extractVersion}},{}]},{},[2])(2)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).io=e()}}(function(){return function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return r(n||e)},u,u.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":2}],2:[function(e,t,n){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":3,"engine.io-parser":19}],3:[function(e,t,n){(function(n){function i(e,t){if(!(this instanceof i))return new i(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=u(e),t.hostname=e.host,t.secure="https"==e.protocol||"wss"==e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=u(t.host).host),this.secure=null!=t.secure?t.secure:n.location&&"https:"==location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(n.location?location.hostname:"localhost"),this.port=t.port||(n.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=p.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized?null:t.rejectUnauthorized;var r="object"==typeof n&&n;r.global===r&&t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),this.open()}function r(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var o=e("./transports"),a=e("component-emitter"),s=e("debug")("engine.io-client:socket"),c=e("indexof"),d=e("engine.io-parser"),u=e("parseuri"),l=e("parsejson"),p=e("parseqs");t.exports=i,i.priorWebsocketSuccess=!1,a(i.prototype),i.protocol=d.protocol,i.Socket=i,i.Transport=e("./transport"),i.transports=e("./transports"),i.parser=e("engine.io-parser"),i.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=r(this.query);return t.EIO=d.protocol,t.transport=e,this.id&&(t.sid=this.id),new o[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders})},i.prototype.open=function(){var e;if(this.rememberUpgrade&&i.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},i.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},i.prototype.probe=function(e){function t(){if(p.onlyBinaryUpgrades){var t=!this.supportsBinary&&p.transport.supportsBinary;l=l||t}l||(s('probe transport "%s" opened',e),u.send([{type:"ping",data:"probe"}]),u.once("packet",function(t){if(!l)if("pong"==t.type&&"probe"==t.data){if(s('probe transport "%s" pong',e),p.upgrading=!0,p.emit("upgrading",u),!u)return;i.priorWebsocketSuccess="websocket"==u.name,s('pausing current transport "%s"',p.transport.name),p.transport.pause(function(){l||"closed"!=p.readyState&&(s("changing transport and sending upgrade packet"),d(),p.setTransport(u),u.send([{type:"upgrade"}]),p.emit("upgrade",u),u=null,p.upgrading=!1,p.flush())})}else{s('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=u.name,p.emit("upgradeError",n)}}))}function n(){l||(l=!0,d(),u.close(),u=null)}function r(t){var i=new Error("probe error: "+t);i.transport=u.name,n(),s('probe transport "%s" failed because of error: %s',e,t),p.emit("upgradeError",i)}function o(){r("transport closed")}function a(){r("socket closed")}function c(e){u&&e.name!=u.name&&(s('"%s" works - aborting "%s"',e.name,u.name),n())}function d(){u.removeListener("open",t),u.removeListener("error",r),u.removeListener("close",o),p.removeListener("close",a),p.removeListener("upgrading",c)}s('probing transport "%s"',e);var u=this.createTransport(e,{probe:1}),l=!1,p=this;i.priorWebsocketSuccess=!1,u.once("open",t),u.once("error",r),u.once("close",o),this.once("close",a),this.once("upgrading",c),u.open()},i.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",i.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},i.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(l(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)},i.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},i.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!=t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},i.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},i.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},i.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},i.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},i.prototype.write=i.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},i.prototype.sendPacket=function(e,t,n,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"!=this.readyState&&"closed"!=this.readyState){(n=n||{}).compress=!1!==n.compress;var r={type:e,data:t,options:n};this.emit("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}},i.prototype.close=function(){function e(){i.onClose("forced close"),s("socket closing - telling transport to close"),i.transport.close()}function t(){i.removeListener("upgrade",t),i.removeListener("upgradeError",t),e()}function n(){i.once("upgrade",t),i.once("upgradeError",t)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var i=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}return this},i.prototype.onError=function(e){s("socket error %j",e),i.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},i.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){s('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),n.writeBuffer=[],n.prevBufferLen=0}},i.prototype.filterUpgrades=function(e){for(var t=[],n=0,i=e.length;n<i;n++)~c(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./transport":4,"./transports":5,"component-emitter":15,debug:17,"engine.io-parser":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(e,t,n){function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders}var r=e("engine.io-parser"),o=e("component-emitter");t.exports=i,o(i.prototype),i.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},i.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":15,"engine.io-parser":19}],5:[function(e,t,n){(function(t){var i=e("xmlhttprequest-ssl"),r=e("./polling-xhr"),o=e("./polling-jsonp"),a=e("./websocket");n.polling=function(e){var n=!1,a=!1,s=!1!==e.jsonp;if(t.location){var c="https:"==location.protocol,d=location.port;d||(d=c?443:80),n=e.hostname!=location.hostname||d!=e.port,a=e.secure!=c}if(e.xdomain=n,e.xscheme=a,"open"in new i(e)&&!e.forceJSONP)return new r(e);if(!s)throw new Error("JSONP disabled");return new o(e)},n.websocket=a}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest-ssl":10}],6:[function(e,t,n){(function(n){function i(){}function r(e){o.call(this,e),this.query=this.query||{},s||(n.___eio||(n.___eio=[]),s=n.___eio),this.index=s.length;var t=this;s.push(function(e){t.onData(e)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=i)},!1)}var o=e("./polling"),a=e("component-inherit");t.exports=r;var s,c=/\n/g,d=/\\n/g;a(r,o),r.prototype.supportsBinary=!1,r.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),o.prototype.doClose.call(this)},r.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},r.prototype.doWrite=function(e,t){function n(){i(),t()}function i(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';o=document.createElement(e)}catch(e){(o=document.createElement("iframe")).name=r.iframeId,o.src="javascript:0"}o.id=r.iframeId,r.form.appendChild(o),r.iframe=o}var r=this;if(!this.form){var o,a=document.createElement("form"),s=document.createElement("textarea"),u=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=u,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}this.form.action=this.uri(),i(),e=e.replace(d,"\\\n"),this.area.value=e.replace(c,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==r.iframe.readyState&&n()}:this.iframe.onload=n}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-inherit":16}],7:[function(e,t,n){(function(n){function i(){}function r(e){if(c.call(this,e),n.location){var t="https:"==location.protocol,i=location.port;i||(i=t?443:80),this.xd=e.hostname!=n.location.hostname||i!=e.port,this.xs=e.secure!=t}else this.extraHeaders=e.extraHeaders}function o(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function a(){for(var e in o.requests)o.requests.hasOwnProperty(e)&&o.requests[e].abort()}var s=e("xmlhttprequest-ssl"),c=e("./polling"),d=e("component-emitter"),u=e("component-inherit"),l=e("debug")("engine.io-client:polling-xhr");t.exports=r,t.exports.Request=o,u(r,c),r.prototype.supportsBinary=!0,r.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.extraHeaders=this.extraHeaders,new o(e)},r.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,i=this.request({method:"POST",data:e,isBinary:n}),r=this;i.on("success",t),i.on("error",function(e){r.onError("xhr post error",e)}),this.sendXhr=i},r.prototype.doPoll=function(){l("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},d(o.prototype),o.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new s(e),i=this;try{l("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders){t.setDisableHeaderCheck(!0);for(var r in this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}}catch(e){}if(this.supportsBinary&&(t.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.hasXDR()?(t.onload=function(){i.onLoad()},t.onerror=function(){i.onError(t.responseText)}):t.onreadystatechange=function(){4==t.readyState&&(200==t.status||1223==t.status?i.onLoad():setTimeout(function(){i.onError(t.status)},0))},l("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){i.onError(e)},0)}n.document&&(this.index=o.requestsCount++,o.requests[this.index]=this)},o.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},o.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},o.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},o.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=i:this.xhr.onreadystatechange=i,e)try{this.xhr.abort()}catch(e){}n.document&&delete o.requests[this.index],this.xhr=null}},o.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if("application/octet-stream"===t)e=this.xhr.response;else if(this.supportsBinary)try{e=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(t){for(var n=new Uint8Array(this.xhr.response),i=[],r=0,o=n.length;r<o;r++)i.push(n[r]);e=String.fromCharCode.apply(null,i)}else e=this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},o.prototype.hasXDR=function(){return void 0!==n.XDomainRequest&&!this.xs&&this.enablesXDR},o.prototype.abort=function(){this.cleanup()},n.document&&(o.requestsCount=0,o.requests={},n.attachEvent?n.attachEvent("onunload",a):n.addEventListener&&n.addEventListener("beforeunload",a,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-emitter":15,"component-inherit":16,debug:17,"xmlhttprequest-ssl":10}],8:[function(e,t,n){function i(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),r.call(this,e)}var r=e("../transport"),o=e("parseqs"),a=e("engine.io-parser"),s=e("component-inherit"),c=e("yeast"),d=e("debug")("engine.io-client:polling");t.exports=i;var u=null!=new(e("xmlhttprequest-ssl"))({xdomain:!1}).responseType;s(i,r),i.prototype.name="polling",i.prototype.doOpen=function(){this.poll()},i.prototype.pause=function(e){function t(){d("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var i=0;this.polling&&(d("we are currently polling - waiting to pause"),i++,this.once("pollComplete",function(){d("pre-pause polling complete"),--i||t()})),this.writable||(d("we are currently writing - waiting to pause"),i++,this.once("drain",function(){d("pre-pause writing complete"),--i||t()}))}else t()},i.prototype.poll=function(){d("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},i.prototype.onData=function(e){var t=this;d("polling got data %s",e);a.decodePayload(e,this.socket.binaryType,function(e,n,i){if("opening"==t.readyState&&t.onOpen(),"close"==e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():d('ignoring poll - transport state "%s"',this.readyState))},i.prototype.doClose=function(){function e(){d("writing close packet"),t.write([{type:"close"}])}var t=this;"open"==this.readyState?(d("transport open - closing"),e()):(d("transport not open - deferring close"),this.once("open",e))},i.prototype.write=function(e){n=this;this.writable=!1;var t=function(){n.writable=!0,n.emit("drain")},n=this;a.encodePayload(e,this.supportsBinary,function(e){n.doWrite(e,t)})},i.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,"xmlhttprequest-ssl":10,yeast:30}],9:[function(e,t,n){(function(n){function i(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,r.call(this,e)}var r=e("../transport"),o=e("engine.io-parser"),a=e("parseqs"),s=e("component-inherit"),c=e("yeast"),d=e("debug")("engine.io-client:websocket"),u=n.WebSocket||n.MozWebSocket,l=u;if(!l&&"undefined"==typeof window)try{l=e("ws")}catch(e){}t.exports=i,s(i,r),i.prototype.name="websocket",i.prototype.supportsBinary=!0,i.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t={agent:this.agent,perMessageDeflate:this.perMessageDeflate};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(t.headers=this.extraHeaders),this.ws=u?new l(e):new l(e,void 0,t),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},i.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(i.prototype.onData=function(e){var t=this;setTimeout(function(){r.prototype.onData.call(t,e)},0)}),i.prototype.write=function(e){function t(){i.emit("flush"),setTimeout(function(){i.writable=!0,i.emit("drain")},0)}var i=this;this.writable=!1;for(var r=e.length,a=0,s=r;a<s;a++)!function(e){o.encodePacket(e,i.supportsBinary,function(o){if(!u){var a={};e.options&&(a.compress=e.options.compress),i.perMessageDeflate&&("string"==typeof o?n.Buffer.byteLength(o):o.length)<i.perMessageDeflate.threshold&&(a.compress=!1)}try{u?i.ws.send(o):i.ws.send(o,a)}catch(e){d("websocket closed before onclose event")}--r||t()})}(e[a])},i.prototype.onClose=function(){r.prototype.onClose.call(this)},i.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},i.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),(e=a.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},i.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===i.prototype.name)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,ws:void 0,yeast:30}],10:[function(e,t,n){var i=e("has-cors");t.exports=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||i))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":22}],11:[function(e,t,n){function i(){}t.exports=function(e,t,n){function r(e,i){if(r.count<=0)throw new Error("after called too many times");--r.count,e?(o=!0,t(e),t=n):0!==r.count||o||t(null,i)}var o=!1;return n=n||i,r.count=e,0===e?t():r}},{}],12:[function(e,t,n){t.exports=function(e,t,n){var i=e.byteLength;if(t=t||0,n=n||i,e.slice)return e.slice(t,n);if(t<0&&(t+=i),n<0&&(n+=i),n>i&&(n=i),t>=i||t>=n||0===i)return new ArrayBuffer(0);for(var r=new Uint8Array(e),o=new Uint8Array(n-t),a=t,s=0;a<n;a++,s++)o[s]=r[a];return o.buffer}},{}],13:[function(e,t,n){!function(e){"use strict";n.encode=function(t){var n,i=new Uint8Array(t),r=i.length,o="";for(n=0;n<r;n+=3)o+=e[i[n]>>2],o+=e[(3&i[n])<<4|i[n+1]>>4],o+=e[(15&i[n+1])<<2|i[n+2]>>6],o+=e[63&i[n+2]];return r%3==2?o=o.substring(0,o.length-1)+"=":r%3==1&&(o=o.substring(0,o.length-2)+"=="),o},n.decode=function(t){var n,i,r,o,a,s=.75*t.length,c=t.length,d=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var u=new ArrayBuffer(s),l=new Uint8Array(u);for(n=0;n<c;n+=4)i=e.indexOf(t[n]),r=e.indexOf(t[n+1]),o=e.indexOf(t[n+2]),a=e.indexOf(t[n+3]),l[d++]=i<<2|r>>4,l[d++]=(15&r)<<4|o>>2,l[d++]=(3&o)<<6|63&a;return u}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],14:[function(e,t,n){(function(e){function n(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var i=n.buffer;if(n.byteLength!==i.byteLength){var r=new Uint8Array(n.byteLength);r.set(new Uint8Array(i,n.byteOffset,n.byteLength)),i=r.buffer}e[t]=i}}}function i(e,t){t=t||{};var i=new o;n(e);for(var r=0;r<e.length;r++)i.append(e[r]);return t.type?i.getBlob(t.type):i.getBlob()}function r(e,t){return n(e),new Blob(e,t||{})}var o=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,a=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),s=a&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),c=o&&o.prototype.append&&o.prototype.getBlob;t.exports=a?s?e.Blob:r:c?i:void 0}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],15:[function(e,t,n){function i(e){if(e)return r(e)}function r(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}t.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i,r=0;r<n.length;r++)if((i=n[r])===t||i.fn===t){n.splice(r,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n)for(var i=0,r=(n=n.slice(0)).length;i<r;++i)n[i].apply(this,t);return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],16:[function(e,t,n){t.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],17:[function(e,t,n){function i(){var e;try{e=n.storage.debug}catch(e){}return e}(n=t.exports=e("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var i="color: "+this.color,r=0,o=0;return(e=[e[0],i,"color: inherit"].concat(Array.prototype.slice.call(e,1)))[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))}),e.splice(o,0,i),e},n.save=function(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(e){}},n.load=i,n.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},n.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(i())},{"./debug":18}],18:[function(e,t,n){function i(){return n.colors[o++%n.colors.length]}(n=t.exports=function(e){function t(){}function o(){var e=o,t=+new Date,a=t-(r||t);e.diff=a,e.prev=r,e.curr=t,r=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=i());var s=Array.prototype.slice.call(arguments);s[0]=n.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var c=0;s[0]=s[0].replace(/%([a-z%])/g,function(t,i){if("%%"===t)return t;c++;var r=n.formatters[i];if("function"==typeof r){var o=s[c];t=r.call(e,o),s.splice(c,1),c--}return t}),"function"==typeof n.formatArgs&&(s=n.formatArgs.apply(e,s)),(o.log||n.log||console.log.bind(console)).apply(e,s)}t.enabled=!1,o.enabled=!0;var a=n.enabled(e)?o:t;return a.namespace=e,a}).coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){n.enable("")},n.enable=function(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),i=t.length,r=0;r<i;r++)t[r]&&("-"===(e=t[r].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))},n.enabled=function(e){var t,i;for(t=0,i=n.skips.length;t<i;t++)if(n.skips[t].test(e))return!1;for(t=0,i=n.names.length;t<i;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var r,o=0},{ms:25}],19:[function(e,t,n){(function(t){function i(e,t){return t("b"+n.packets[e.type]+e.data.data)}function r(e,t,i){if(!t)return n.encodeBase64Packet(e,i);var r=e.data,o=new Uint8Array(r),a=new Uint8Array(1+r.byteLength);a[0]=v[e.type];for(var s=0;s<o.length;s++)a[s+1]=o[s];return i(a.buffer)}function o(e,t,i){if(!t)return n.encodeBase64Packet(e,i);var r=new FileReader;return r.onload=function(){e.data=r.result,n.encodePacket(e,t,!0,i)},r.readAsArrayBuffer(e.data)}function a(e,t,i){if(!t)return n.encodeBase64Packet(e,i);if(g)return o(e,t,i);var r=new Uint8Array(1);return r[0]=v[e.type],i(new S([r.buffer,e.data]))}function s(e,t,n){for(var i=new Array(e.length),r=p(e.length,n),o=0;o<e.length;o++)!function(e,n,r){t(n,function(t,n){i[e]=n,r(t,i)})}(o,e[o],r)}var c=e("./keys"),d=e("has-binary"),u=e("arraybuffer.slice"),l=e("base64-arraybuffer"),p=e("after"),f=e("utf8"),h=navigator.userAgent.match(/Android/i),m=/PhantomJS/i.test(navigator.userAgent),g=h||m;n.protocol=3;var v=n.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},y=c(v),b={type:"error",data:"parser error"},S=e("blob");n.encodePacket=function(e,n,o,s){"function"==typeof n&&(s=n,n=!1),"function"==typeof o&&(s=o,o=null);var c=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&c instanceof ArrayBuffer)return r(e,n,s);if(S&&c instanceof t.Blob)return a(e,n,s);if(c&&c.base64)return i(e,s);var d=v[e.type];return void 0!==e.data&&(d+=o?f.encode(String(e.data)):String(e.data)),s(""+d)},n.encodeBase64Packet=function(e,i){var r="b"+n.packets[e.type];if(S&&e.data instanceof t.Blob){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];i(r+e)},o.readAsDataURL(e.data)}var a;try{a=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),c=new Array(s.length),d=0;d<s.length;d++)c[d]=s[d];a=String.fromCharCode.apply(null,c)}return r+=t.btoa(a),i(r)},n.decodePacket=function(e,t,i){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return n.decodeBase64Packet(e.substr(1),t);if(i)try{e=f.decode(e)}catch(e){return b}r=e.charAt(0);return Number(r)==r&&y[r]?e.length>1?{type:y[r],data:e.substring(1)}:{type:y[r]}:b}var r=new Uint8Array(e)[0],o=u(e,1);return S&&"blob"===t&&(o=new S([o])),{type:y[r],data:o}},n.decodeBase64Packet=function(e,n){var i=y[e.charAt(0)];if(!t.ArrayBuffer)return{type:i,data:{base64:!0,data:e.substr(1)}};var r=l.decode(e.substr(1));return"blob"===n&&S&&(r=new S([r])),{type:i,data:r}},n.encodePayload=function(e,t,i){function r(e){return e.length+":"+e}"function"==typeof t&&(i=t,t=null);var o=d(e);return t&&o?S&&!g?n.encodePayloadAsBlob(e,i):n.encodePayloadAsArrayBuffer(e,i):e.length?void s(e,function(e,i){n.encodePacket(e,!!o&&t,!0,function(e){i(null,r(e))})},function(e,t){return i(t.join(""))}):i("0:")},n.decodePayload=function(e,t,i){if("string"!=typeof e)return n.decodePayloadAsBinary(e,t,i);"function"==typeof t&&(i=t,t=null);var r;if(""==e)return i(b,0,1);for(var o,a,s="",c=0,d=e.length;c<d;c++){var u=e.charAt(c);if(":"!=u)s+=u;else{if(""==s||s!=(o=Number(s)))return i(b,0,1);if(a=e.substr(c+1,o),s!=a.length)return i(b,0,1);if(a.length){if(r=n.decodePacket(a,t,!0),b.type==r.type&&b.data==r.data)return i(b,0,1);if(!1===i(r,c+o,d))return}c+=o,s=""}}return""!=s?i(b,0,1):void 0},n.encodePayloadAsArrayBuffer=function(e,t){if(!e.length)return t(new ArrayBuffer(0));s(e,function(e,t){n.encodePacket(e,!0,!0,function(e){return t(null,e)})},function(e,n){var i=n.reduce(function(e,t){var n;return n="string"==typeof t?t.length:t.byteLength,e+n.toString().length+n+2},0),r=new Uint8Array(i),o=0;return n.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var i=new Uint8Array(e.length),a=0;a<e.length;a++)i[a]=e.charCodeAt(a);n=i.buffer}r[o++]=t?0:1;for(var s=n.byteLength.toString(),a=0;a<s.length;a++)r[o++]=parseInt(s[a]);r[o++]=255;for(var i=new Uint8Array(n),a=0;a<i.length;a++)r[o++]=i[a]}),t(r.buffer)})},n.encodePayloadAsBlob=function(e,t){s(e,function(e,t){n.encodePacket(e,!0,!0,function(e){var n=new Uint8Array(1);if(n[0]=1,"string"==typeof e){for(var i=new Uint8Array(e.length),r=0;r<e.length;r++)i[r]=e.charCodeAt(r);e=i.buffer,n[0]=0}for(var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),a=new Uint8Array(o.length+1),r=0;r<o.length;r++)a[r]=parseInt(o[r]);if(a[o.length]=255,S){var s=new S([n.buffer,a.buffer,e]);t(null,s)}})},function(e,n){return t(new S(n))})},n.decodePayloadAsBinary=function(e,t,i){"function"==typeof t&&(i=t,t=null);for(var r=e,o=[],a=!1;r.byteLength>0;){for(var s=new Uint8Array(r),c=0===s[0],d="",l=1;255!=s[l];l++){if(d.length>310){a=!0;break}d+=s[l]}if(a)return i(b,0,1);r=u(r,2+d.length),d=parseInt(d);var p=u(r,0,d);if(c)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var f=new Uint8Array(p);p="";for(l=0;l<f.length;l++)p+=String.fromCharCode(f[l])}o.push(p),r=u(r,d)}var h=o.length;o.forEach(function(e,r){i(n.decodePacket(e,t,!0),r,h)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./keys":20,after:11,"arraybuffer.slice":12,"base64-arraybuffer":13,blob:14,"has-binary":21,utf8:29}],20:[function(e,t,n){t.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var i in e)n.call(e,i)&&t.push(i);return t}},{}],21:[function(e,t,n){(function(n){var i=e("isarray");t.exports=function(e){function t(e){if(!e)return!1;if(n.Buffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File)return!0;if(i(e)){for(var r=0;r<e.length;r++)if(t(e[r]))return!0}else if(e&&"object"==typeof e){e.toJSON&&(e=e.toJSON());for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&t(e[o]))return!0}return!1}return t(e)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:24}],22:[function(e,t,n){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},{}],23:[function(e,t,n){var i=[].indexOf;t.exports=function(e,t){if(i)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},{}],24:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],25:[function(e,t,n){function i(e){if(!((e=""+e).length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*l;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*d;case"minutes":case"minute":case"mins":case"min":case"m":return n*c;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function r(e){return e>=u?Math.round(e/u)+"d":e>=d?Math.round(e/d)+"h":e>=c?Math.round(e/c)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function o(e){return a(e,u,"day")||a(e,d,"hour")||a(e,c,"minute")||a(e,s,"second")||e+" ms"}function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var s=1e3,c=60*s,d=60*c,u=24*d,l=365.25*u;t.exports=function(e,t){return t=t||{},"string"==typeof e?i(e):t.long?o(e):r(e)}},{}],26:[function(e,t,n){(function(e){var n=/^[\],:{}\s]*$/,i=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,r=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,o=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,s=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(a,"").replace(s,""),e.JSON&&JSON.parse?JSON.parse(t):n.test(t.replace(i,"@").replace(r,"]").replace(o,""))?new Function("return "+t)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],27:[function(e,t,n){n.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},n.decode=function(e){for(var t={},n=e.split("&"),i=0,r=n.length;i<r;i++){var o=n[i].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},{}],28:[function(e,t,n){var i=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){var t=e,n=e.indexOf("["),o=e.indexOf("]");-1!=n&&-1!=o&&(e=e.substring(0,n)+e.substring(n,o).replace(/:/g,";")+e.substring(o,e.length));for(var a=i.exec(e||""),s={},c=14;c--;)s[r[c]]=a[c]||"";return-1!=n&&-1!=o&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},{}],29:[function(e,t,n){(function(e){!function(i){function r(e){for(var t,n,i=[],r=0,o=e.length;r<o;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<o?56320==(64512&(n=e.charCodeAt(r++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),r--):i.push(t);return i}function o(e){for(var t,n=e.length,i=-1,r="";++i<n;)(t=e[i])>65535&&(r+=v((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=v(t);return r}function a(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function s(e,t){return v(e>>t&63|128)}function c(e){if(0==(4294967168&e))return v(e);var t="";return 0==(4294965248&e)?t=v(e>>6&31|192):0==(4294901760&e)?(a(e),t=v(e>>12&15|224),t+=s(e,6)):0==(4292870144&e)&&(t=v(e>>18&7|240),t+=s(e,12),t+=s(e,6)),t+=v(63&e|128)}function d(){if(g>=m)throw Error("Invalid byte index");var e=255&h[g];if(g++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function u(){var e,t,n,i,r;if(g>m)throw Error("Invalid byte index");if(g==m)return!1;if(e=255&h[g],g++,0==(128&e))return e;if(192==(224&e)){if((r=(31&e)<<6|(t=d()))>=128)return r;throw Error("Invalid continuation byte")}if(224==(240&e)){if(t=d(),n=d(),(r=(15&e)<<12|t<<6|n)>=2048)return a(r),r;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=d(),n=d(),i=d(),(r=(15&e)<<18|t<<12|n<<6|i)>=65536&&r<=1114111))return r;throw Error("Invalid UTF-8 detected")}var l="object"==typeof n&&n,p="object"==typeof t&&t&&t.exports==l&&t,f="object"==typeof e&&e;f.global!==f&&f.window!==f||(i=f);var h,m,g,v=String.fromCharCode,y={version:"2.0.0",encode:function(e){for(var t=r(e),n=t.length,i=-1,o="";++i<n;)o+=c(t[i]);return o},decode:function(e){h=r(e),m=h.length,g=0;for(var t,n=[];!1!==(t=u());)n.push(t);return o(n)}};if(l&&!l.nodeType)if(p)p.exports=y;else{var b={}.hasOwnProperty;for(var S in y)b.call(y,S)&&(l[S]=y[S])}else i.utf8=y}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],30:[function(e,t,n){"use strict";function i(e){var t="";do{t=a[e%s]+t,e=Math.floor(e/s)}while(e>0);return t}function r(){var e=i(+new Date);return e!==o?(d=0,o=e):e+"."+i(d++)}for(var o,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s=64,c={},d=0,u=0;u<s;u++)c[a[u]]=u;r.encode=i,r.decode=function(e){var t=0;for(u=0;u<e.length;u++)t=t*s+c[e.charAt(u)];return t},t.exports=r},{}],31:[function(e,t,n){function i(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,i=r(e),o=i.source,d=i.id,u=i.path,l=c[d]&&u in c[d].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?(s("ignoring socket cache for %s",o),n=a(o,t)):(c[d]||(s("new io instance for %s",o),c[d]=a(o,t)),n=c[d]),n.socket(i.path)}var r=e("./url"),o=e("socket.io-parser"),a=e("./manager"),s=e("debug")("socket.io-client");t.exports=n=i;var c=n.managers={};n.protocol=o.protocol,n.connect=i,n.Manager=e("./manager"),n.Socket=e("./socket")},{"./manager":32,"./socket":34,"./url":35,debug:39,"socket.io-parser":47}],32:[function(e,t,n){function i(e,t){if(!(this instanceof i))return new i(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new s.Encoder,this.decoder=new s.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var r=e("engine.io-client"),o=e("./socket"),a=e("component-emitter"),s=e("socket.io-parser"),c=e("./on"),d=e("component-bind"),u=e("debug")("socket.io-client:manager"),l=e("indexof"),p=e("backo2"),f=Object.prototype.hasOwnProperty;t.exports=i,i.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)f.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},i.prototype.updateSocketIds=function(){for(var e in this.nsps)f.call(this.nsps,e)&&(this.nsps[e].id=this.engine.id)},a(i.prototype),i.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},i.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},i.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},i.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},i.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},i.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},i.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},i.prototype.open=i.prototype.connect=function(e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=r(this.uri,this.opts);var t=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var i=c(t,"open",function(){n.onopen(),e&&e()}),o=c(t,"error",function(t){if(u("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var i=new Error("Connection error");i.data=t,e(i)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;u("connect attempt will timeout after %d",a);var s=setTimeout(function(){u("connect attempt timed out after %d",a),i.destroy(),t.close(),t.emit("error","timeout"),n.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(i),this.subs.push(o),this},i.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",d(this,"ondata"))),this.subs.push(c(e,"ping",d(this,"onping"))),this.subs.push(c(e,"pong",d(this,"onpong"))),this.subs.push(c(e,"error",d(this,"onerror"))),this.subs.push(c(e,"close",d(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",d(this,"ondecoded")))},i.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},i.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},i.prototype.ondata=function(e){this.decoder.add(e)},i.prototype.ondecoded=function(e){this.emit("packet",e)},i.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},i.prototype.socket=function(e){function t(){~l(i.connecting,n)||i.connecting.push(n)}var n=this.nsps[e];if(!n){n=new o(this,e),this.nsps[e]=n;var i=this;n.on("connecting",t),n.on("connect",function(){n.id=i.engine.id}),this.autoConnect&&t()}return n},i.prototype.destroy=function(e){var t=l(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},i.prototype.packet=function(e){u("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var i=0;i<n.length;i++)t.engine.write(n[i],e.options);t.encoding=!1,t.processPacketQueue()}))},i.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},i.prototype.cleanup=function(){u("cleanup");for(var e;e=this.subs.shift();)e.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},i.prototype.close=i.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},i.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},i.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},i.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":33,"./socket":34,backo2:36,"component-bind":37,"component-emitter":38,debug:39,"engine.io-client":1,indexof:42,"socket.io-parser":47}],33:[function(e,t,n){t.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},{}],34:[function(e,t,n){function i(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}var r=e("socket.io-parser"),o=e("component-emitter"),a=e("to-array"),s=e("./on"),c=e("component-bind"),d=e("debug")("socket.io-client:socket"),u=e("has-binary");t.exports=i;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=o.prototype.emit;o(i.prototype),i.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",c(this,"onopen")),s(e,"packet",c(this,"onpacket")),s(e,"close",c(this,"onclose"))]}},i.prototype.open=i.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting"),this)},i.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},i.prototype.emit=function(e){if(l.hasOwnProperty(e))return p.apply(this,arguments),this;var t=a(arguments),n=r.EVENT;u(t)&&(n=r.BINARY_EVENT);var i={type:n,data:t};return i.options={},i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(d("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),delete this.flags,this},i.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},i.prototype.onopen=function(){d("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:r.CONNECT})},i.prototype.onclose=function(e){d("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},i.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",e.data)}},i.prototype.onevent=function(e){var t=e.data||[];d("emitting event %j",t),null!=e.id&&(d("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?p.apply(this,t):this.receiveBuffer.push(t)},i.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var i=a(arguments);d("sending ack %j",i);var o=u(i)?r.BINARY_ACK:r.ACK;t.packet({type:o,id:e,data:i})}}},i.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(d("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):d("bad ack %s",e.id)},i.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},i.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)p.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},i.prototype.ondisconnect=function(){d("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},i.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},i.prototype.close=i.prototype.disconnect=function(){return this.connected&&(d("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},i.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},{"./on":33,"component-bind":37,"component-emitter":38,debug:39,"has-binary":41,"socket.io-parser":47,"to-array":51}],35:[function(e,t,n){(function(n){var i=e("parseuri"),r=e("debug")("socket.io-client:url");t.exports=function(e,t){var o=e,t=t||n.location;null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"==e.charAt(0)&&(e="/"==e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(r("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),r("parse %s",e),o=i(e)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";var a=-1!==o.host.indexOf(":")?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+a+":"+o.port,o.href=o.protocol+"://"+a+(t&&t.port==o.port?"":":"+o.port),o}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{debug:39,parseuri:45}],36:[function(e,t,n){function i(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=i,i.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},i.prototype.reset=function(){this.attempts=0},i.prototype.setMin=function(e){this.ms=e},i.prototype.setMax=function(e){this.max=e},i.prototype.setJitter=function(e){this.jitter=e}},{}],37:[function(e,t,n){var i=[].slice;t.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments)))}}},{}],38:[function(e,t,n){function i(e){if(e)return r(e)}function r(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}t.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i,r=0;r<n.length;r++)if((i=n[r])===t||i.fn===t){n.splice(r,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var i=0,r=(n=n.slice(0)).length;i<r;++i)n[i].apply(this,t);return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],39:[function(e,t,n){arguments[4][17][0].apply(n,arguments)},{"./debug":40,dup:17}],40:[function(e,t,n){arguments[4][18][0].apply(n,arguments)},{dup:18,ms:44}],41:[function(e,t,n){(function(n){var i=e("isarray");t.exports=function(e){function t(e){if(!e)return!1;if(n.Buffer&&n.Buffer.isBuffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File)return!0;if(i(e)){for(var r=0;r<e.length;r++)if(t(e[r]))return!0}else if(e&&"object"==typeof e){e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON());for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&t(e[o]))return!0}return!1}return t(e)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:43}],42:[function(e,t,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],43:[function(e,t,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],44:[function(e,t,n){arguments[4][25][0].apply(n,arguments)},{dup:25}],45:[function(e,t,n){arguments[4][28][0].apply(n,arguments)},{dup:28}],46:[function(e,t,n){(function(t){var i=e("isarray"),r=e("./is-buffer");n.deconstructPacket=function(e){function t(e){if(!e)return e;if(r(e)){var o={_placeholder:!0,num:n.length};return n.push(e),o}if(i(e)){for(var a=new Array(e.length),s=0;s<e.length;s++)a[s]=t(e[s]);return a}if("object"==typeof e&&!(e instanceof Date)){a={};for(var c in e)a[c]=t(e[c]);return a}return e}var n=[],o=e.data,a=e;return a.data=t(o),a.attachments=n.length,{packet:a,buffers:n}},n.reconstructPacket=function(e,t){function n(e){if(e&&e._placeholder)return t[e.num];if(i(e)){for(var r=0;r<e.length;r++)e[r]=n(e[r]);return e}if(e&&"object"==typeof e){for(var o in e)e[o]=n(e[o]);return e}return e}return e.data=n(e.data),e.attachments=void 0,e},n.removeBlobs=function(e,n){function o(e,c,d){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){a++;var u=new FileReader;u.onload=function(){d?d[c]=this.result:s=this.result,--a||n(s)},u.readAsArrayBuffer(e)}else if(i(e))for(var l=0;l<e.length;l++)o(e[l],l,e);else if(e&&"object"==typeof e&&!r(e))for(var p in e)o(e[p],p,e)}var a=0,s=e;o(s),a||n(s)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./is-buffer":48,isarray:43}],47:[function(e,t,n){function i(){}function r(e){var t="",i=!1;return t+=e.type,n.BINARY_EVENT!=e.type&&n.BINARY_ACK!=e.type||(t+=e.attachments,t+="-"),e.nsp&&"/"!=e.nsp&&(i=!0,t+=e.nsp),null!=e.id&&(i&&(t+=",",i=!1),t+=e.id),null!=e.data&&(i&&(t+=","),t+=l.stringify(e.data)),u("encoded %j as %s",e,t),t}function o(e,t){f.removeBlobs(e,function(e){var n=f.deconstructPacket(e),i=r(n.packet),o=n.buffers;o.unshift(i),t(o)})}function a(){this.reconstructor=null}function s(e){var t={},i=0;if(t.type=Number(e.charAt(0)),null==n.types[t.type])return d();if(n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type){for(var r="";"-"!=e.charAt(++i)&&(r+=e.charAt(i),i!=e.length););if(r!=Number(r)||"-"!=e.charAt(i))throw new Error("Illegal attachments");t.attachments=Number(r)}if("/"==e.charAt(i+1))for(t.nsp="";++i&&","!=(a=e.charAt(i))&&(t.nsp+=a,i!=e.length););else t.nsp="/";var o=e.charAt(i+1);if(""!==o&&Number(o)==o){for(t.id="";++i;){var a=e.charAt(i);if(null==a||Number(a)!=a){--i;break}if(t.id+=e.charAt(i),i==e.length)break}t.id=Number(t.id)}if(e.charAt(++i))try{t.data=l.parse(e.substr(i))}catch(e){return d()}return u("decoded %s as %j",e,t),t}function c(e){this.reconPack=e,this.buffers=[]}function d(e){return{type:n.ERROR,data:"parser error"}}var u=e("debug")("socket.io-parser"),l=e("json3"),p=(e("isarray"),e("component-emitter")),f=e("./binary"),h=e("./is-buffer");n.protocol=4,n.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],n.CONNECT=0,n.DISCONNECT=1,n.EVENT=2,n.ACK=3,n.ERROR=4,n.BINARY_EVENT=5,n.BINARY_ACK=6,n.Encoder=i,n.Decoder=a,i.prototype.encode=function(e,t){u("encoding packet %j",e),n.BINARY_EVENT==e.type||n.BINARY_ACK==e.type?o(e,t):t([r(e)])},p(a.prototype),a.prototype.add=function(e){var t;if("string"==typeof e)t=s(e),n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type?(this.reconstructor=new c(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!h(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},c.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=f.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},c.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":46,"./is-buffer":48,"component-emitter":49,debug:39,isarray:43,json3:50}],48:[function(e,t,n){(function(e){t.exports=function(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],49:[function(e,t,n){arguments[4][15][0].apply(n,arguments)},{dup:15}],50:[function(e,t,n){(function(e){(function(){function i(e,t){function n(e){if(n[e]!==g)return n[e];var i;if("bug-string-char-index"==e)i="a"!="a"[0];else if("json"==e)i=n("json-stringify")&&n("json-parse");else{var r,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var c=t.stringify,u="function"==typeof c&&b;if(u){(r=function(){return 1}).toJSON=r;try{u="0"===c(0)&&"0"===c(new o)&&'""'==c(new s)&&c(y)===g&&c(g)===g&&c()===g&&"1"===c(r)&&"[1]"==c([r])&&"[null]"==c([g])&&"null"==c(null)&&"[null,null,null]"==c([g,y,null])&&c({a:[r,!0,!1,null,"\0\b\n\f\r\t"]})==a&&"1"===c(null,r)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new d(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==c(new d(864e13))&&'"-000001-01-01T00:00:00.000Z"'==c(new d(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==c(new d(-1))}catch(e){u=!1}}i=u}if("json-parse"==e){var l=t.parse;if("function"==typeof l)try{if(0===l("0")&&!l(!1)){var p=5==(r=l(a)).a.length&&1===r.a[0];if(p){try{p=!l('"\t"')}catch(e){}if(p)try{p=1!==l("01")}catch(e){}if(p)try{p=1!==l("1.")}catch(e){}}}}catch(e){p=!1}i=p}}return n[e]=!!i}e||(e=a.Object()),t||(t=a.Object());var o=e.Number||a.Number,s=e.String||a.String,c=e.Object||a.Object,d=e.Date||a.Date,u=e.SyntaxError||a.SyntaxError,l=e.TypeError||a.TypeError,p=e.Math||a.Math,f=e.JSON||a.JSON;"object"==typeof f&&f&&(t.stringify=f.stringify,t.parse=f.parse);var h,m,g,v=c.prototype,y=v.toString,b=new d(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(e){}if(!n("json")){var S=n("bug-string-char-index");if(!b)var C=p.floor,w=[0,31,59,90,120,151,181,212,243,273,304,334],k=function(e,t){return w[t]+365*(e-1970)+C((e-1969+(t=+(t>1)))/4)-C((e-1901+t)/100)+C((e-1601+t)/400)};if((h=v.hasOwnProperty)||(h=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=y?h=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,h=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,h.call(this,e)}),m=function(e,t){var n,i,o,a=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,i=new n;for(o in i)h.call(i,o)&&a++;return n=i=null,a?m=2==a?function(e,t){var n,i={},r="[object Function]"==y.call(e);for(n in e)r&&"prototype"==n||h.call(i,n)||!(i[n]=1)||!h.call(e,n)||t(n)}:function(e,t){var n,i,r="[object Function]"==y.call(e);for(n in e)r&&"prototype"==n||!h.call(e,n)||(i="constructor"===n)||t(n);(i||h.call(e,n="constructor"))&&t(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],m=function(e,t){var n,o,a="[object Function]"==y.call(e),s=!a&&"function"!=typeof e.constructor&&r[typeof e.hasOwnProperty]&&e.hasOwnProperty||h;for(n in e)a&&"prototype"==n||!s.call(e,n)||t(n);for(o=i.length;n=i[--o];s.call(e,n)&&t(n));}),m(e,t)},!n("json-stringify")){var E={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},T=function(e,t){return("000000"+(t||0)).slice(-e)},A=function(e){for(var t='"',n=0,i=e.length,r=!S||i>10,o=r&&(S?e.split(""):e);n<i;n++){var a=e.charCodeAt(n);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=E[a];break;default:if(a<32){t+="\\u00"+T(2,a.toString(16));break}t+=r?o[n]:e.charAt(n)}}return t+'"'},R=function(e,t,n,i,r,o,a){var s,c,d,u,p,f,v,b,S,w,E,_,x,P,O,L;try{s=t[e]}catch(e){}if("object"==typeof s&&s)if("[object Date]"!=(c=y.call(s))||h.call(s,"toJSON"))"function"==typeof s.toJSON&&("[object Number]"!=c&&"[object String]"!=c&&"[object Array]"!=c||h.call(s,"toJSON"))&&(s=s.toJSON(e));else if(s>-1/0&&s<1/0){if(k){for(p=C(s/864e5),d=C(p/365.2425)+1970-1;k(d+1,0)<=p;d++);for(u=C((p-k(d,0))/30.42);k(d,u+1)<=p;u++);p=1+p-k(d,u),v=C((f=(s%864e5+864e5)%864e5)/36e5)%24,b=C(f/6e4)%60,S=C(f/1e3)%60,w=f%1e3}else d=s.getUTCFullYear(),u=s.getUTCMonth(),p=s.getUTCDate(),v=s.getUTCHours(),b=s.getUTCMinutes(),S=s.getUTCSeconds(),w=s.getUTCMilliseconds();s=(d<=0||d>=1e4?(d<0?"-":"+")+T(6,d<0?-d:d):T(4,d))+"-"+T(2,u+1)+"-"+T(2,p)+"T"+T(2,v)+":"+T(2,b)+":"+T(2,S)+"."+T(3,w)+"Z"}else s=null;if(n&&(s=n.call(t,e,s)),null===s)return"null";if("[object Boolean]"==(c=y.call(s)))return""+s;if("[object Number]"==c)return s>-1/0&&s<1/0?""+s:"null";if("[object String]"==c)return A(""+s);if("object"==typeof s){for(P=a.length;P--;)if(a[P]===s)throw l();if(a.push(s),E=[],O=o,o+=r,"[object Array]"==c){for(x=0,P=s.length;x<P;x++)_=R(x,s,n,i,r,o,a),E.push(_===g?"null":_);L=E.length?r?"[\n"+o+E.join(",\n"+o)+"\n"+O+"]":"["+E.join(",")+"]":"[]"}else m(i||s,function(e){var t=R(e,s,n,i,r,o,a);t!==g&&E.push(A(e)+":"+(r?" ":"")+t)}),L=E.length?r?"{\n"+o+E.join(",\n"+o)+"\n"+O+"}":"{"+E.join(",")+"}":"{}";return a.pop(),L}};t.stringify=function(e,t,n){var i,o,a,s;if(r[typeof t]&&t)if("[object Function]"==(s=y.call(t)))o=t;else if("[object Array]"==s){a={};for(var c,d=0,u=t.length;d<u;c=t[d++],("[object String]"==(s=y.call(c))||"[object Number]"==s)&&(a[c]=1));}if(n)if("[object Number]"==(s=y.call(n))){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else"[object String]"==s&&(i=n.length<=10?n:n.slice(0,10));return R("",(c={},c[""]=e,c),o,a,i,"",[])}}if(!n("json-parse")){var _,x,P=s.fromCharCode,O={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},L=function(){throw _=x=null,u()},N=function(){for(var e,t,n,i,r,o=x,a=o.length;_<a;)switch(r=o.charCodeAt(_)){case 9:case 10:case 13:case 32:_++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=S?o.charAt(_):o[_],_++,e;case 34:for(e="@",_++;_<a;)if((r=o.charCodeAt(_))<32)L();else if(92==r)switch(r=o.charCodeAt(++_)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=O[r],_++;break;case 117:for(t=++_,n=_+4;_<n;_++)(r=o.charCodeAt(_))>=48&&r<=57||r>=97&&r<=102||r>=65&&r<=70||L();e+=P("0x"+o.slice(t,_));break;default:L()}else{if(34==r)break;for(r=o.charCodeAt(_),t=_;r>=32&&92!=r&&34!=r;)r=o.charCodeAt(++_);e+=o.slice(t,_)}if(34==o.charCodeAt(_))return _++,e;L();default:if(t=_,45==r&&(i=!0,r=o.charCodeAt(++_)),r>=48&&r<=57){for(48==r&&(r=o.charCodeAt(_+1))>=48&&r<=57&&L(),i=!1;_<a&&(r=o.charCodeAt(_))>=48&&r<=57;_++);if(46==o.charCodeAt(_)){for(n=++_;n<a&&(r=o.charCodeAt(n))>=48&&r<=57;n++);n==_&&L(),_=n}if(101==(r=o.charCodeAt(_))||69==r){for(43!=(r=o.charCodeAt(++_))&&45!=r||_++,n=_;n<a&&(r=o.charCodeAt(n))>=48&&r<=57;n++);n==_&&L(),_=n}return+o.slice(t,_)}if(i&&L(),"true"==o.slice(_,_+4))return _+=4,!0;if("false"==o.slice(_,_+5))return _+=5,!1;if("null"==o.slice(_,_+4))return _+=4,null;L()}return"$"},I=function(e){var t,n;if("$"==e&&L(),"string"==typeof e){if("@"==(S?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=N());n||(n=!0))n&&(","==e?"]"==(e=N())&&L():L()),","==e&&L(),t.push(I(e));return t}if("{"==e){for(t={};"}"!=(e=N());n||(n=!0))n&&(","==e?"}"==(e=N())&&L():L()),","!=e&&"string"==typeof e&&"@"==(S?e.charAt(0):e[0])&&":"==N()||L(),t[e.slice(1)]=I(N());return t}L()}return e},D=function(e,t,n){var i=M(e,t,n);i===g?delete e[t]:e[t]=i},M=function(e,t,n){var i,r=e[t];if("object"==typeof r&&r)if("[object Array]"==y.call(r))for(i=r.length;i--;)D(r,i,n);else m(r,function(e){D(r,e,n)});return n.call(e,t,r)};t.parse=function(e,t){var n,i;return _=0,x=""+e,n=I(N()),"$"!=N()&&L(),_=x=null,t&&"[object Function]"==y.call(t)?M((i={},i[""]=n,i),"",t):n}}}return t.runInContext=i,t}var r={function:!0,object:!0},o=r[typeof n]&&n&&!n.nodeType&&n,a=r[typeof window]&&window||this,s=o&&r[typeof t]&&t&&!t.nodeType&&"object"==typeof e&&e;if(!s||s.global!==s&&s.window!==s&&s.self!==s||(a=s),o)i(a,o);else{var c=a.JSON,d=a.JSON3,u=!1,l=i(a,a.JSON3={noConflict:function(){return u||(u=!0,a.JSON=c,a.JSON3=d,c=d=null),l}});a.JSON={parse:l.parse,stringify:l.stringify}}}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],51:[function(e,t,n){t.exports=function(e,t){for(var n=[],i=(t=t||0)||0;i<e.length;i++)n[i-t]=e[i];return n}},{}]},{},[31])(31)});var SocketSentinel=function(e,t){e&&(this.socket=e,this.socketManager=e.io,this.baseUri=e.io.uri,this.spareUri=t,t&&this.baseUri!=t&&this.socketManager.reconnectionAttempts(5),function(e,t){e.on("reconnect_failed",function(){t.changeSpareLine(),console.log("切换备用线路")})}(e,this),this.changeSpareLine=function(){this.socketManager.attempts=0,this.socketManager.uri=this.spareUri,this.socketManager.reconnect();var e=this.baseUri;this.baseUri=this.spareUri,this.spareUri=e})};!function(e){function t(e){"use strict";this.type=e.type,this.attributes=e.attributes}function n(e){"use strict";var t=this,n=new SignalingChannel;this.onConnected=null,this.onDisconnected=null,this.onConnectFailed=null,this.onChatInvitation=null,this.onChatDenied=null,this.onChatStopped=null,this.onChatAccepted=null,this.onChatSignal=null,this.onStreamType=null,this.onAuthenticated=null,n.onMessage=function(e,n){var i=JSON.parse(e);switch(i.type){case"chat-invitation":t.onChatInvitation&&t.onChatInvitation(n,i.ua);break;case"chat-accepted":t.onChatAccepted&&t.onChatAccepted(n,i.ua);break;case"chat-denied":t.onChatDenied&&t.onChatDenied(n);break;case"chat-closed":t.onChatStopped&&t.onChatStopped(n);break;case"stream-type":t.onStreamType&&t.onStreamType(i.data,n);break;case"chat-signal":t.onChatSignal&&t.onChatSignal(i.data,n);break;case"chat-negotiation-needed":t.onNegotiationNeeded&&t.onNegotiationNeeded(n);break;case"chat-negotiation-accepted":t.onNegotiationAccepted&&t.onNegotiationAccepted(n);break;default:r.Logger.error("Received unkown message")}},n.onServerDisconnected=function(){t.onDisconnected&&t.onDisconnected()},this.sendChatInvitation=function(e,t,i,r){var o={type:"chat-closed"};n.sendMessage(JSON.stringify(o),e),o={type:"chat-invitation",ua:t},n.sendMessage(JSON.stringify(o),e,i,r)},this.sendChatAccepted=function(e,t,i,r){var o={type:"chat-accepted",ua:t};n.sendMessage(JSON.stringify(o),e,i,r)},this.sendChatDenied=function(e,t,i){var r={type:"chat-denied"};n.sendMessage(JSON.stringify(r),e,t,i)},this.sendChatStopped=function(e,t,i){var r={type:"chat-closed"};n.sendMessage(JSON.stringify(r),e,t,i)},this.sendStreamType=function(e,t,i,r){var o={type:"stream-type",data:t};n.sendMessage(JSON.stringify(o),e,i,r)},this.sendSignalMessage=function(e,t,i,r){var o={type:"chat-signal",data:t};n.sendMessage(JSON.stringify(o),e,i,r)},this.sendNegotiationNeeded=function(e,t,i){var r={type:"chat-negotiation-needed"};n.sendMessage(JSON.stringify(r),e,t,i)},this.sendNegotiationAccepted=function(e,t,i){var r={type:"chat-negotiation-accepted"};n.sendMessage(JSON.stringify(r),e,t,i)},this.finalize=function(){n.disconnect()},this.connect=function(e,i,r){n.connect(e,function(e){t.onConnected&&t.onConnected(),t.onAuthenticated&&t.onAuthenticated(e),i&&i(e)},r)}}var i=function(){"use strict";var e={};return Object.defineProperties(e,{version:{get:function(){return"3.4.0"}},name:{get:function(){return"Intel WebRTC SDK"}}}),e}(),r={},o={};i.EventDispatcher=function(e){"use strict";var t={};return e.dispatcher={},e.dispatcher.eventListeners={},t.addEventListener=function(t,n){void 0===e.dispatcher.eventListeners[t]&&(e.dispatcher.eventListeners[t]=[]),e.dispatcher.eventListeners[t].push(n)},t.on=t.addEventListener,t.removeEventListener=function(t,n){if(e.dispatcher.eventListeners[t]){var i=e.dispatcher.eventListeners[t].indexOf(n);-1!==i&&e.dispatcher.eventListeners[t].splice(i,1)}},t.clearEventListener=function(t){e.dispatcher.eventListeners[t]=[]},t.dispatchEvent=function(t){e.dispatcher.eventListeners[t.type]&&e.dispatcher.eventListeners[t.type].map(function(e){e(t)})},t},i.StreamEvent=function(e){"use strict";t.call(this,e),this.stream=e.stream,this.msg=e.msg},i.ClientEvent=function(e){"use strict";t.call(this,e),this.user=e.user},i.MessageEvent=function(e){"use strict";t.call(this,e),this.msg=e.msg},i.ChatEvent=function(e){"use strict";t.call(this,e),this.type=e.type,this.senderId=e.senderId,this.peerId=e.peerId},i.DataEvent=function(e){"use strict";t.call(this,e),this.type=e.type,this.senderId=e.senderId,this.data=e.data},i.RecorderEvent=function(e){"use strict";t.call(this,e),this.recorderId=e.id},i.StreamEvent.prototype=Object.create(t.prototype),i.StreamEvent.prototype.constructor=i.StreamEvent,i.ClientEvent.prototype=Object.create(t.prototype),i.ClientEvent.prototype.constructor=i.ClientEvent,i.MessageEvent.prototype=Object.create(t.prototype),i.MessageEvent.prototype.constructor=i.MessageEvent,i.ChatEvent.prototype=Object.create(t.prototype),i.ChatEvent.prototype.constructor=i.ChatEvent,i.DataEvent.prototype=Object.create(t.prototype),i.DataEvent.prototype.constructor=i.DataEvent,i.RecorderEvent.prototype=Object.create(t.prototype),i.RecorderEvent.prototype.constructor=i.RecorderEvent,i.Common=function(){function e(e,n,i){return t(e,0,-1,n,i)}function t(e,t,n,i,r){for(var o=-1!==n?n:e.length,a=t;a<o;++a)if(0===e[a].indexOf(i)&&(!r||-1!==e[a].toLowerCase().indexOf(r.toLowerCase())))return a;return null}function n(t,n){var r=e(t,"a=rtpmap",n);return r?i(t[r]):null}function i(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+","i"),n=e.match(t);return n&&2===n.length?n[1]:null}function o(e,t){var n=e.split(" "),i=n.slice(0,3);i.push(t);for(var r=3;r<n.length;r++)n[r]!==t&&i.push(n[r]);return i.join(" ")}return{parseStats:function(e){"use strict";var t=0,n=[];return navigator.mozGetUserMedia?e.forEach(function(i,r){var o,a=!1;r.indexOf("outbound_rtp_audio_")>=0?(a=!0,o={type:"ssrc_audio_send",id:i.id,stats:{bytes_sent:i.bytesSent,codec_name:"",packets_sent:i.packetsSent,packets_lost:e.get("outbound_rtcp_audio_"+r.slice(19)).packetsLost,rtt_ms:e.get("outbound_rtcp_audio_"+r.slice(19)).mozRtt}}):r.indexOf("outbound_rtp_video_")>=0?(a=!0,o={type:"ssrc_video_send",id:i.id,stats:{bytes_sent:i.bytesSent,codec_name:"",packets_sent:i.packetsSent,packets_lost:e.get("outbound_rtcp_video_"+r.slice(19)).packetsLost,firs_rcvd:-1,plis_rcvd:-1,nacks_rcvd:-1,send_frame_width:-1,send_frame_height:-1,adapt_reason:-1,adapt_changes:-1,framerate_sent:i.framerateMean,rtt_ms:e.get("outbound_rtcp_video_"+r.slice(19)).mozRtt}}):r.indexOf("inbound_rtp_audio_")>=0?(a=!0,o={type:"ssrc_audio_recv",id:i.id,stats:{bytes_rcvd:i.bytesReceived,delay_estimated_ms:-1,packets_rcvd:i.packetsReceived,packets_lost:i.packetsLost,codec_name:""}}):r.indexOf("inbound_rtp_video_")>=0&&(a=!0,o={type:"ssrc_video_recv",id:i.id,stats:{bytes_rcvd:i.bytesReceived,packets_rcvd:i.packetsReceived,packets_lost:i.packetsLost,firs_sent:-1,nacks_sent:-1,plis_sent:-1,frame_width:-1,frame_height:-1,framerate_rcvd:i.framerateMean,framerate_output:-1,current_delay_ms:-1,codec_name:""}}),a&&(n[t]=o,t++)}):e.forEach(function(e){var i,r=!1;if("ssrc"===e.type)if(r=!0,e.bytesSent)if(e.googFrameHeightSent){var o;o=!0===e.googCpuLimitedResolution?1:!0===e.googBandwidthLimitedResolution?2:!0===e.googViewLimitedResolution?3:99,i={type:"ssrc_video_send",id:e.id,stats:{bytes_sent:e.bytesSent,codec_name:e.googCodecName,packets_sent:e.packetsSent,packets_lost:e.packetsLost,firs_rcvd:e.googFirsReceived,plis_rcvd:e.googPlisReceived,nacks_rcvd:e.googNacksReceived,send_frame_width:e.googFrameWidthSent,send_frame_height:e.googFrameHeightSent,adapt_reason:o,adapt_changes:e.googAdaptationChanges,framerate_sent:e.googFrameRateSent,rtt_ms:e.googRtt}}}else i={type:"ssrc_audio_send",id:e.id,stats:{bytes_sent:e.bytesSent,codec_name:e.googCodecName,packets_sent:e.packetsSent,packets_lost:e.packetsLost,rtt_ms:e.googRtt}};else i=e.googFrameHeightReceived?{type:"ssrc_video_recv",id:e.id,stats:{bytes_rcvd:e.bytesReceived,packets_rcvd:e.packetsReceived,packets_lost:e.packetsLost,firs_sent:e.googFirsSent,nacks_sent:e.googNacksSent,plis_sent:e.googPlisSent,frame_width:e.googFrameWidthReceived,frame_height:e.googFrameHeightReceived,framerate_rcvd:e.googFrameRateReceived,framerate_output:e.googFrameRateDecoded,current_delay_ms:e.googCurrentDelayMs,codec_name:e.googCodecName}}:{type:"ssrc_audio_recv",id:e.id,stats:{bytes_rcvd:e.bytesReceived,delay_estimated_ms:e.googCurrentDelayMs,packets_rcvd:e.packetsReceived,packets_lost:e.packetsLost,codec_name:e.googCodecName}};else"VideoBwe"===e.type&&(r=!0,i={type:"VideoBWE",id:"",stats:{available_send_bandwidth:e.googAvailableSendBandwidth,available_receive_bandwidth:e.googAvailableReceiveBandwidth,transmit_bitrate:e.googTransmitBitrate,retransmit_bitrate:e.googRetransmitBitrate}});r&&(n[t]=i,t++)}),n},parseAudioLevel:function(e){for(var t=0,n=0,i={},r=[],o=[],a=!1,s=e.result(),c=0;c<s.length;c++){var d=s[c];if("ssrc"===d.type)if(d.stat("bytesSent"))d.stat("googFrameHeightSent")||(a=!0,(u={}).ssrc=d.id,u.level=d.stat("audioInputLevel"),r[t]=u,t++);else if(d.stat("googFrameHeightReceived"));else{a=!0;var u={};u.ssrc=d.id,u.level=d.stat("audioOutputLevel"),o[n]=u,n++}}return a&&(t>0&&(i.audioInputLevels=r),n>0&&(i.audioOutputLevels=o)),i},setPreferredCodec:function(t,i,a){if(!i||!a)return r.Logger.warning("Media type or codec name is not provided."),t;var s=t.split("\r\n"),c=e(s,"m=",i);if(null===c)return t;var d=n(s,a);return d&&(s[c]=o(s[c],d)),t=s.join("\r\n")},setPreferredBitrate:function(n,i,o){var a=n.split("\r\n"),s=e(a,"m=",i);if(null===s)return r.Logger.debug("Failed to add bandwidth line to sdp, as no m-line found"),n;var c=t(a,s+1,-1,"m=");null===c&&(c=a.length);var d=t(a,s+1,c,"c=");if(null===d)return r.Logger.debug("Failed to add bandwidth line to sdp, as no c-line found"),n;var u=t(a,d+1,c,"b=AS");u&&a.splice(u,1);var l="b=AS:"+o;return a.splice(d+1,0,l),n=a.join("\r\n")},sysInfo:function(){var e=Object.create({});e.sdk={version:"3.4",type:"JavaScript"};var t=navigator.userAgent,n=/Firefox\/([0-9\.]+)/,i=/Edge\/([0-9\.]+)/,r=/Chrome\/([0-9\.]+)/.exec(t);r?e.runtime={name:"Chrome",version:r[1]}:(r=n.exec(t))?e.runtime={name:"FireFox",version:r[1]}:(r=i.exec(t))?e.runtime={name:"Edge",version:r[1]}:e.runtime={name:"Unknown",version:"Unknown"};var o=/Intel Mac OS X ([0-9_\.]+)/,a=/iPhone OS ([0-9_\.]+)/,s=/X11; Linux/,c=/Android( ([0-9\.]+))?/,d=/CrOS/;return(r=/Windows NT ([0-9\.]+)/.exec(t))?e.os={name:"Windows NT",version:r[1]}:(r=o.exec(t))?e.os={name:"Mac OS X",version:r[1].replace(/_/g,".")}:(r=a.exec(t))?e.os={name:"iPhone OS",version:r[1].replace(/_/g,".")}:(r=s.exec(t))?e.os={name:"Linux",version:"Unknown"}:(r=c.exec(t))?e.os={name:"Android",version:r[1]||"Unknown"}:(r=d.exec(t))?e.os={name:"Chrome OS",version:"Unknown"}:e.os={name:"Unknown",version:"Unknown"},e}}}(),attachMediaStream=function(){r.Logger.warning("Global attachMediaStream is deprecated, pleause include woogeen.sdk.ui.js and use Woogeen.UI.attachMediaStream instead."),adapter.browserShim.attachMediaStream.apply(this,arguments)},r.Base64=function(){"use strict";var e,t,n,i,r,o,a,s,c,d,u,l;for(e=-1,t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n=[],o=0;o<t.length;o+=1)n[t[o]]=o;return a=function(e){i=e,r=0},s=function(){var t;return i?r>=i.length?e:(t=255&i.charCodeAt(r),r+=1,t):e},c=function(n){var i,r,o;for(a(n),i="",r=new Array(3),o=!1;!o&&(r[0]=s())!==e;)r[1]=s(),r[2]=s(),i+=t[r[0]>>2],r[1]!==e?(i+=t[r[0]<<4&48|r[1]>>4],r[2]!==e?(i+=t[r[1]<<2&60|r[2]>>6],i+=t[63&r[2]]):(i+=t[r[1]<<2&60],i+="=",o=!0)):(i+=t[r[0]<<4&48],i+="=",i+="=",o=!0);return i},d=function(){if(!i)return e;for(;;){if(r>=i.length)return e;var t=i.charAt(r);if(r+=1,n[t])return n[t];if("A"===t)return 0}},u=function(e){return 1===(e=e.toString(16)).length&&(e="0"+e),e="%"+e,unescape(e)},l=function(t){var n,i,r;for(a(t),n="",i=new Array(4),r=!1;!r&&(i[0]=d())!==e&&(i[1]=d())!==e;)i[2]=d(),i[3]=d(),n+=u(i[0]<<2&255|i[1]>>4),i[2]!==e?(n+=u(i[1]<<4&255|i[2]>>2),i[3]!==e?n+=u(i[2]<<6&255|i[3]):r=!0):r=!0;return n},{encodeBase64:c,decodeBase64:l}}(),r.Logger=function(){"use strict";var t=function(){},n={DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5};n.log=e.console.log.bind(e.console);var i=function(t){return"function"==typeof e.console[t]?e.console[t].bind(e.console):e.console.log.bind(e.console)},r=function(e){n.debug=e<=0?i("debug"):t,n.trace=e<=1?i("trace"):t,n.info=e<=2?i("info"):t,n.warning=e<=3?i("warn"):t,n.error=e<=4?i("error"):t};return r(0),n.setLogLevel=r,n}(),function(){"use strict";function t(e){this.mediaStream=e.mediaStream,e.attributes=e.attributes||{},this.url=function(){if("string"==typeof e.url&&""!==e.url)return e.url},this.hasVideo=function(){return!!e.video},this.hasAudio=function(){return!!e.audio},this.attributes=function(){return e.attributes},this.attr=function(t,n){return arguments.length>1&&(e.attributes[t]=n),e.attributes[t]},this.id=function(){return e.id||null},this.isScreen=function(){return!!e.video&&"screen"===e.video.device},this.bitRate={maxVideoBW:void 0,maxAudioBW:void 0},this.toJson=function(){return{id:this.id(),audio:!!this.hasAudio()&&e.audio,video:!!this.hasVideo()&&e.video,attributes:e.attributes}}}function n(e){t.call(this,e),this.hasAudio=function(){return this.mediaStream?!!this.mediaStream.getAudioTracks().length:!!e.hasAudio},this.hasVideo=function(){return this.mediaStream?!!this.mediaStream.getVideoTracks().length:!!e.hasVideo}}function o(e){t.call(this,e),this.isMixed=function(){return!1},this.from=e.from;var n={},i=this;Object.defineProperties(this,{on:{get:function(){return function(e,t){return n[e]=n[e]||[],n[e].push(t),i}}},emit:{get:function(){return function(e){if(n[e]){var t=[].slice.call(arguments,1);n[e].map(function(e){e.apply(i,t)})}return i}}},removeListener:{get:function(){return function(e,t){return void 0===t?n[e]=[]:n[e]&&n[e].map(function(i,r){i===t&&n[e].splice(r,1)}),i}}},clearListeners:{get:function(){return function(){return n={},i}}}})}function a(e){o.call(this,e),this.resolutions=function(){return e.video.resolutions instanceof Array?e.video.resolutions.map(function(e){return e}):[]},this.isMixed=function(){return!0},this.viewport=function(){return e.viewport}}function s(e){this.url=function(){if("string"==typeof e.url&&""!==e.url)return e.url},this.id=function(){return e.id||null},this.hasVideo=function(){return!!e.video},this.hasAudio=function(){return!!e.audio},this.toJson=function(){var t;return!0===e.video?t={device:"camera"}:!1===e.video?t=e.video:"object"==typeof e.video&&(t=e.video,t.device=e.video.device||"camera"),{id:this.id(),audio:e.audio,video:t,url:this.url()}}}function c(){return null!==e.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&e.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function d(){return e.navigator.appVersion.indexOf("Trident")>-1}function u(){return null!==e.navigator.userAgent.match("Firefox")}function l(){return u()||null!==e.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&e.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]>=34}function p(e,t){return{width:e,height:t}}function f(e,t){if("object"!=typeof(e=JSON.parse(JSON.stringify(e)))||null===e||void 0===e.url)if("function"==typeof g||d()){var n=arguments[3];void 0===n&&(n=2);var o={};if(null!==e&&"object"==typeof e){if(!e.audio&&!e.video)return void("function"==typeof t&&t({code:1107,msg:"At least one of audio and video must be requested."}));if(e.video){if("object"!=typeof e.video&&e.video&&(e.video=Object.create({})),"string"!=typeof e.video.device&&(e.video.device="camera"),"screen"===e.video.device&&!l()&&"function"==typeof t)return void t({code:1103,msg:"browser screen sharing not supported"});"object"==typeof e.video.resolution&&void 0!==e.video.resolution.width&&void 0!==e.video.resolution.height?o.video=JSON.parse(JSON.stringify(p(e.video.resolution.width,e.video.resolution.height))):o.video=JSON.parse(JSON.stringify(m[e.video.resolution]||m.unspecified)),"string"==typeof e.video.deviceId&&(o.video.deviceId=e.video.deviceId),d()||c()||(e.video.frameRate instanceof Array&&e.video.frameRate.length>=2?o.video.frameRate={min:e.video.frameRate[0],max:e.video.frameRate[1]}:"number"==typeof e.video.frameRate?o.video.frameRate=e.video.frameRate:r.Logger.warning("Invalid frame rate value, ignored."))}"object"==typeof e.audio?o.audio=e.audio:!0===e.audio&&(o.audio=!0)}else if("function"==typeof t)return void t({code:1107,msg:"USER_INPUT_INVALID"});var a=function(n){if("object"==typeof e.video&&"screen"===e.video.device||!(e.audio&&0===n.getAudioTracks().length||e.video&&0===n.getVideoTracks().length)){e.mediaStream=n,e.id=n.id;var r=new i.LocalStream(e);if(e.video&&"screen"===e.video.device){var a=n.getVideoTracks();a.length>0&&(a[0].onended=function(){r.close()})}if(o.video)switch(o.video.width){case 320:r.bitRate.maxVideoBW=512;break;case 640:r.bitRate.maxVideoBW=1024;break;case 1280:r.bitRate.maxVideoBW=2048}"function"==typeof t&&t(null,r)}else{for(var s=0;s<n.getTracks().length;s++)n.getTracks()[s].stop();t({code:1104,msg:"Not all device requests are satisfied."})}},s=function(i){var r={code:1100,msg:i.name||i};switch(r.msg){case"Starting video failed":case"TrackStartError":if(e.video={device:e.video.device,extensionId:e.video.extensionId},n>0)return void setTimeout(function(){f(e,t,n-1)},1);r.msg="MEDIA_OPTION_INVALID",r.code=1104;break;case"DevicesNotFoundError":r.msg="DEVICES_NOT_FOUND",r.code=1102;break;case"NotSupportedError":r.msg="NOT_SUPPORTED",r.code=1105;break;case"PermissionDeniedError":r.msg="PERMISSION_DENIED",r.code=1101;break;case"PERMISSION_DENIED":r.code=1101;break;case"ConstraintNotSatisfiedError":r.msg="CONSTRAINT_NOT_SATISFIED",r.code=1106;break;default:r.msg||(r.msg="UNDEFINED")}"function"==typeof t&&t(r)};if(e.video&&"screen"===e.video.device){if(u())return void 0!==o.video?o.video.mediaSource="window":o.video={mediaSource:"window"},void g.apply(navigator,[o,a,s]);var h=e.video.extensionId||"pndohhifhheefbpeljcmnhnkphepimhe",v=["screen","window","tab"];e.audio&&v.push("audio");try{chrome.runtime.sendMessage(h,{getStream:v},function(e){return void 0===e?void("function"==typeof t&&t({code:1103,msg:"screen sharing plugin inaccessible"})):(o.audio={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e.streamId}},o.video.mandatory=o.video.mandatory||{},o.video.mandatory.chromeMediaSource="desktop",o.video.mandatory.chromeMediaSourceId=e.streamId,o.video.height&&(o.video.mandatory.maxHeight=o.video.mandatory.minHeight=o.video.height,delete o.video.height),o.video.width&&(o.video.mandatory.maxWidth=o.video.mandatory.minWidth=o.video.width,delete o.video.width),o.video.frameRate&&("object"==typeof o.video.frameRate?(o.video.mandatory.minFrameRate=o.video.frameRate.min,o.video.mandatory.maxFrameRate=o.video.frameRate.max):"number"==typeof o.video.frameRate?(o.video.mandatory.minFrameRate=o.video.frameRate,o.video.mandatory.maxFrameRate=o.video.frameRate):r.Logger.warning("Invalid frame rate value for screen sharing."),delete o.video.frameRate),void g.apply(navigator,[o,a,s]))})}catch(e){"function"==typeof t&&t({code:1103,msg:"screen sharing plugin inaccessible",err:e})}}else d()?navigator.getUserMedia(o,a,s):g.apply(navigator,[o,a,s])}else"function"==typeof t&&t({code:1100,msg:"webrtc support not available"});else{var y="URL for LocalStream is deprecated, please use ExternalStream instead.";"function"==typeof console.warn?console.warn(y):r.Logger.warning(y);var b=new i.LocalStream(e);"function"==typeof t&&t(null,b)}}function h(e,t){if("object"==typeof e&&e.url)if(e.audio||e.video){var n=new i.ExternalStream(e);"function"==typeof t&&t(null,n)}else"function"==typeof t&&t({code:1107,msg:"External stream must have video or audio"});else"function"==typeof t&&t({code:1107,msg:"External stream must have url property"})}t.prototype.close=function(){"function"==typeof this.hide&&this.hide(),this.mediaStream&&this.mediaStream.getTracks().map(function(e){"function"==typeof e.stop&&e.stop()}),this.mediaStream=null,"function"==typeof this.unpublish&&this.unpublish(),this.channel&&"function"==typeof this.channel.close&&this.channel.close()},t.prototype.createObjectURL=function(){return this.mediaStream?(e.URL||webkitURL).createObjectURL(this.mediaStream):""},t.prototype.disableAudio=function(e){var t=this;if(t.hasAudio()&&t.mediaStream){if(void 0===e&&(e=0),-1===e)return t.mediaStream.getAudioTracks().map(function(e){return!!e.enabled&&(e.enabled=!1,!0)});var n=t.mediaStream.getAudioTracks();if(n&&n[e]&&n[e].enabled)return n[e].enabled=!1,!0}return!1},t.prototype.enableAudio=function(e){var t=this;if(t.hasAudio()&&t.mediaStream){if(void 0===e&&(e=0),-1===e)return t.mediaStream.getAudioTracks().map(function(e){return!0!==e.enabled&&(e.enabled=!0,!0)});var n=t.mediaStream.getAudioTracks();if(n&&n[e]&&!0!==n[e].enabled)return n[e].enabled=!0,!0}return!1},t.prototype.disableVideo=function(e){var t=this;if(t.hasVideo()&&t.mediaStream){if(void 0===e&&(e=0),-1===e)return t.mediaStream.getVideoTracks().map(function(e){return!!e.enabled&&(e.enabled=!1,!0)});var n=t.mediaStream.getVideoTracks();if(n&&n[e]&&n[e].enabled)return n[e].enabled=!1,!0}return!1},t.prototype.enableVideo=function(e){var t=this;if(t.hasVideo()&&t.mediaStream){if(void 0===e&&(e=0),-1===e)return t.mediaStream.getVideoTracks().map(function(e){return!0!==e.enabled&&(e.enabled=!0,!0)});var n=t.mediaStream.getVideoTracks();if(n&&n[e]&&!0!==n[e].enabled)return n[e].enabled=!0,!0}return!1},t.prototype.updateConfiguration=function(e,t){if(void 0!==e)return this.channel?void this.channel.updateSpec(e,t):"This stream has not been published, ignoring"},n.prototype=Object.create(t.prototype),o.prototype=Object.create(t.prototype),a.prototype=Object.create(o.prototype),s.prototype=Object.create({}),n.prototype.constructor=n,o.prototype.constructor=o,a.prototype.constructor=a,s.prototype.constructor=s;var m={true:{},unspecified:{},sif:p(320,240),vga:p(640,480),hd720p:p(1280,720),hd1080p:p(1920,1080)},g=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;n.create=function(){f.apply(this,arguments)},s.create=function(){h.apply(this,arguments)},i.Stream=t,i.LocalStream=n,i.RemoteStream=o,i.RemoteMixedStream=a,i.ExternalStream=s}(),function(){function t(){var e=arguments[0];if("function"==typeof e){var t=Array.prototype.slice.call(arguments,1);e.apply(null,t)}}function n(e){e.session_id=i.sessionId+=1;var t={};if(t.browser=p(),"mozilla"===t.browser)r.Logger.debug("Firefox Stack"),t=o.FirefoxStack(e);else if("bowser"===t.browser)r.Logger.debug("Bowser Stack"),t=o.BowserStack(e);else if("chrome-stable"===t.browser)r.Logger.debug("Stable!"),t=o.ChromeStableStack(e);else{if("edge"!==t.browser)throw r.Logger.debug("None!"),"WebRTC stack not available";r.Logger.debug("Edge Stack"),t=o.EdgeORTCStack(e)}return t.updateSpec||(t.updateSpec=function(e,t){r.Logger.error("Update Configuration not implemented in this browser"),t&&t("unimplemented")}),t}function a(e){if(!e.video)return new i.RemoteStream(e);switch(e.video.device){case"mcu":return new i.RemoteMixedStream(e);default:return new i.RemoteStream(e)}}function s(e,t,n){if(!e||!e.connected)return n("socket not ready");try{e.emit(t,function(e,t){return"success"===e?n(null,t):n(t||"response error")})}catch(e){n("socket emit error")}}function c(e,t,n,i){if(!e||!e.connected)return i("socket not ready");try{e.emit(t,n,function(e,t){return"success"===e?i(null,t):i(t||"response error")})}catch(e){i("socket emit error")}}function d(e,t,n,i,r){if(!e||!e.connected)return r("error","socket not ready");try{e.emit(t,n,i,function(e,t){r(e,t)})}catch(e){r("error","socket emit error")}}function u(e,n,i,r,o){c(e,"customMessage",{type:"control",payload:{action:n,streamId:i}},function(e,n){return e?t(o,e):void t(r,n)})}function l(e,n,r,o,a,s){if(!(r instanceof i.Stream||r instanceof i.ExternalStream))return t(s,"Invalid stream");if(!Array.isArray(o))return t(s,"Target streams is not a list");var d,u,l=[];for(d=0;d<o.length;d++){if(!((u=o[d])instanceof i.RemoteMixedStream))return t(s,"Invalid stream found in targetStreams.");l.push(u.id())}c(n,e,{streamId:r.id(),mixStreams:l},function(e){return e?t(s,e):void t(a,null)})}i.sessionId=103;var p=function(){var t="none";return null!==e.navigator.userAgent.match("Firefox")?t="mozilla":null!==e.navigator.userAgent.match("Bowser")?t="bowser":null!==e.navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?t="edge":null!==e.navigator.userAgent.match("Chrome")?e.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]>=26&&(t="chrome-stable"):null!==e.navigator.userAgent.match("Safari")?t="bowser":null!==e.navigator.userAgent.match("WebKit")&&(t="bowser"),t},f=function(e){this.internalDispatcher=i.EventDispatcher({}),this.spec=e||{},this.remoteStreams={},this.localStreams={},this.state=0};(f.prototype=i.EventDispatcher({})).setIceServers=function(){var e=this.spec;return e.userSetIceServers=[],Array.prototype.slice.call(arguments,0).map(function(t){t instanceof Array?t.map(function(t){"object"==typeof t&&null!==t?"string"==typeof t.urls&&""!==t.urls||t.urls instanceof Array?e.userSetIceServers.push(t):"string"==typeof t.url&&""!==t.url&&(t.urls=t.url,delete t.url,e.userSetIceServers.push(t)):"string"==typeof t&&""!==t&&e.userSetIceServers.push({urls:t})}):"object"==typeof t&&null!==t?"string"==typeof t.urls&&""!==t.urls||t.urls instanceof Array?e.userSetIceServers.push(t):"string"==typeof t.url&&""!==t.url&&(t.urls=t.url,delete t.url,e.userSetIceServers.push(t)):"string"==typeof t&&""!==t&&e.userSetIceServers.push({urls:t})}),e.userSetIceServers},f.prototype.getIceServers=function(){return this.spec.userSetIceServers},f.prototype.join=function(e,n,o){var s;try{s=JSON.parse(r.Base64.decodeBase64(e))}catch(e){return t(o,"invalid token")}var c=this,d=!0===s.secure,u=s.host;if("string"!=typeof u)return t(o,"invalid host");if(-1===u.indexOf("http")&&(u=d?"https://"+u:"http://"+u),0!==c.state)return t(o,"connection state invalid");c.state=1,void 0!==c.socket?c.socket.connect():(c.socket=io.connect(u,{reconnect:!1,secure:d,"force new connection":!0}),c.socket.on("add_stream",function(e){if(void 0===c.remoteStreams[e.id]){var t=a({video:e.video,audio:e.audio,id:e.id,from:e.from,attributes:e.attributes,viewport:e.view}),n=new i.StreamEvent({type:"stream-added",stream:t});c.remoteStreams[e.id]=t,c.dispatchEvent(n)}else r.Logger.warning("stream already added:",e.id)}),c.socket.on("update_stream",function(e){var t=c.remoteStreams[e.id];t&&t.emit(e.event,e.data)}),c.socket.on("remove_stream",function(e){var t=c.remoteStreams[e.id];if(t){t.close(),delete c.remoteStreams[e.id];var n=new i.StreamEvent({type:"stream-removed",stream:t});c.dispatchEvent(n)}}),c.socket.on("signaling_message_erizo",function(e){var t;(t=e.peerId?c.remoteStreams[e.peerId]:c.localStreams[e.streamId])&&t.channel&&t.channel.processSignalingMessage(e.mess)}),c.socket.on("add_recorder",function(e){var t=new i.RecorderEvent({type:"recorder-added",id:e.id});c.dispatchEvent(t)}),c.socket.on("reuse_recorder",function(e){var t=new i.RecorderEvent({type:"recorder-continued",id:e.id});c.dispatchEvent(t)}),c.socket.on("remove_recorder",function(e){var t=new i.RecorderEvent({type:"recorder-removed",id:e.id});c.dispatchEvent(t)}),c.socket.on("disconnect",function(){var e=!1;0!==c.state?(e=!0,r.Logger.info("Will trigger server-disconnect")):r.Logger.info("Will not trigger server-disconnect"),c.state=0,c.myId=null;var t,n;for(t in c.remoteStreams)c.remoteStreams.hasOwnProperty(t)&&((n=c.remoteStreams[t]).close(),delete c.remoteStreams[t]);for(t in c.localStreams)c.localStreams.hasOwnProperty(t)&&((n=c.localStreams[t]).channel&&"function"==typeof n.channel.close&&n.channel.close(),delete c.localStreams[t]);try{c.socket.disconnect()}catch(e){}if(e){var o=new i.ClientEvent({type:"server-disconnected"});c.dispatchEvent(o)}}),c.socket.on("user_join",function(e){var t=new i.ClientEvent({type:"user-joined",user:e.user});c.dispatchEvent(t)}),c.socket.on("user_leave",function(e){var t=new i.ClientEvent({type:"user-left",user:e.user});c.dispatchEvent(t)}),c.socket.on("custom_message",function(e){var t=new i.MessageEvent({type:"message-received",msg:e});c.dispatchEvent(t)}),c.socket.on("connect_failed",function(e){t(o,e||"connection_failed")}),c.socket.on("error",function(e){t(o,e||"connection_error")}),c.socket.on("connection_failed",function(e){if(r.Logger.error("MCU reports connection failed for stream: "+e.streamId),void 0!==c.localStreams[e.streamId]){var t=c.localStreams[e.streamId];c.unpublish(t),delete c.localStreams[e.streamId]}else c.unsubscribe(c.remoteStreams[e.streamId]);if(0!==c.state){var n=new i.StreamEvent({type:"stream-failed"});c.dispatchEvent(n)}}),c.socket.on("stream-publish",function(e){var t=c.localStreams[e.id];t&&(console.log("Stream published"),c.dispatchEvent(new i.StreamEvent({type:"stream-published",stream:t})))}));try{var l={token:e,userAgent:i.Common.sysInfo()};c.socket.emit("login",l,function(e,i){if("success"===e){c.myId=i.clientId,c.conferenceId=i.id,c.state=2;var r=[];c.conferenceId=i.id,void 0!==i.streams&&(r=i.streams.map(function(e){return e.viewport=e.view,c.remoteStreams[e.id]=a(e),c.remoteStreams[e.id]}));var s;if(void 0!==i.users)for(var d=0;d<i.users.length;d++)if(i.users[d].id===i.clientId){s=i.users[d];break}return t(n,{streams:r,users:i.users,self:s})}return t(o,i||"response error")})}catch(e){t(o,"socket emit error")}},f.prototype.publish=function(e,o,a,s){var l=this;if(e=e||{},"function"==typeof o?(s=a,a=o):"object"==typeof o&&null!==o||(o={}),!(e instanceof i.LocalStream||e instanceof i.ExternalStream)||("object"!=typeof e.mediaStream||null===e.mediaStream)&&void 0===e.url())return t(s,"invalid stream");if(o.videoCodec=o.videoCodec||"h264",void 0!==l.localStreams[e.id()])return t(s,"already published");var p=e.toJson();return!0===o.unmix&&(p.unmix=!0),void 0!==e.url()?(p.state="url",p.transport=o.transport,p.bufferSize=o.bufferSize,void d(l.socket,"publish",p,e.url(),function(n,i){return"success"!==n?t(s,"error"===n?i:n):(e.id=function(){return i},e.unpublish=function(t,n){l.unpublish(e,t,n)},l.localStreams[i]=e,void t(a,e))})):(p.state="erizo",void d(l.socket,"publish",p,void 0,function(i,p){if("error"===i)return t(s,p);if("timeout"===i)return t(s,i);e.id=function(){return p},l.localStreams[p]=e,e.channel=n({callback:function(e){console.log("Sending message",e),d(l.socket,"signaling_message",{streamId:p,msg:e},void 0,function(){})},video:e.hasVideo(),audio:e.hasAudio(),iceServers:l.getIceServers(),maxAudioBW:o.maxAudioBW,maxVideoBW:o.maxVideoBW,audioCodec:o.audioCodec,videoCodec:o.videoCodec});var f=function(){e.signalOnPlayAudio=function(e,t){u(l.socket,"audio-out-on",p,e,t)},e.signalOnPauseAudio=function(e,t){u(l.socket,"audio-out-off",p,e,t)},e.signalOnPlayVideo=function(e,t){u(l.socket,"video-out-on",p,e,t)},e.signalOnPauseVideo=function(e,t){u(l.socket,"video-out-off",p,e,t)},e.unpublish=function(t,n){l.unpublish(e,t,n)},t(a,e),s=function(){},f=function(){}},h=function(){c(l.socket,"unpublish",p,function(){},function(){}),e.channel.close(),e.channel=void 0,t(s,"peer connection failed"),f=function(){},h=function(){}};e.channel.oniceconnectionstatechange=function(e){switch(e){case"completed":case"connected":f();break;case"checking":case"closed":break;case"failed":h();break;default:r.Logger.warning("unknown ice connection state:",e)}},e.channel.addStream(e.mediaStream),e.channel.createOffer(!1)}))},f.prototype.unpublish=function(e,n,r){var o=this;return e instanceof i.LocalStream||e instanceof i.ExternalStream?void c(o.socket,"unpublish",e.id(),function(i){return e.channel&&"function"==typeof e.channel.close&&(e.channel.close(),e.channel=null),delete o.localStreams[e.id()],e.id=function(){return null},e.signalOnPlayAudio=void 0,e.signalOnPauseAudio=void 0,e.signalOnPlayVideo=void 0,e.signalOnPauseVideo=void 0,delete e.unpublish,i?t(r,i):void t(n,null)}):t(r,"invalid stream")},f.prototype.subscribe=function(e,o,a,s){var l=this,f=!1,h=!1;return"function"==typeof o?(s=a,a=o,o={}):"object"==typeof o&&null!==o||(o={}),e instanceof i.RemoteStream?!1===o.audio&&!1===o.video?t(s,"no audio or video to subscribe."):(o.videoCodec=o.videoCodec||"h264",e.isMixed()||"object"!=typeof o.video||!o.video.resolution&&!o.video.qualityLevel?("object"==typeof o.video&&o.video.qualityLevel&&(o.video.quality_level=o.video.qualityLevel,delete o.video.qualityLevel),void d(l.socket,"subscribe",{streamId:e.id(),audio:e.hasAudio()&&!1!==o.audio,video:e.hasVideo()&&o.video,browser:p()},void 0,function(i,p){if("error"===i||"timeout"===i)return t(s,p||i);e.channel=n({callback:function(t){d(l.socket,"signaling_message",{streamId:e.id(),msg:t,browser:e.channel.browser},void 0,function(){})},audio:e.hasAudio()&&!1!==o.audio,video:e.hasVideo()&&!1!==o.video,iceServers:l.getIceServers(),videoCodec:o.videoCodec}),e.channel.onaddstream=function(n){e.mediaStream=n.stream,h&&!1===f?(f=!0,t(a,e)):f=!0};var m=function(){e.signalOnPlayAudio=function(t,n){u(l.socket,"audio-in-on",e.id(),t,n)},e.signalOnPauseAudio=function(t,n){u(l.socket,"audio-in-off",e.id(),t,n)},e.signalOnPlayVideo=function(t,n){u(l.socket,"video-in-on",e.id(),t,n)},e.signalOnPauseVideo=function(t,n){u(l.socket,"video-in-off",e.id(),t,n)},f&&!1===h?(h=!0,t(a,e)):h=!0,s=function(){},m=function(){}},g=function(){c(l.socket,"unsubscribe",e.id(),function(){},function(){}),e.close(),e.signalOnPlayAudio=void 0,e.signalOnPauseAudio=void 0,e.signalOnPlayVideo=void 0,e.signalOnPauseVideo=void 0,t(s,"peer connection failed"),m=function(){},g=function(){}};e.channel.oniceconnectionstatechange=function(e){switch(e){case"completed":case"connected":m();break;case"checking":case"closed":break;case"failed":g();break;default:r.Logger.warning("unknown ice connection state:",e)}},e.channel.createOffer(!0)})):t(s,"Resolution and quality level settings are not available for non-mixed stream.")):t(s,"invalid stream")},f.prototype.unsubscribe=function(e,n,r){var o=this;return e instanceof i.RemoteStream?void c(o.socket,"unsubscribe",e.id(),function(i,o){return i?t(r,i):(e.close(),e.signalOnPlayAudio=void 0,e.signalOnPauseAudio=void 0,e.signalOnPlayVideo=void 0,e.signalOnPauseVideo=void 0,void t(n,o))}):t(r,"invalid stream")},f.prototype.onMessage=function(e){"function"==typeof e&&this.on("message-received",e)},i.ConferenceClient=function(){"use strict";var e=function(e){f.call(this,e),this.join=function(e,t,n){f.prototype.join.call(this,e,t,n)},this.leave=function(){s(this.socket,"logout",function(e){e&&r.Logger.warning("Server returns error for logout event")}),this.socket.disconnect()},this.send=function(e,n,i,r){if(void 0===e||null===e||"function"==typeof e)return t(r,"nothing to send");if(void 0===n)n="all";else if("string"==typeof n);else{if("function"!=typeof n)return t(r,"invalid receiver");r=i,i=n,n="all"}c(this.socket,"customMessage",{type:"data",data:e,receiver:n},function(e,n){return e?t(r,e):void t(i,n)})},this.mix=function(e,t,n,i){return l("mix",this.socket,e,t,n,i)},this.unmix=function(e,t,n,i){return l("unmix",this.socket,e,t,n,i)},this.shareScreen=function(e,n,o){r.Logger.warning("shareScreen is deprecated, please create a LocalStream and publish it to specific conference.");var a=this;"function"==typeof e&&(o=n,n=e,e={}),e=e||{},i.LocalStream.create({video:{device:"screen",extensionId:e.extensionId,resolution:e.resolution?e.resolution:{width:screen.width,height:screen.height},frameRate:e.frameRate},audio:!1},function(i,r){return i?t(o,i):void a.publish(r,{maxVideoBW:e.maxVideoBW,videoCodec:e.videoCodec},function(e){t(n,e)},function(e){t(o,e)})})},this.playAudio=function(e,t,n){return e instanceof i.Stream&&e.hasAudio()&&"function"==typeof e.signalOnPlayAudio?e.signalOnPlayAudio(t,n):void("function"==typeof n&&n("unable to call playAudio"))},this.pauseAudio=function(e,t,n){return e instanceof i.Stream&&e.hasAudio()&&"function"==typeof e.signalOnPauseAudio?e.signalOnPauseAudio(t,n):void("function"==typeof n&&n("unable to call pauseAudio"))},this.playVideo=function(e,t,n){return e instanceof i.Stream&&e.hasVideo()&&"function"==typeof e.signalOnPlayVideo?e.signalOnPlayVideo(t,n):void("function"==typeof n&&n("unable to call playVideo"))},this.pauseVideo=function(e,t,n){return e instanceof i.Stream&&e.hasVideo()&&"function"==typeof e.signalOnPauseVideo?e.signalOnPauseVideo(t,n):void("function"==typeof n&&n("unable to call pauseVideo"))},this.addExternalOutput=function(e,n,i,r){var o=this;"function"==typeof n?(r=i,i=n,n={}):"object"==typeof n&&null!==n||(n={}),n.url=e,n.video&&n.video.resolution&&(n.resolution=n.video.resolution),c(o.socket,"addExternalOutput",n,function(e){return e?t(r,e):void t(i)})},this.updateExternalOutput=function(e,n,i,r){var o=this;"function"==typeof n?(r=i,i=n,n={}):"object"==typeof n&&null!==n||(n={}),n.url=e,n.video&&n.video.resolution&&(n.resolution=n.video.resolution),c(o.socket,"updateExternalOutput",n,function(e){return e?t(r,e):void t(i)})},this.removeExternalOutput=function(e,n,i){var r=this;return"string"!=typeof e?void t(i,"URL should be string."):void c(r.socket,"removeExternalOutput",{url:e},function(e){return e?t(i,e):void t(n)})},this.startRecorder=function(e,n,i){var r=this;"function"==typeof e?(i=n,n=e,e={}):"object"==typeof e&&null!==e||(e={}),c(r.socket,"startRecorder",e,function(e,r){return e?t(i,e):void t(n,r)})},this.stopRecorder=function(e,n,i){var r=this;"function"==typeof e?(i=n,n=e,e={}):"object"==typeof e&&null!==e||(e={}),c(r.socket,"stopRecorder",e,function(e,r){return e?t(i,e):void t(n,r)})},this.getRegion=function(e,n,i){var r=this;if("object"!=typeof e||null===e||"string"!=typeof e.id||""===e.id)return t(i,"invalid options");var o={id:e.id,mixStreamId:e.mixedStreamId};c(r.socket,"getRegion",o,function(e,r){return e?t(i,e):void t(n,r)})},this.setRegion=function(e,n,i){var r=this;if("object"!=typeof e||null===e||"string"!=typeof e.id||""===e.id||"string"!=typeof e.region||""===e.region)return t(i,"invalid options");var o={id:e.id,region:e.region,mixStreamId:e.mixedStreamId};c(r.socket,"setRegion",o,function(e,r){return e?t(i,e):void t(n,r)})},this.setVideoBitrate=function(e,n,i){var r=this;"function"==typeof e?(i=n,n=e,e={}):"object"==typeof e&&null!==e||(e={}),c(r.socket,"setVideoBitrate",e,function(e,r){return e?t(i,e):void t(n,r)})},this.getConnectionStats=function(e,n,i){e&&e.channel&&"function"==typeof e.channel.getConnectionStats?e.channel.getConnectionStats(function(e){t(n,e)},function(e){t(i,e)}):t(i,"invalid stream.")},this.mute=function(e,n,r,o){e instanceof i.Stream||t(o,"Invalid stream"),void 0!==n&&"audio"!==n&&"video"!==n&&t(o,"Invalid track kind.");var a=n||"av";c(this.socket,"mute",{streamId:e.id(),track:a},function(e){return e?t(o,e):void t(r)})},this.unmute=function(e,n,r,o){e instanceof i.Stream||t(o,"Invalid stream"),void 0!==n&&"audio"!==n&&"video"!==n&&t(o,"Invalid track kind.");var a=n||"av";c(this.socket,"unmute",{streamId:e.id(),track:a},function(e){return e?t(o,e):void t(r)})}};return e.prototype=Object.create(f.prototype),e.prototype.constructor=e,e.create=function(t){return new e(t)},e}(),i.SipClient=function(){var e=function(e){f.call(this,e),this.sip=!0,this.join=function(e,t,n){e.host=this.spec.host,e.secure=this.spec.secure,e=r.Base64.encodeBase64(JSON.stringify(e)),f.prototype.join.call(this,e,t,n)},this.subscribe=function(e,t,n,r){var o=this;"function"==typeof t?(r=n,n=t,t={}):"object"==typeof t&&null!==t||(t={});f.prototype.subscribe.call(this,e,t,function(e){o.dispatchEvent(new i.StreamEvent({type:"stream-subscribed",stream:e})),n(e)},r)},this.acceptCall=function(e,n){var i={type:"acceptCall"};c(this.socket,"customMessage",i,function(i,r){return i?t(n,i):void t(e,r)})},this.rejectCall=function(e,n){var i={type:"rejectCall"};c(this.socket,"customMessage",i,function(i,r){return i?t(n,i):void t(e,r)})},this.hangupCall=function(e,n){var i={type:"hangupCall"};c(this.socket,"customMessage",i,function(i,r){return i?t(n,i):void t(e,r)})},this.makeCall=function(e,n,i){var r={type:"makeCall",payload:e};c(this.socket,"customMessage",r,function(e,r){return e?t(i,e):void t(n,r)})}};return e.prototype=Object.create(f.prototype),e.prototype.constructor=e,e.create=function(t){return new e(t)},e}()}(),o.ChromeStableStack=function(e){"use strict";var t={},n=RTCPeerConnection;t.pc_config={iceServers:[]},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array&&(t.pc_config.iceServers=e.iceServers),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}};var o=function(e){console.log("Error in Stack ",e)};t.peerConnection=new n(t.pc_config,t.con);var a=function(t){var n,i;return e.video&&e.maxVideoBW&&(t=t.replace(/b=AS:.*\r\n/g,""),null==(n=t.match(/m=video.*\r\n/))&&(n=t.match(/m=video.*\n/)),n&&n.length>0&&(i=n[0]+"b=AS:"+e.maxVideoBW+"\r\n",t=t.replace(n[0],i))),e.audio&&e.maxAudioBW&&(null==(n=t.match(/m=audio.*\r\n/))&&(n=t.match(/m=audio.*\n/)),n&&n.length>0&&(i=n[0]+"b=AS:"+e.maxAudioBW+"\r\n",t=t.replace(n[0],i))),t},s=function(t){return e.audioCodec?i.Common.setPreferredCodec(t,"audio",e.audioCodec):t},c=function(t){return e.videoCodec?i.Common.setPreferredCodec(t,"video",e.videoCodec):t},d=function(e){var t=s(e);return t=c(t)};t.close=function(){t.state="closed","closed"!==t.peerConnection.signalingState&&t.peerConnection.close()},e.localCandidates=[],t.peerConnection.onicecandidate=function(t){if(t.candidate){t.candidate.candidate.match(/a=/)||(t.candidate.candidate="a="+t.candidate.candidate);var n={sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid,candidate:t.candidate.candidate};e.remoteDescriptionSet?e.callback({type:"candidate",candidate:n}):(e.localCandidates.push(n),r.Logger.info("Storing candidate: ",e.localCandidates.length,n))}else console.log("End of candidates.")},t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)};var u,l,p=function(n){n.sdp=a(n.sdp),n.sdp=d(n.sdp.replace(/a=ice-options:google-ice\r\n/g,"")),e.callback({type:n.type,sdp:n.sdp}),u=n,t.peerConnection.setLocalDescription(n)},f=function(n){n.sdp=a(n.sdp),e.callback({type:n.type,sdp:n.sdp}),u=n,t.peerConnection.setLocalDescription(n)};return t.updateSpec=function(n,i){(n.maxVideoBW||n.maxAudioBW)&&(n.maxVideoBW&&(console.log("Maxvideo Requested",n.maxVideoBW),e.maxVideoBW=n.maxVideoBW),n.maxAudioBW&&(console.log("Maxaudio Requested",n.maxAudioBW),e.maxAudioBW=n.maxAudioBW),u.sdp=a(u.sdp),t.peerConnection.setLocalDescription(u,function(){l.sdp=a(l.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(l),function(){e.remoteDescriptionSet=!0,i&&i("success")})}))},t.createOffer=function(e){!0===e?t.peerConnection.createOffer(p,o,t.mediaConstraints):t.peerConnection.createOffer(p,o)},t.iceRestart=function(){var n={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,iceRestart:!0};t.peerConnection.createOffer(p,o,n)},t.addStream=function(e){t.peerConnection.addStream(e)},e.remoteCandidates=[],e.remoteDescriptionSet=!1,t.processSignalingMessage=function(n){if("offer"===n.type)n.sdp=a(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n),function(){t.peerConnection.createAnswer(f,function(e){r.Logger.error("Error: ",e)},t.mediaConstraints),e.remoteDescriptionSet=!0},function(e){r.Logger.error("Error setting Remote Description",e)});else if("answer"===n.type)console.log("Set remote and local description",n.sdp),n.sdp=a(n.sdp),l=n,t.peerConnection.setRemoteDescription(new RTCSessionDescription(n),function(){for(e.remoteDescriptionSet=!0,console.log("Candidates to be added: ",e.remoteCandidates.length,e.remoteCandidates);e.remoteCandidates.length>0;)t.peerConnection.addIceCandidate(e.remoteCandidates.shift());for(console.log("Local candidates to send:",e.localCandidates.length);e.localCandidates.length>0;)e.callback({type:"candidate",candidate:e.localCandidates.shift()})});else if("candidate"===n.type)try{var i;(i="object"==typeof n.candidate?n.candidate:JSON.parse(n.candidate)).candidate=i.candidate.replace(/a=/g,""),i.sdpMLineIndex=parseInt(i.sdpMLineIndex,10);var o=new RTCIceCandidate(i);e.remoteDescriptionSet?t.peerConnection.addIceCandidate(o):(e.remoteCandidates.push(o),console.log("Candidates stored: ",e.remoteCandidates.length,e.remoteCandidates))}catch(e){r.Logger.error("Error parsing candidate",n.candidate)}},t.getConnectionStats=function(e,n){t.peerConnection.getStats(null,function(t){e(i.Common.parseStats(t))},n)},t},o.FirefoxStack=function(e){"use strict";var t={},n=mozRTCPeerConnection,o=mozRTCSessionDescription,a=mozRTCIceCandidate;t.pc_config={iceServers:[]},e.iceServers instanceof Array&&(t.pc_config.iceServers=e.iceServers),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,mozDontOfferDataChannel:!0};var s=function(e){r.Logger.error("Error in Stack ",e)},c=!1;t.peerConnection=new n(t.pc_config),e.localCandidates=[],t.peerConnection.onicecandidate=function(t){t.candidate?(c=!0,t.candidate.candidate.match(/a=/)||(t.candidate.candidate="a="+t.candidate.candidate),e.remoteDescriptionSet?e.callback({type:"candidate",candidate:t.candidate}):(e.localCandidates.push(t.candidate),console.log("Local Candidates stored: ",e.localCandidates.length,e.localCandidates))):console.log("End of candidates.")};var d=function(t){return e.audioCodec?i.Common.setPreferredCodec(t,"audio",e.audioCodec):t},u=function(t){return e.videoCodec?i.Common.setPreferredCodec(t,"video",e.videoCodec):t},l=function(e){var t=d(e);return t=u(t)};t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)};var p,f=function(t){var n,i;return e.video&&e.maxVideoBW&&(null==(n=t.match(/m=video.*\r\n/))&&(n=t.match(/m=video.*\n/)),n&&n.length>0&&(i=n[0]+"b=AS:"+e.maxVideoBW+"\r\n",t=t.replace(n[0],i))),e.audio&&e.maxAudioBW&&(null==(n=t.match(/m=audio.*\r\n/))&&(n=t.match(/m=audio.*\n/)),n&&n.length>0&&(i=n[0]+"b=AS:"+e.maxAudioBW+"\r\n",t=t.replace(n[0],i))),t},h=function(t){t.sdp=f(t.sdp),t.sdp=l(t.sdp.replace(/a=ice-options:google-ice\r\n/g,"")),e.callback(t),p=t},m=function(n){n.sdp=f(n.sdp),n.sdp=n.sdp.replace(/a=ice-options:google-ice\r\n/g,""),e.callback(n),p=n,t.peerConnection.setLocalDescription(p)};return t.createOffer=function(e){!0===e?t.peerConnection.createOffer(h,s,t.mediaConstraints):t.peerConnection.createOffer(h,s)},t.addStream=function(e){t.peerConnection.addStream(e)},e.remoteCandidates=[],e.remoteDescriptionSet=!1,t.close=function(){t.state="closed","closed"!==t.peerConnection.signalingState&&t.peerConnection.close()},t.iceRestart=function(){var n={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,iceRestart:!0};t.peerConnection.createOffer(h,s,n)},t.processSignalingMessage=function(n){if("offer"===n.type)n.sdp=f(n.sdp),t.peerConnection.setRemoteDescription(new o(n),function(){t.peerConnection.createAnswer(m,function(e){r.Logger.error("Error",e)},t.mediaConstraints),e.remoteDescriptionSet=!0},function(e){r.Logger.error("Error setting Remote Description",e)});else if("answer"===n.type)console.log("Set remote and local description",n.sdp),n.sdp=f(n.sdp),t.peerConnection.setLocalDescription(p,function(){t.peerConnection.setRemoteDescription(new o(n),function(){for(e.remoteDescriptionSet=!0,r.Logger.info("Remote Description successfully set");e.remoteCandidates.length>0&&c;)r.Logger.info("Setting stored remote candidates"),t.peerConnection.addIceCandidate(e.remoteCandidates.shift());for(;e.localCandidates.length>0;)r.Logger.info("Sending Candidate from list"),e.callback({type:"candidate",candidate:e.localCandidates.shift()})},function(e){r.Logger.error("Error Setting Remote Description",e)})},function(e){r.Logger.error("Failure setting Local Description",e)});else if("candidate"===n.type)try{var i;(i="object"==typeof n.candidate?n.candidate:JSON.parse(n.candidate)).candidate=i.candidate.replace(/ generation 0/g,""),i.candidate=i.candidate.replace(/ udp /g," UDP "),i.sdpMLineIndex=parseInt(i.sdpMLineIndex,10);var s=new a(i);if(e.remoteDescriptionSet&&c)for(t.peerConnection.addIceCandidate(s);e.remoteCandidates.length>0;)r.Logger.info("Setting stored remote candidates"),t.peerConnection.addIceCandidate(e.remoteCandidates.shift());else e.remoteCandidates.push(s)}catch(e){r.Logger.error("Error parsing candidate",n.candidate,e)}},t.getConnectionStats=function(e,n){t.peerConnection.getStats(null,function(t){e(i.Common.parseStats(t))},n)},t},o.EdgeORTCStack=function(t){"use strict";var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1]}return n},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},n.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)t=i[r].trim().split("="),n[t[0].trim()]=t[1];return n},n.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach(function(t){i.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+" "+e.parameter+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},n.getDtlsParameters=function(e,t){var i=n.splitLines(e),r=(i=i.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:r.split(" ")[0],value:r.split(" ")[1]}]}},n.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},n.getIceParameters=function(e,t){var i=n.splitLines(e);return{usernameFragment:(i=i.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=n.splitLines(e)[0].split(" "),r=3;r<i.length;r++){var o=i[r],a=n.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=n.parseRtpMap(a),c=n.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?n.parseFmtp(c[0]):{},s.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var i="";return i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){i+=n.writeRtpMap(e),i+=n.writeFmtp(e),i+=n.writeRtcpFb(e)}),i+="a=rtcp-mux\r\n"},n.parseRtpEncodingParameters=function(e){var t,i=[],r=n.parseRtpParameters(e),o=-1!==r.fecMechanisms.indexOf("RED"),a=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),r.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{payloadType:e.payloadType,ssrc:t}};i.push(n),o&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},i.push(n))}}),0===i.length&&c&&i.push({ssrc:c});var u=n.matchPrefix(e,"b=");return u.length&&(0===u[0].indexOf("b=TIAS:")?u=parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")&&(u=parseInt(u[0].substr(5),10)),i.forEach(function(e){e.maxBitrate=u})),i},n.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,i,r){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n"},n.getDirection=function(e,t){for(var i=n.splitLines(e),r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substr(2)}return t?n.getDirection(t):"sendrecv"},e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}));var i={};i.pc_config={iceServers:[]},t.iceServers instanceof Array&&(i.pc_config.iceServers=t.iceServers),void 0===t.audio&&(t.audio=!0),void 0===t.video&&(t.video=!0),e.RTCPeerConnection=function(e){var t=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers){var i=JSON.parse(JSON.stringify(e.iceServers));this.iceOptions.iceServers=i.filter(function(e){if(e&&e.urls){var t=e.urls;return"string"==typeof t&&(t=[t]),!!(t=t.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")})[0])}return!1})}this.transceivers=[],this._localIceCandidatesBuffer=[]},e.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},e.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},e.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},e.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},e.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=n.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){if(!n.candidate||0===Object.keys(n.candidate).length)for(var i=1;i<t.length;i++)-1===t[i].indexOf("\r\na=end-of-candidates\r\n")&&(t[i]+="a=end-of-candidates\r\n");else-1===n.candidate.candidate.indexOf("typ endOfCandidates")&&(t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n");e.localDescription.sdp=t.join(""),null!==e.dispatchEvent&&e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),n.candidate||"complete"===e.iceGatheringState||e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&(e.iceGatheringState="complete")}),this._localIceCandidatesBuffer=[]},e.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var i=0;i<t.codecs.length;i++){var r=t.codecs[i];if(e.name.toLowerCase()===r.name.toLowerCase()&&e.clockRate===r.clockRate&&e.numChannels===r.numChannels){n.codecs.push(r);break}}}),e.headerExtensions.forEach(function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}}),n},e.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(t,i){var r=this,o=new e.RTCIceGatherer(r.iceOptions),a=new e.RTCIceTransport(o);o.onlocalcandidate=function(e){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:i};var c=e.candidate,d=!c||0===Object.keys(c).length;d?(void 0===o.state&&(o.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(c.component="RTCP"===a.component?2:1,s.candidate.candidate=n.writeCandidate(c));var u=n.splitSections(r.localDescription.sdp);-1===s.candidate.candidate.indexOf("typ endOfCandidates")?u[s.candidate.sdpMLineIndex+1]+="a="+s.candidate.candidate+"\r\n":u[s.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",r.localDescription.sdp=u.join("");var l=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(r.iceGatheringState){case"new":r._localIceCandidatesBuffer.push(s),d&&l&&r._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":r._emitBufferedCandidates(),null!==r.dispatchEvent&&r.dispatchEvent(s),null!==r.onicecandidate&&r.onicecandidate(s),l&&(null!==r.dispatchEvent&&r.dispatchEvent(new Event("icecandidate")),null!==r.onicecandidate&&r.onicecandidate(new Event("icecandidate")),r.iceGatheringState="complete")}},a.onicestatechange=function(){r._updateConnectionState()};var s=new e.RTCDtlsTransport(a);return s.ondtlsstatechange=function(){r._updateConnectionState()},s.onerror=function(){r._updateConnectionState()},{iceGatherer:o,iceTransport:a,dtlsTransport:s}},e.RTCPeerConnection.prototype._transceive=function(e,t,i){var r=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={cname:n.localCName},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),i&&e.rtpReceiver&&(r.encodings=e.recvEncodingParameters,r.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},e.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");null!==this.dispatchEvent&&this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},e.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");null!==this.dispatchEvent&&this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},e.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var i=new Event("iceconnectionstatechange");null!==this.dispatchEvent&&this.dispatchEvent(i),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(e)}},e.RTCPeerConnection.prototype.setLocalDescription=function(t){var i,r,o=this;if("offer"===t.type)this._pendingOffer&&(i=n.splitSections(t.sdp),r=i.shift(),i.forEach(function(e,t){var i=n.parseRtpParameters(e);o._pendingOffer[t].localCapabilities=i}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===t.type){i=n.splitSections(o.remoteDescription.sdp),r=i.shift();var a=n.matchPrefix(r,"a=ice-lite").length>0;i.forEach(function(e,t){var i=o.transceivers[t],s=i.iceGatherer,c=i.iceTransport,d=i.dtlsTransport,u=i.localCapabilities,l=i.remoteCapabilities;if(!("0"===e.split("\n",1)[0].split(" ",2)[1])){var p=n.getIceParameters(e,r);if(a){var f=n.matchPrefix(e,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return"1"===e.component});f.length&&c.setRemoteCandidates(f)}var h=n.getDtlsParameters(e,r);a&&(h.role="server"),h.role="client",o.usingBundle&&0!==t||(c.start(s,p,a?"controlling":"controlled"),d.start(h));var m=o._getCommonCapabilities(u,l);o._transceive(i,m.codecs.length>0,!1)}})}switch(this.localDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}var s=arguments.length>1&&"function"==typeof arguments[1];if(s){var c=arguments[1];e.setTimeout(function(){c(),"new"===o.iceGatheringState&&(o.iceGatheringState="gathering"),o._emitBufferedCandidates()},0)}var d=e.Promise.resolve();return d.then(function(){s||("new"===o.iceGatheringState&&(o.iceGatheringState="gathering"),e.setTimeout(o._emitBufferedCandidates.bind(o),500))}),d},e.RTCPeerConnection.prototype.setRemoteDescription=function(t){var i=this,r=new e.MediaStream,o=[],a=n.splitSections(t.sdp),s=a.shift(),c=n.matchPrefix(s,"a=ice-lite").length>0;switch(this.usingBundle=n.matchPrefix(s,"a=group:BUNDLE ").length>0,a.forEach(function(a,d){var u,l,p,f,h,m,g,v,y,b,S,C,w=n.splitLines(a)[0].substr(2).split(" "),k=w[0],E="0"===w[1],T=n.getDirection(a,s),A=n.parseRtpParameters(a);E||(S=n.getIceParameters(a,s),C=n.getDtlsParameters(a,s),C.role="client"),C.role="client",v=n.parseRtpEncodingParameters(a);var R=n.matchPrefix(a,"a=mid:");R=R.length?R[0].substr(6):n.generateIdentifier();var _,x=n.matchPrefix(a,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];x&&(_=x.value);var P=n.matchPrefix(a,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return"1"===e.component});if(P.push({}),"offer"!==t.type||E)"answer"!==t.type||E||(u=i.transceivers[d],l=u.iceGatherer,p=u.iceTransport,f=u.dtlsTransport,h=u.rtpSender,m=u.rtpReceiver,g=u.sendEncodingParameters,y=u.localCapabilities,i.transceivers[d].recvEncodingParameters=v,i.transceivers[d].remoteCapabilities=A,i.transceivers[d].cname=_,(c||!0)&&P.length&&p.setRemoteCandidates(P),i.usingBundle&&0!==d||(p.start(l,S,"controlling"),f.start(C)),i._transceive(u,"sendrecv"===T||"recvonly"===T,"sendrecv"===T||"sendonly"===T),!m||"sendrecv"!==T&&"sendonly"!==T?delete u.rtpReceiver:(b=m.track,o.push([b,m]),r.addTrack(b)));else{var O=i.usingBundle&&d>0?{iceGatherer:i.transceivers[0].iceGatherer,iceTransport:i.transceivers[0].iceTransport,dtlsTransport:i.transceivers[0].dtlsTransport}:i._createIceAndDtlsTransports(R,d);if(O.iceTransport.setRemoteCandidates(P),y=e.RTCRtpReceiver.getCapabilities(k),g=[{ssrc:1001*(2*d+2)}],m=new e.RTCRtpReceiver(O.dtlsTransport,k),b=m.track,o.push([b,m]),r.addTrack(b),i.localStreams.length>0&&i.localStreams[0].getTracks().length>=d){var L;"audio"===k?L=i.localStreams[0].getAudioTracks()[0]:"video"===k&&(L=i.localStreams[0].getVideoTracks()[0]),L&&(h=new e.RTCRtpSender(L,O.dtlsTransport))}i.transceivers[d]={iceGatherer:O.iceGatherer,iceTransport:O.iceTransport,dtlsTransport:O.dtlsTransport,localCapabilities:y,remoteCapabilities:A,rtpSender:h,rtpReceiver:m,kind:k,mid:R,cname:_,sendEncodingParameters:g,recvEncodingParameters:v},i._transceive(i.transceivers[d],!1,"sendrecv"===T||"sendonly"===T)}}),this.remoteDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}return r.getTracks().length&&(i.remoteStreams.push(r),e.setTimeout(function(){var t=new Event("addstream");t.stream=r,null!==i.dispatchEvent&&i.dispatchEvent(t),null!==i.onaddstream&&e.setTimeout(function(){i.onaddstream(t)},0),o.forEach(function(n){var o=n[0],a=n[1],s=new Event("track");s.track=o,s.receiver=a,s.streams=[r],null!==i.dispatchEvent&&i.dispatchEvent(t),null!==i.ontrack&&e.setTimeout(function(){i.ontrack(s)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&e.setTimeout(arguments[1],0),e.Promise.resolve()},e.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},e.RTCPeerConnection.prototype.createOffer=function(){var t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var i;1===arguments.length&&"function"!=typeof arguments[0]?i=arguments[0]:3===arguments.length&&(i=arguments[2]);var r=[],o=0,a=0;if(this.localStreams.length&&(o=this.localStreams[0].getAudioTracks().length,a=this.localStreams[0].getVideoTracks().length),i){if(i.mandatory||i.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==i.offerToReceiveAudio&&(o=i.offerToReceiveAudio),void 0!==i.offerToReceiveVideo&&(a=i.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){r.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?o>0:a>0}),"audio"===e.kind?o--:"video"===e.kind&&a--});o>0||a>0;)o>0&&(r.push({kind:"audio",wantReceive:!0}),o--),a>0&&(r.push({kind:"video",wantReceive:!0}),a--);var s=n.writeSessionBoilerplate(),c=[];r.forEach(function(i,r){var o,a,s=i.track,d=i.kind,u=n.generateIdentifier(),l=t.usingBundle&&r>0?{iceGatherer:c[0].iceGatherer,iceTransport:c[0].iceTransport,dtlsTransport:c[0].dtlsTransport}:t._createIceAndDtlsTransports(u,r),p=e.RTCRtpSender.getCapabilities(d),f=[{ssrc:1001*(2*r+1)}];s&&(o=new e.RTCRtpSender(s,l.dtlsTransport)),i.wantReceive&&(a=new e.RTCRtpReceiver(l.dtlsTransport,d)),c[r]={iceGatherer:l.iceGatherer,iceTransport:l.iceTransport,dtlsTransport:l.dtlsTransport,localCapabilities:p,remoteCapabilities:null,rtpSender:o,rtpReceiver:a,kind:d,mid:u,sendEncodingParameters:f,recvEncodingParameters:null}}),this.usingBundle&&(s+="a=group:BUNDLE "+c.map(function(e){return e.mid}).join(" ")+"\r\n"),r.forEach(function(e,i){var r=c[i];s+=n.writeMediaSection(r,r.localCapabilities,"offer",t.localStreams[0])}),this._pendingOffer=c;var d=new RTCSessionDescription({type:"offer",sdp:s});return arguments.length&&"function"==typeof arguments[0]&&e.setTimeout(arguments[0],0,d),e.Promise.resolve(d)},e.RTCPeerConnection.prototype.createAnswer=function(){var t=this,i=n.writeSessionBoilerplate();this.usingBundle&&(i+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(e){var r=t._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);i+=n.writeMediaSection(e,r,"answer",t.localStreams[0])});var r=new RTCSessionDescription({type:"answer",sdp:i});return arguments.length&&"function"==typeof arguments[0]&&e.setTimeout(arguments[0],0,r),e.Promise.resolve(r)},e.RTCPeerConnection.prototype.addIceCandidate=function(t){if(null===t)this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});else{var i=t.sdpMLineIndex;if(t.sdpMid)for(var r=0;r<this.transceivers.length;r++)if(this.transceivers[r].mid===t.sdpMid){i=r;break}var o=this.transceivers[i];if(o){var a=Object.keys(t.candidate).length>0?n.parseCandidate(t.candidate):{};if("tcp"===a.protocol&&0===a.port)return;if("1"!==a.component)return;"endOfCandidates"===a.type&&(a={}),o.iceTransport.addRemoteCandidate(a);var s=n.splitSections(this.remoteDescription.sdp);s[i+1]+=(a.type?t.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=s.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&e.setTimeout(arguments[1],0),e.Promise.resolve()},i.mediaConstraints={offerToReceiveVideo:t.video,offerToReceiveAudio:t.audio};var o,a=function(e){r.Logger.error("Error in Edge Stack ",e)},s=function(e){if("H264"!==t.videoCodec&&"h264"!==t.videoCodec)return e;try{var n=e.match(/m=video.*\r\n/g)[0],i=n.replace(/\s120/,"").replace("\r\n","")+" 120\r\n";return e.replace(n,i)}catch(t){return e}},c=function(e){return s(e)},d=function(e){var n,i;return t.video&&t.maxVideoBW&&(null==(n=e.match(/m=video.*\r\n/))&&(n=e.match(/m=video.*\n/)),n&&n.length>0&&(i=n[0]+"b=AS:"+t.maxVideoBW+"\r\n",e=e.replace(n[0],i))),t.audio&&t.maxAudioBW&&(null==(n=e.match(/m=audio.*\r\n/))&&(n=e.match(/m=audio.*\n/)),n&&n.length>0&&(i=n[0]+"b=AS:"+t.maxAudioBW+"\r\n",e=e.replace(n[0],i))),e},u=function(e){e.sdp=d(e.sdp),e.sdp=c(e.sdp.replace(/a=ice-options:google-ice\r\n/g,"")),t.callback(e),o=e},l=function(e){e.sdp=d(e.sdp),e.sdp=e.sdp.replace(/a=ice-options:google-ice\r\n/g,""),t.callback(e),o=e,i.peerConnection.setLocalDescription(o)};return i.peerConnection=new e.RTCPeerConnection(i.pc_config),t.localCandidates=[],t.remoteCandidates=[],t.remoteDescriptionSet=!1,i.peerConnection.onicecandidate=function(e){if(e.candidate){e.candidate.candidate.match(/a=/)||(e.candidate.candidate="a="+e.candidate.candidate);var n={sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid,candidate:e.candidate.candidate};t.remoteDescriptionSet?t.callback({type:"candidate",candidate:n}):t.localCandidates.push(n)}else t.localCandidates.push({candidate:{}}),console.log("End of candidates.")},i.peerConnection.onaddstream=function(e){i.onaddstream&&i.onaddstream(e)},i.peerConnection.onremovestream=function(e){i.onremovestream&&i.onremovestream(e)},i.peerConnection.oniceconnectionstatechange=function(e){i.oniceconnectionstatechange&&i.oniceconnectionstatechange(e)},i.createOffer=function(e){!0===e?i.peerConnection.createOffer(u,a,i.mediaConstraints):i.peerConnection.createOffer(u,a)},i.addStream=function(e){i.peerConnection.addStream(e)},i.processSignalingMessage=function(e){if(r.Logger.debug("Process Signaling Message",e.type),"offer"===e.type)e.sdp=d(e.sdp),console.log("Set offer description \n",e.sdp),i.peerConnection.setRemoteDescription(new RTCSessionDescription(e),function(){i.peerConnection.createAnswer(l,function(e){r.Logger.error("Error",e)},i.mediaConstraints),t.remoteDescriptionSet=!0},function(e){r.Logger.error("Error setting Remote Description",e)});else if("answer"===e.type)console.log("Set remote description",e.sdp),e.sdp=d(e.sdp),i.peerConnection.setLocalDescription(o,function(){i.peerConnection.setRemoteDescription(new RTCSessionDescription(e),function(){for(t.remoteDescriptionSet=!0,r.Logger.info("Remote Description successfully set");t.remoteCandidates.length>0;)i.peerConnection.addIceCandidate(t.remoteCandidates.shift());for(;t.localCandidates.length>0;)t.callback({type:"candidate",candidate:t.localCandidates.shift()})},function(e){r.Logger.error("Failure Setting Remote Description",e)})},function(e){r.Logger.error("Failure Setting Local Description",e)});else if("candidate"===e.type)try{var n;(n="object"==typeof e.candidate?e.candidate:JSON.parse(e.candidate)).candidate=n.candidate.replace(/a=/g,""),n.sdpMLineIndex=parseInt(n.sdpMLineIndex,10);var a=new RTCIceCandidate(n);if(t.remoteDescriptionSet)for(i.peerConnection.addIceCandidate(a);t.remoteCandidates.length>0;)r.Logger.info("Setting stored remote candidates"),i.peerConnection.addIceCandidate(t.remoteCandidates.shift());else t.remoteCandidates.push(a)}catch(t){r.Logger.error("Error parsing candidate",e.candidate,t)}},i.close=function(){i.state="closed","closed"!==i.peerConnection.signalingState&&i.peerConnection.close()},i.getConnectionStats=function(e,t){t("getConnectionStats is not supported on Edge.")},i.iceRestart=function(){r.Logger.error("ICE restart on Edge is not supported yet.")},i},(i=i||{}).Error={STREAM_LOCAL_ACCESS_DENIED:{code:1101,message:"Cannot access to camera or micphone."},P2P_CONN_SERVER_UNKNOWN:{code:2100,message:"Server unknown error."},P2P_CONN_SERVER_UNAVAILABLE:{code:2101,message:"Server is unavaliable."},P2P_CONN_SERVER_BUSY:{code:2102,message:"Server is too busy."},P2P_CONN_SERVER_NOT_SUPPORTED:{code:2103,message:"Method has not been supported by server"},P2P_CONN_CLIENT_UNKNOWN:{code:2110,message:"Client unknown error."},P2P_CONN_CLIENT_NOT_INITIALIZED:{code:2111,message:"Connection is not initialized."},P2P_CONN_AUTH_UNKNOWN:{code:2120,message:"Authentication unknown error."},P2P_CONN_AUTH_FAILED:{code:2121,message:"Wrong username or token."},P2P_MESSAGING_TARGET_UNREACHABLE:{code:2201,message:"Remote user cannot be reached."},P2P_CHATROOM_ATTENDEE_EXCEED:{code:2301,message:"Exceed room's limitation"},P2P_CHATROOM_PEER_NOT_FOUND:{code:2302,message:"Peer not found. Only one client in the room."},P2P_CLIENT_UNKNOWN:{code:2400,message:"Unknown errors."},P2P_CLIENT_UNSUPPORTED_METHOD:{code:2401,message:"This method is unsupported in current browser."},P2P_CLIENT_ILLEGAL_ARGUMENT:{code:2402,message:"Illegal argument."},P2P_CLIENT_INVALID_STATE:{code:2403,message:"Invalid peer state."},getErrorByCode:function(e){return{1101:i.Error.STREAM_LOCAL_ACCESS_DENIED,2100:i.Error.P2P_CONN_SERVER_UNKNOWN,2101:i.Error.P2P_CONN_SERVER_UNAVAILABLE,2102:i.Error.P2P_CONN_SERVER_BUSY,2103:i.Error.P2P_CONN_SERVER_NOT_SUPPORTED,2110:i.Error.P2P_CONN_CLIENT_UNKNOWN,2111:i.Error.P2P_CONN_CLIENT_NOT_INITIALIZED,2120:i.Error.P2P_CONN_AUTH_UNKNOWN,2121:i.Error.P2P_CONN_AUTH_FAILED,2201:i.Error.P2P_MESSAGING_TARGET_UNREACHABLE,2301:i.Error.P2P_CHATROOM_ATTENDEE_EXCEED,2302:i.Error.P2P_CHATROOM_PEER_NOT_FOUND,2400:i.Error.P2P_CLIENT_UNKNOWN,2401:i.Error.P2P_CLIENT_UNSUPPORTED_METHOD,2402:i.Error.P2P_CLIENT_ILLEGAL_ARGUMENT,2403:i.Error.P2P_CLIENT_INVALID_STATE}[e]}},(i=i||{}).PeerClient=function(t){"use strict";var o,a,s=i.EventDispatcher({}),c={READY:1,MATCHED:2,OFFERED:3,PENDING:4,CONNECTING:5,CONNECTED:6,ERROR:9},d={READY:1,REQUESTED:2,ACCEPTED:3,NEGOTIATING:4},u={MESSAGE:"message",FILE:"file"},l={READY:1,CONNECTING:2,CONNECTED:3},p=l.READY,f=t,h=function(e){return"[object Array]"===Object.prototype.toString.call(e)},m=null,g={},v={},y=null,b=!1,S={},C={optional:[{DtlsSrtpKeyAgreement:"true"}]},w={offerToReceiveAudio:!0,offerToReceiveVideo:!0},k=null,E=i.Common.sysInfo(),T=!navigator.mozGetUserMedia,A=!!navigator.mozGetUserMedia;t&&(k={iceServers:t.iceServers});var R=function(e,t){return e.localeCompare(t)},_=function(e){return e},x=function(e,t){e.negotiationState=t},P=function(e,t){e.state!==c.CONNECTED&&e.state!==c.CONNECTING||(e.sendDataChannel&&e.sendDataChannel.close(),e.receiveDataChannel&&e.receiveDataChannel.close(),e.connection&&"closed"!==e.connection.iceConnectionState&&e.connection.close(),e.state!==c.READY&&(e.state=c.READY,s.dispatchEvent(new i.ChatEvent({type:"chat-stopped",peerId:e.id,senderId:t}))),ie(e.connection))},O=function(e,t){t.sdk&&t.sdk&&"JavaScript"===t.sdk.type&&t.runtime&&"FireFox"===t.runtime.name?(e.remoteSideSupportsRemoveStream=!1,e.remoteSideSupportsPlanB=!1,e.remoteSideSupportsUnifiedPlan=!0,e.preferredVideoCodec="vp8"):(e.remoteSideSupportsRemoveStream=!0,e.remoteSideSupportsPlanB=!0,e.remoteSideSupportsUnifiedPlan=!1)},L=function(){b=!0,p=l.CONNECTED},N=function(){a&&a(),o=void 0,a=void 0},I=function(){b=!1,p=l.READY,s.dispatchEvent(new i.ClientEvent({type:"server-disconnected"}))},D=function(e,t){var n=g[e];n||(ce(e),n=g[e]),O(n,t),n.state===c.READY||n.state===c.PENDING?(g[e].state=c.PENDING,s.dispatchEvent(new i.ChatEvent({type:"chat-invited",senderId:e}))):n.state===c.OFFERED&&R(y,e)<0&&(n.state=c.PENDING,le(e,function(){s.dispatchEvent(new i.ChatEvent({type:"chat-accepted",senderId:e}))}))},M=function(e){var t=g[e];t&&t.connection&&(t.sendDataChannel&&t.sendDataChannel.close(),t.receiveDataChannel&&t.receiveDataChannel.close(),t.connection.close()),delete g[e],s.dispatchEvent(new i.ChatEvent({type:"chat-denied",senderId:e}))},B=function(e,t){r.Logger.debug("Received chat accepted.");var n=g[e];n&&(n.state=c.MATCHED,O(n,t),ne(n),n.state=c.CONNECTING,oe(n.id),s.dispatchEvent(new i.ChatEvent({type:"chat-accepted",senderId:e})))},j=function(e){var t=g[e];t&&t.connection&&P(t,e),delete g[e]},U=function(e,t){var n=g[t];n&&n.state===c.CONNECTING&&(n.connection||ne(n)),Z(n,e)},V=function(e,t){v[e.streamId]=e.type,r.Logger.debug("remote stream ID:"+e.streamId+",type:"+v[e.streamId])},F=function(e){y=e,o&&o(e),o=void 0,a=void 0},G=function(){ke()},z=function(e){r.Logger.debug("On negotiation needed."),e.isCaller&&"stable"===e.connection.signalingState&&e.negotiationState===d.READY?se(e):!e.isCaller&&m?m.sendNegotiationNeeded(e.id):e.isNegotiationNeeded=!0},W=function(e,t){t.candidate&&m&&m.sendSignalMessage(e.id,{type:"candidates",candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex})},q=function(e,t){if(e&&r.Logger.debug("On remote ice candidate from peer "+e.id),e&&(e.state===c.OFFERED||e.state===c.CONNECTING||e.state===c.CONNECTED)){var n=new RTCIceCandidate({candidate:t.message.candidate,sdpMid:t.message.sdpMid,sdpMLineIndex:t.message.sdpMLineIndex});e.connection?(r.Logger.debug("Add remote ice candidates."),e.connection.addIceCandidate(n,$,ee)):(r.Logger.debug("Cache remote ice candidates."),e.remoteIceCandidates||(e.remoteIceCandidates=[]),e.remoteIceCandidates.push(n))}},H=function(e,t){if(e)switch(e.state){case c.OFFERED:case c.MATCHED:e.state=c.CONNECTING,ne(e);case c.CONNECTING:case c.CONNECTED:r.Logger.debug("About to set remote description. Signaling state: "+e.connection.signalingState);var n=new RTCSessionDescription(t.message);n.sdp=Oe(n.sdp),e.connection.setRemoteDescription(n,function(){ve(e),fe(e)},function(e){r.Logger.debug("Set remote description failed. Message: "+JSON.stringify(e))});break;default:r.Logger.debug("Unexpected peer state: "+e.state)}else r.Logger.debug('"peer" cannot be null or undefined')},J=function(e,t){if(e&&(e.state===c.CONNECTING||e.state===c.CONNECTED)){r.Logger.debug("About to set remote description. Signaling state: "+e.connection.signalingState);var n=new RTCSessionDescription(t.message);n.sdp=Oe(n.sdp),e.connection.setRemoteDescription(new RTCSessionDescription(n),function(){r.Logger.debug("Set remote descripiton successfully."),fe(e),me(e)},function(e){r.Logger.debug("Set remote description failed. Message: "+e)})}},Q=function(e,t){var n=v[e.id];if(n){var r={};"screen"===n?r.video={device:"screen"}:(r.video=e.getVideoTracks().length>0&&{device:"camera"},r.audio=e.getAudioTracks().length>0);var o=new i.RemoteStream(r);return o.mediaStream=e,o.from=t.id,o.id=function(){return e.id},o}return null},K=function(e,t){r.Logger.debug("Remote stream added.");var n=Q(t.stream,e);if(n){var o=new i.StreamEvent({type:"stream-added",senderId:e.id,stream:n});s.dispatchEvent(o)}},Y=function(e,t){r.Logger.debug("Remote stream removed.");var n=Q(t.stream,e);if(n){var o=new i.StreamEvent({type:"stream-removed",stream:n});s.dispatchEvent(o)}},Z=function(e,t){r.Logger.debug("S->C: "+JSON.stringify(t)),"offer"===t.type?H(e,{message:t}):"answer"===t.type?J(e,{message:t}):"candidates"===t.type&&q(e,{message:t})},X=function(e,t){e&&(r.Logger.debug("Ice connection state changed. State: "+e.connection.iceConnectionState),"closed"!==e.connection.iceConnectionState&&"failed"!==e.connection.iceConnectionState||e.state!==c.CONNECTED||(P(e,e.id),m&&m.sendChatStopped(e.id),delete g[e.id]),"connected"!==e.connection.iceConnectionState&&"completed"!==e.connection.iceConnectionState||(e.lastDisconnect=new Date("2099/12/31").getTime(),e.state!==c.CONNECTED&&(e.state=c.CONNECTED,s.dispatchEvent(new i.ChatEvent({type:"chat-started",peerId:e.id})))),"checking"===e.connection.iceConnectionState&&(e.lastDisconnect=new Date("2099/12/31").getTime()),"disconnected"===e.connection.iceConnectionState&&(e.lastDisconnect=(new Date).getTime(),setTimeout(function(){(new Date).getTime()-e.lastDisconnect>=15e3&&(r.Logger.debug("Disconnect timeout."),P(e,e.id),e===g[e.id]&&delete g[e.id])},15e3)))},$=function(){r.Logger.debug("Add ice candidate success.")},ee=function(e){r.Logger.debug("Add ice candidate failed. Error: "+e)},te=function(e){r.Logger.debug("Signaling state changed: "+e.connection.signalingState),"closed"===e.connection.signalingState?(P(e,e.id),delete g[e.id]):"stable"===e.connection.signalingState&&(x(e,d.READY),e.isCaller&&e.isNegotiationNeeded&&m?se(e):he(e))},ne=function(e){if(!e||e.connection)return!0;try{e.connection=new RTCPeerConnection(k,C),e.connection.onicecandidate=function(t){W(e,t)},e.connection.onaddstream=function(t){K(e,t)},e.connection.onremovestream=function(t){Y(e,t)},e.connection.oniceconnectionstatechange=function(t){X(e)},e.connection.onnegotiationneeded=function(){z(g[e.id])},e.connection.onsignalingstatechange=function(){te(e)},e.connection.ondatachannel=function(t){r.Logger.debug(y+": On data channel"),e.dataChannels[t.channel.label]||(e.dataChannels[t.channel.label]=t.channel,r.Logger.debug("Save remote created data channel.")),re(t.channel,e)}}catch(e){return r.Logger.debug("Failed to create PeerConnection, exception: "+e.message),!1}return!0},ie=function(e){e.onicecandidate=void 0,e.onaddstream=void 0,e.onremovestream=void 0,e.oniceconnectionstatechange=void 0,e.onnegotiationneeded=void 0,e.onsignalingstatechange=void 0},re=function(e,t){e.onmessage=function(e){Te(t,e)},e.onopen=function(e){Ae(t,e)},e.onclose=function(e){Re(t,e)},e.onerror=function(e){r.Logger.debug("Data Channel Error:",e)}},oe=function(e,t){t||(t=u.MESSAGE),ae(_(e),t)},ae=function(e,t){var n=g[e];if(n&&!n.dataChannels[t]){r.Logger.debug("Do create data channel.");try{var i=n.connection.createDataChannel(t,null);re(i,n),n.dataChannels[u.MESSAGE]=i}catch(e){r.Logger.error("Failed to create SendDataChannel, exception: "+e.message)}}},se=function(e){r.Logger.debug("Do renegotiation."),x(e,d.NEGOTIATING),pe(e)},ce=function(e){return g[e]||(g[e]={state:c.READY,id:e,pendingStreams:[],pendingUnpublishStreams:[],remoteIceCandidates:[],dataChannels:{},pendingMessages:[],negotiationState:d.READY,lastDisconnect:new Date("2099/12/31").getTime(),publishedStreams:[],isCaller:!0,remoteSideSupportsRemoveStream:!1,remoteSideSupportsPlanB:!1,remoteSideSupportsUnifiedPlan:!1}),g[e]},de=function(e){var t=g[e];r.Logger.debug(y+": Remote side needs negotiation."),t&&(t.isCaller&&"stable"===t.connection.signalingState&&t.negotiationState===d.READY?se(t):(t.isNegotiationNeeded=!0,r.Logger.error("Should not receive negotiation needed request because user is callee.")))},ue=function(e,t,n){if(m)if(e!==y){g[e]||ce(e);var o=g[e];o.state===c.READY||o.state===c.OFFERED?(r.Logger.debug("Send invitation to "+e),o.state=c.OFFERED,m.sendChatInvitation(e,E,function(){t&&t()},function(e){o.state=c.READY,n&&n(i.Error.getErrorByCode(e))})):(r.Logger.debug("Invalid state. Will not send invitation."),n&&n(i.Error.P2P_CLIENT_INVALID_STATE))}else n&&n(i.Error.P2P_CLIENT_ILLEGAL_ARGUMENT);else n&&n(i.Error.P2P_CONN_CLIENT_NOT_INITIALIZED)},le=function(e,t,n){!m&&n&&n(i.Error.P2P_CONN_CLIENT_NOT_INITIALIZED),g[e]||ce(e);var o=g[e];o.isCaller=!1,o.state===c.PENDING?(o.state=c.MATCHED,m.sendChatAccepted(e,E,t,function(e){o.state=c.PENDING,n&&n(i.Error.getErrorByCode(e))})):(r.Logger.debug("Invalid state. Will not send acceptance."),n&&n(i.Error.P2P_CLIENT_INVALID_STATE))},pe=function(e){return e.connection?"stable"!==e.connection.signalingState?void x(e,d.NEGOTIATING):(he(e),e.isNegotiationNeeded=!1,void e.connection.createOffer(function(t){t.sdp=Le(t.sdp,e),e.connection.setLocalDescription(t,function(){r.Logger.debug("Set local descripiton successfully."),x(e,d.READY),m&&m.sendSignalMessage(e.id,t)},function(e){r.Logger.debug("Set local description failed. Message: "+JSON.stringify(e))})},function(e){r.Logger.debug("Create offer failed. Error info: "+JSON.stringify(e))},w)):void r.Logger.error("Peer connection have not been created.")},fe=function(e){if(e&&e.connection&&e.remoteIceCandidates&&0!==e.remoteIceCandidates.length){for(var t=0;t<e.remoteIceCandidates.length;t++)r.Logger.debug("remoteIce, length:"+remoteIceCandidates.length+", current:"+t),e.state!==c.CONNECTED&&e.state!==c.CONNECTING||e.connection.addIceCandidate(remoteIceCandidates[t],$,ee);e.remoteIceCandidates=[]}},he=function(e){if(r.Logger.debug("Draining pending streams."),e.connection){r.Logger.debug("Peer connection is ready for draining pending streams.");for(var t=0;t<e.pendingStreams.length;t++){var n=e.pendingStreams[t];e.pendingStreams.shift(),n.mediaStream&&(ge(n,e),n.onClose||(n.onClose=function(){_e(n)}),e.connection.addStream(n.mediaStream),r.Logger.debug("Added stream to peer connection."),we(n,e),r.Logger.debug("Sent stream type."))}e.pendingStreams=[];for(var i=0;i<e.pendingUnpublishStreams.length;i++)e.pendingUnpublishStreams[i].mediaStream&&(e.connection.removeStream(e.pendingUnpublishStreams[i].mediaStream),r.Logger.debug("Remove stream."));e.pendingUnpublishStreams=[]}},me=function(e){r.Logger.debug("Draining pendding messages.");var t=e.dataChannels[u.MESSAGE];if(t&&"closed"!==t.readyState){for(var n=0;n<e.pendingMessages.length;n++)t.send(e.pendingMessages[n]);e.pendingMessages=[]}},ge=function(e,t){var n=e.id();S[n]||(S[n]=[]),S[n].push(t.id)},ve=function(e){return e.connection?(he(e),e.isNegotiationNeeded=!1,void e.connection.createAnswer(function(t){t.sdp=Le(t.sdp,e),e.connection.setLocalDescription(t,function(){r.Logger.debug("Set local description successfully."),m&&m.sendSignalMessage(e.id,t),r.Logger.debug("Sent answer.")},function(e){r.Logger.error("Error occurred while setting local description. Error message:"+e)})},function(e){r.Logger.error("Create answer failed. Message: "+e)})):void r.Logger.error("Peer connection have not been created.")},ye=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},be=function(e,t,n,r){return e instanceof i.LocalStream&&e.mediaStream&&t?void Se(e,t,n,r):void(r&&r(i.Error.P2P_CLIENT_ILLEGAL_ARGUMENT))},Se=function(e,t,n,o){r.Logger.debug("Publish to: "+t);var a=_(t);if(a){g[a]||ce(a);var s=g[a],d=s.publishedStreams.length+s.pendingStreams.length>0,u=s.remoteSideSupportsUnifiedPlan&&A||s.remoteSideSupportsPlanB&&T;if(d&&!u)return r.Logger.warning("Cannot publish more than one streams if local and remote use different multiple media sources plan."),void(o&&o(i.Error.P2P_CLIENT_UNSUPPORTED_METHOD));switch(s.state){case c.OFFERED:case c.MATCHED:case c.CONNECTING:case c.CONNECTED:break;default:return r.Logger.warning("Cannot publish stream in this state: "+s.state),void(o&&o(i.Error.P2P_CLIENT_INVALID_STATE))}if(ye(s.publishedStreams,e)>-1)o&&o("The stream has been published.");else{switch(s.publishedStreams.push(e),h(e)?s.pendingStreams=s.pendingStreams.concat(e):e&&s.pendingStreams.push(e),s.state){case c.CONNECTING:case c.CONNECTED:s.pendingStreams.length>0&&he(s);break;default:return r.Logger.debug("Unexpected peer state: "+s.state),void(o&&o(i.Error.P2P_CLIENT_INVALID_STATE))}n&&n()}}else o&&o(i.Error.P2P_CLIENT_ILLEGAL_ARGUMENT)},Ce=function(e,t,n,o){if(r.Logger.debug("Unpublish stream."),!(e instanceof i.LocalStream))return r.Logger.warning("Invalid argument stream"),void(o&&o(i.Error.P2P_CLIENT_ILLEGAL_ARGUMENT));var a=_(t);if(a)if(!g[a]||ye(g[a].publishedStreams,e)<0)o&&o(i.Error.P2P_CLIENT_ILLEGAL_ARGUMENT);else{var s=g[a];if(navigator.mozGetUserMedia||!s.remoteSideSupportsRemoveStream)return r.Logger.error("Unpublish is not supported on Firefox."),void(o&&o(i.Error.P2P_CLIENT_UNSUPPORTED_METHOD));var d=ye(s.publishedStreams,e);s.publishedStreams.splice(d,1),s.pendingUnpublishStreams.push(e),s.state===c.CONNECTED&&he(s),n&&n()}else o&&(r.Logger.warning("Invalid argument targetId"),o(i.Error.P2P_CLIENT_ILLEGAL_ARGUMENT))},we=function(e,t){if(null!==e){var n="audio";e.isScreen()?(n="screen",e.hide=function(){r.Logger.debug("Unpublish screen sharing."),Ce(e,t.id)}):e.hasVideo()&&(n="video"),m&&m.sendStreamType(t.id,{streamId:e.mediaStream.id,type:n})}},ke=function(e,t,n){if(m){if(e){var o=g[e];if(!o)return void(n&&(r.Logger.warning("Invalid target ID for stopping chat."),n(i.Error.P2P_CLIENT_ILLEGAL_ARGUMENT)));m.sendChatStopped(o.id),P(o,y),delete g[e]}else{var a=!0;for(var s in g){a=!1;var c=g[s];m.sendChatStopped(c.id),P(c,y),delete g[c.id]}if(a)return void(n&&(r.Logger.warning("No active connections can be stopped."),n(i.Error.P2P_CLIENT_INVALID_STATE)))}t&&t()}else n&&n(i.Error.P2P_CONN_CLIENT_NOT_INITIALIZED)},Ee=function(e,t,n,o){var a=g[t];if(a&&a.state===c.CONNECTED){var s=a.dataChannels[u.MESSAGE];s&&"open"===s.readyState?s.send(e):(a.pendingMessages.push(e),oe(t)),n&&n()}else o&&(r.Logger.error("Invalid peer state."),o(i.Error.P2P_CLIENT_INVALID_STATE))},Te=function(e,t){var n=new i.DataEvent({type:"data-received",senderId:e.id,data:t.data});s.dispatchEvent(n)},Ae=function(e,t){r.Logger.debug("Data Channel is opened"),t.target.label===u.MESSAGE&&(r.Logger.debug("Data channel for messages is opened."),me(e))},Re=function(e){r.Logger.debug("Data Channel for "+e+" is closed.")},_e=function(e){var t=S[e.getID()];if(t)for(var n=0;n<t.length;n++)Ce(e,t[n])},xe=function(e){return f.bandWidth&&f.bandWidth.maxAudioBW?i.Common.setPreferredBitrate(e,"audio",f.bandWidth.maxAudioBW):e},Pe=function(e){return f.bandWidth&&f.bandWidth.maxVideoBW?i.Common.setPreferredBitrate(e,"video",f.bandWidth.maxVideoBW):e},Oe=function(e){return e=xe(e),e=Pe(e)},Le=function(e,t){return e=Ne(e),e=Ie(e,t)},Ne=function(e){return f.audioCodec?e:i.Common.setPreferredCodec(e,"audio",f.audioCodec)},Ie=function(e,t){var n;return n=navigator.mozGetUserMedia?"vp8":t&&t.preferredVideoCodec?t.preferredVideoCodec:f.videoCodec?f.videoCodec:"h264",i.Common.setPreferredCodec(e,"video",n)};return s.connect=function(e,t,o){return p!==l.READY?(r.Logger.warning("Another peer has already connected"),void(o&&o(i.Error.P2P_CLIENT_INVALID_STATE))):(p=l.CONNECTING,m=new n(e),m.onConnected=L,m.onDisconnected=I,m.onConnectFailed=N,m.onChatStopped=j,m.onChatAccepted=B,m.onChatDenied=M,m.onChatInvitation=D,m.onChatSignal=U,m.onStreamType=V,m.onNegotiationNeeded=de,m.onAuthenticated=F,m.onForceDisconnect=G,void m.connect(e,t,o))},s.disconnect=function(e,t){return b?(ke(),m&&m.finalize(),m=null,void(e&&e())):void(t&&t(i.Error.P2P_CLIENT_INVALID_STATE))},s.invite=ue,s.inviteWithStream=function(e,t,n,i){ue(e,function(){be(t,e)},i)},s.publish=be,s.unpublish=Ce,s.deny=function(e,t,n){if(g[e]&&g[e].state===c.PENDING){if(!m&&n)return void n(i.Error.P2P_CONN_CLIENT_NOT_INITIALIZED);m.sendChatDenied(e,t,function(e){n&&n(i.Error.getErrorByCode(e))}),delete g[e]}else n&&n(i.Error.P2P_CLIENT_INVALID_STATE)},s.accept=le,s.acceptWithStream=function(e,t,n,i){le(e,function(){be(t,e)},i)},s.stop=ke,s.send=function(e,t,n,o){return e?e.length>65535?(r.Logger.warning("Message too long. Max size: 65535."),void(o&&o(i.Error.P2P_CLIENT_ILLEGAL_ARGUMENT))):void Ee(e,_(t),n,o):(r.Logger.warning("Message cannot be undefined, null or empty."),void(o&&o(i.Error.P2P_CLIENT_ILLEGAL_ARGUMENT)))},s.getConnectionStats=function(t,n,r){var o=_(t),a=g[o];return a&&a.connection&&a.state===c.CONNECTED?void(n&&a.connection.getStats(null,function(t){n(e.navigator.appVersion.indexOf("Trident")>-1?t:i.Common.parseStats(t))},function(e){r&&r(e)})):void(r&&r("failed to get peerconnection statistics"))},s.getAudioLevels=function(e,t,n){var o=_(e),a=g[o];return a&&a.connection&&a.state===c.CONNECTED||n("Invalid peer connection status."),navigator.mozGetUserMedia?(r.Logger.error("GetAudioLevels is not supported on Firefox."),void(n&&n(i.Error.P2P_CLIENT_UNSUPPORTED_METHOD))):void(t&&a.connection.getStats(function(e){t(i.Common.parseAudioLevel(e))},function(e){n&&n(e)}))},s},e.Erizo=o,e.Woogeen=i,e.L=r}(window),function(e){Erizo.AudioPlayer=function(t){"use strict";var n,i,r=Erizo.View({});return r.id=t.id,r.stream=t.stream.mediaStream,r.elementID=t.elementID,r.stream_url=(e.URL||webkitURL).createObjectURL(r.stream),r.audio=document.createElement("audio"),r.audio.setAttribute("id","stream"+r.id),r.audio.setAttribute("style","width: 100%; height: 100%; position: absolute"),r.audio.setAttribute("autoplay","autoplay"),t.stream instanceof Woogeen.LocalStream&&(r.audio.volume=0),void 0!==r.elementID?(r.destroy=function(){r.audio.pause(),r.parentNode.removeChild(r.div)},n=function(){r.bar.display()},i=function(){r.bar.hide()},r.div=document.createElement("div"),r.div.setAttribute("id","player_"+r.id),r.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),document.getElementById(r.elementID).appendChild(r.div),r.container=document.getElementById(r.elementID),r.parentNode=r.div.parentNode,r.div.appendChild(r.audio),r.bar=new Erizo.Bar({elementID:"player_"+r.id,id:r.id,stream:t.stream,media:r.audio,options:t.options}),r.div.onmouseover=n,r.div.onmouseout=i):(r.destroy=function(){r.audio.pause(),r.parentNode.removeChild(r.audio)},document.body.appendChild(r.audio),r.parentNode=document.body),r.audio.src=r.stream_url,r},Erizo.Bar=function(e){"use strict";var t,n,i=Erizo.View({});return i.elementID=e.elementID,i.id=e.id,i.div=document.createElement("div"),i.div.setAttribute("id","bar_"+i.id),i.bar=document.createElement("div"),i.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)"),i.bar.setAttribute("id","subbar_"+i.id),n=function(e){"block"!==e?e="none":clearTimeout(t),i.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+e)},i.display=function(){n("block")},i.hide=function(){t=setTimeout(n,1e3)},document.getElementById(i.elementID).appendChild(i.div),i.div.appendChild(i.bar),e.stream.screen||void 0!==e.options&&void 0!==e.options.speaker&&!0!==e.options.speaker||(i.speaker=new Erizo.Speaker({elementID:"subbar_"+i.id,id:i.id,stream:e.stream,media:e.media})),i.display(),i.hide(),i},function(){function t(){(new L.ElementQueries).init()}this.L=this.L||{},this.L.ElementQueries=function(){function e(e){e||(e=document.documentElement);var t=getComputedStyle(e,"fontSize");return parseFloat(t)||16}function t(t,n){var i=n.replace(/[0-9]*/,"");switch(n=parseFloat(n),i){case"px":return n;case"em":return n*e(t);case"rem":return n*e();case"vw":return n*document.documentElement.clientWidth/100;case"vh":return n*document.documentElement.clientHeight/100;case"vmin":case"vmax":var r=document.documentElement.clientWidth/100,o=document.documentElement.clientHeight/100;return n*(0,Math["vmin"===i?"min":"max"])(r,o);default:return n}}function n(e){this.element=e,this.options=[];var n,i,r,o,a,s,c,d,u=0,l=0;this.addOption=function(e){this.options.push(e)};var p=["min-width","min-height","max-width","max-height"];this.call=function(){for(u=this.element.offsetWidth,l=this.element.offsetHeight,s={},n=0,i=this.options.length;n<i;n++)r=this.options[n],o=t(this.element,r.value),a="width"==r.property?u:l,d=r.mode+"-"+r.property,c="","min"==r.mode&&a>=o&&(c+=r.value),"max"==r.mode&&a<=o&&(c+=r.value),s[d]||(s[d]=""),c&&-1===(" "+s[d]+" ").indexOf(" "+c+" ")&&(s[d]+=" "+c);for(var e in p)s[p[e]]?this.element.setAttribute(p[e],s[p[e]].substr(1)):this.element.removeAttribute(p[e])}}function i(e,t){e.elementQueriesSetupInformation?e.elementQueriesSetupInformation.addOption(t):(e.elementQueriesSetupInformation=new n(e),e.elementQueriesSetupInformation.addOption(t),new ResizeSensor(e,function(){e.elementQueriesSetupInformation.call()})),e.elementQueriesSetupInformation.call()}function r(e,t,n,r){var o;if(document.querySelectorAll&&(o=document.querySelectorAll.bind(document)),o||"undefined"==typeof $$||(o=$$),o||"undefined"==typeof jQuery||(o=jQuery),!o)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";for(var a=o(e),s=0,c=a.length;s<c;s++)i(a[s],{mode:t,property:n,value:r})}function o(e){var t;for(e=e.replace(/'/g,'"');null!==(t=s.exec(e));)5<t.length&&r(t[1]||t[5],t[2],t[3],t[4])}function a(e){var t="";if(e)if("string"==typeof e)-1===(e=e.toLowerCase()).indexOf("min-width")&&-1===e.indexOf("max-width")||o(e);else for(var n=0,i=e.length;n<i;n++)1===e[n].type?-1!==(t=e[n].selectorText||e[n].cssText).indexOf("min-height")||-1!==t.indexOf("max-height")?o(t):-1===t.indexOf("min-width")&&-1===t.indexOf("max-width")||o(t):4===e[n].type&&a(e[n].cssRules||e[n].rules)}var s=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/gim;this.init=function(){for(var e=0,t=document.styleSheets.length;e<t;e++)a(document.styleSheets[e].cssText||document.styleSheets[e].cssRules||document.styleSheets[e].rules)}},e.addEventListener?e.addEventListener("load",t,!1):e.attachEvent("onload",t),this.L.ResizeSensor=function(t,n){function i(t,n){e.OverflowEvent||(t.addEventListener("overflow",function(e){n.call(this,e)}),t.addEventListener("underflow",function(e){n.call(this,e)}))}function r(){this.q=[],this.add=function(e){this.q.push(e)};var e,t;this.call=function(){for(e=0,t=this.q.length;e<t;e++)this.q[e].call()}}function o(t,n){return t.currentStyle?t.currentStyle[n]:e.getComputedStyle?e.getComputedStyle(t,null).getPropertyValue(n):t.style[n]}function a(e,t){function n(){var t=!1,n=e.resizeSensor.offsetWidth,i=e.resizeSensor.offsetHeight;return c!=n&&(u.width=n-1+"px",l.width=n+1+"px",t=!0,c=n),d!=i&&(u.height=i-1+"px",l.height=i+1+"px",t=!0,d=i),t}if(e.resizedAttached){if(e.resizedAttached)return void e.resizedAttached.add(t)}else e.resizedAttached=new r,e.resizedAttached.add(t);var a=function(){n()&&e.resizedAttached.call()};e.resizeSensor=document.createElement("div"),e.resizeSensor.className="resize-sensor";var s="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;";e.resizeSensor.style.cssText=s,e.resizeSensor.innerHTML='<div class="resize-sensor-overflow" style="'+s+'"><div></div></div><div class="resize-sensor-underflow" style="'+s+'"><div></div></div>',e.appendChild(e.resizeSensor),"absolute"!==o(e,"position")&&(e.style.position="relative");var c=-1,d=-1,u=e.resizeSensor.firstElementChild.firstChild.style,l=e.resizeSensor.lastElementChild.firstChild.style;n(),i(e.resizeSensor,a),i(e.resizeSensor.firstElementChild,a),i(e.resizeSensor.lastElementChild,a)}if("array"==typeof t||"undefined"!=typeof jQuery&&t instanceof jQuery||"undefined"!=typeof Elements&&t instanceof Elements)for(var s=0,c=t.length;s<c;s++)a(t[s],n);else a(t,n)}}(),Erizo.Speaker=function(e){"use strict";var t,n,i,r=Erizo.View({}),o=50;return r.elementID=e.elementID,r.media=e.media,r.id=e.id,r.stream=e.stream,r.div=document.createElement("div"),r.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;"),r.icon=document.createElement("img"),r.icon.setAttribute("id","volume_"+r.id),r.icon.setAttribute("src",Woogeen.Images.sound48),r.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;"),r.div.appendChild(r.icon),r.stream instanceof Woogeen.RemoteStream?(r.picker=document.createElement("input"),r.picker.setAttribute("id","picker_"+r.id),r.picker.type="range",r.picker.min=0,r.picker.max=100,r.picker.step=10,r.picker.value=o,r.picker.orient="vertical",r.div.appendChild(r.picker),r.media.volume=r.picker.value/100,r.media.muted=!1,r.picker.oninput=function(){r.picker.value>0?(r.media.muted=!1,r.icon.setAttribute("src",Woogeen.Images.sound48)):(r.media.muted=!0,r.icon.setAttribute("src",Woogeen.Images.mute48)),r.media.volume=r.picker.value/100},t=function(e){r.picker.setAttribute("style","width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+r.div.offsetHeight+"px; right: 0px; -webkit-appearance: slider-vertical; display: "+e)},n=function(){r.icon.setAttribute("src",Woogeen.Images.mute48),o=r.picker.value,r.picker.value=0,r.media.volume=0,r.media.muted=!0},i=function(){r.icon.setAttribute("src",Woogeen.Images.sound48),r.picker.value=o,r.media.volume=r.picker.value/100,r.media.muted=!1},r.icon.onclick=function(){r.media.muted?i():n()},r.div.onmouseover=function(){t("block")},r.div.onmouseout=function(){t("none")},t("none")):r.stream instanceof Woogeen.LocalStream&&(n=function(){0!=r.stream.mediaStream.getAudioTracks().length&&(r.media.muted=!0,r.icon.setAttribute("src",Woogeen.Images.mute48),r.stream.mediaStream.getAudioTracks()[0].enabled=!1)},i=function(){0!=r.stream.mediaStream.getAudioTracks().length&&(r.media.muted=!1,r.icon.setAttribute("src",Woogeen.Images.sound48),r.stream.mediaStream.getAudioTracks()[0].enabled=!0)},r.icon.onclick=function(){r.media.muted?i():n()}),document.getElementById(r.elementID).appendChild(r.div),r},Erizo.View=function(e){"use strict";var t=Woogeen.EventDispatcher(e);return t.url=e.url||".",t},Erizo.VideoPlayer=function(t){"use strict";var n,i,r=Erizo.View({});r.id=t.id,r.stream=t.stream.mediaStream,r.elementID=t.elementID,n=function(){r.bar.display()},i=function(){r.bar.hide()},r.destroy=function(){r.video.pause(),delete r.resizer,r.parentNode.removeChild(r.div)},r.resize=function(e){var t=r.container.offsetWidth,n=r.container.offsetHeight;e?(r.video.style.width="calc(100% + "+(4/3*n-t)+"px)",r.video.style.height="100%",r.video.style.top="0px",r.video.style.left=-(4/3*n/2-t/2)+"px"):(r.video.style.height="100%",r.video.style.width="100%",r.video.style.left="0px",r.video.style.top="0px"),r.containerWidth=t,r.containerHeight=n},r.stream_url=(e.URL||webkitURL).createObjectURL(r.stream),r.div=document.createElement("div"),r.div.setAttribute("id","player_"+r.id),r.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),r.video=document.createElement("video"),r.video.setAttribute("id","stream"+r.id),r.video.setAttribute("style","width: 100%; height: 100%; position: absolute"),r.video.setAttribute("autoplay","autoplay"),t.stream instanceof Woogeen.LocalStream&&(r.video.volume=0),void 0!==r.elementID?(document.getElementById(r.elementID).appendChild(r.div),r.container=document.getElementById(r.elementID)):(document.body.appendChild(r.div),r.container=document.body);var o=function(){function e(e){var t;for(var i in n)if("function"==typeof e[n[i]]){t=n[i];break}"function"==typeof e[t]&&e[t]()}function t(){"function"==typeof document.exitFullscreen?document.exitFullscreen():"function"==typeof document.webkitExitFullscreen?document.webkitExitFullscreen():"function"==typeof document.mozCancelFullScreen&&document.mozCancelFullScreen()}var n=["requestFullScreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullScreen","oRequestFullScreen"];return function(n){n.offsetWidth==screen.width?t():e(n)}}();return r.parentNode=r.div.parentNode,r.div.appendChild(r.video),r.video.addEventListener("playing",function e(){r.video.videoWidth*r.video.videoHeight>4?L.Logger.debug("video dimensions:",r.video.videoWidth,r.video.videoHeight):setTimeout(e,50)}),r.containerWidth=0,r.containerHeight=0,r.resizer=new L.ResizeSensor(r.container,r.resize),r.resize(),r.div.ondblclick=function(){o(r.video)},r.bar=new Erizo.Bar({elementID:"player_"+r.id,id:r.id,stream:t.stream,media:r.video,options:t.options}),r.div.onmouseover=n,r.div.onmouseout=i,r.video.src=r.stream_url,r},Woogeen.Images={sound48:"data:image/png;base64,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",mute48:"data:image/png;base64,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"},Woogeen.Stream.prototype.show=function(e){"use strict";if(!this.mediaStream||!0===this.showing)return!0===this.showing;"string"!=typeof e&&(e="stream_"+this.id());var t=arguments[1]||{};return this.elementId=e,this.hasVideo()?(this.player=new Erizo.VideoPlayer({id:this.id(),stream:this,elementID:e,options:t}),this.showing=!0):this.hasAudio()&&(this.player=new Erizo.AudioPlayer({id:this.id(),stream:this,elementID:e,options:t}),this.showing=!0),!0===this.showing},Woogeen.Stream.prototype.hide=function(){"use strict";!0===this.showing&&this.player&&"function"==typeof this.player.destroy&&(this.player.destroy(),this.showing=!1)},Woogeen.UI=Woogeen.UI||Object.create({}),Woogeen.UI.attachMediaStream=function(){adapter.browserShim.attachMediaStream.apply(this,arguments)},e.Erizo=Erizo,e.Woogeen=Woogeen,e.L=L}(window);var main_url="ccapi.csslcloud.net";!function(){function e(){this.events={}}function t(e){this.userid=e.userid,this.sessionid=e.sessionid;var t=e.areaCode;t?this.join(t):this.join()}e.prototype={on:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},emit:function(e,t){var n,i,r=this.events[e],o=Array.prototype.slice.call(arguments,1);if(r)for(n=0,i=r.length;n<i;n++)r[n].apply(null,o)},jsonp:function(e){if(e=e||{},e.callback=e.callback||"callback",!e.url||!e.callbackName)throw new Error("params is illegal!");e.beforeSend&&e.beforeSend();var t=(e.callbackName+Math.random()).replace(".","");e.data[e.callback]=t;var n=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(e.data);window[t]=function(n){i.removeChild(r),clearTimeout(r.timer),window[t]=null,e.success&&e.success(n)};var i=document.getElementsByTagName("head")[0],r=document.createElement("script");i.appendChild(r),r.src=e.url+"?"+n,e.time&&(r.timer=setTimeout(function(){window[t]=null,i.removeChild(r),e.error&&e.error({message:"over time"})},e.time))},ajax:function(e){function t(e,t){document.cookie=e+"="+escape(t)+"; expires=Fri, 31 Dec 9999 23:59:59 GMT"}function n(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):null}function i(){return(new Date).getTime().toString().substring(5)}var r=function(){if(n("client_id"))return n("client_id");var e=i();return t("client_id",e),e}();(e=e||{}).type=(e.type||"GET").toUpperCase(),e.dataType=e.dataType||"json",e.async=e.async||!0;var o,a=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(e.data);(o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){if(4===o.readyState){var t=o.status;t>=200&&t<300?e.success&&e.success(o.responseText,o.responseXML):e.fail&&e.fail(t)}},"GET"===e.type?(o.open("GET",e.url+"?"+a,e.async),o.send(null)):"POST"===e.type&&(o.open("POST",e.url,e.async),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.setRequestHeader("ClientID",r),o.send(a))}},(t.prototype=new e).join=function(e){if(1===n.connect)console.log("不能重复登录");else{var t=this;if(e)var i={userid:t.userid,sessionid:t.sessionid,isp:e};else i={userid:t.userid,sessionid:t.sessionid};this.ajax({url:"https://"+main_url+"/api/room/join",type:"POST",data:i,dataType:"json",async:!1,success:function(e){if("FAIL"===(e=JSON.parse(e)).result)throw t.emit("login_failed",e.errorMsg),new Error(e.errorMsg);var i=e.data;t.socket_address=i.chart_server[0],t.socket_spare_address=i.chart_server[1],t.viewerid=i.user.id,t.name=i.user.name,t.roomid=i.user.roomid,t.videoMode=i.video_mode,t.startTime=i.live.startTime?i.live.startTime:0,t.userRole=i.user.role,t.extUrl=i.rtspurl;var o=i.live.atlas_token;r.user||(t.socket_init(),r.user=!0),n.reconnect||(n.init(t),n.reconnect=!0),a.roomOptions.isFollow=i.is_follow,a.roomOptions.classTpye=i.class_type,a.roomOptions.maxStreams=i.max_streams,a.roomOptions.allowChat=i.allow_chat,a.roomOptions.allowAudio=i.allow_audio,a.roomOptions.allowSpeak=i.allow_speak,a.roomOptions.videoMode=i.video_mode,a.roomOptions.template=i.template,t.emit("login_success",i),"function"==typeof t.ChoicePhoneInit&&t.ChoicePhoneInit(i),"function"==typeof t.roomUpdateWatcher&&t.roomUpdateWatcher(),n.conference.setIceServers([{urls:"stun:turn-cc2.csslcloud.net:80"},{urls:["turn:turn-cc2.csslcloud.net:80?transport=udp","turn:turn-cc2.csslcloud.net:443?transport=udp","turn:turn-cc2.csslcloud.net:80?transport=tcp","turn:turn-cc2.csslcloud.net:443?transport=tcp"],username:"class",credential:"class_2017"}]),t.AtlasJoin(o),t.join_timeout=setTimeout(function(){t.emit("join_timeOut")},1e4)},fail:function(e){t.emit("login_failed","网络请求失败"),console.log("login_failed",e)}})}},t.prototype.AtlasJoin=function(e){n.AtlasJoin(this,e)},t.prototype.createLocalStream=function(e){n.createLocalStream(this,e)},t.prototype.leave=function(){n.leave(this)},t.prototype.detectExtension=function(e){n.detectExtension(e,this)},t.prototype.publishShareStream=function(e){var t=this;this.jsonp({url:"https://"+main_url+"/api/live/stat",callbackName:"callback",time:"30000",data:{roomid:t.roomid},success:function(i){"OK"===i.result?!0===i.started?n.publishShareStream(t,e):(console.log("直播未开始"),"function"===e.fail&&e.fail("直播未开始")):("function"===e.fail&&e.fail(i.errorMsg),console.log(i.errorMsg))},error:function(){console.log("查询直播状态失败，导致没有推桌面共享流"),"function"===e.fail&&e.fail("查询直播状态失败，导致没有推桌面共享流")}})},t.prototype.unPubShareStream=function(){n.unPubShareStream()},t.prototype.publish=function(e){var t=this;this.jsonp({url:"https://"+main_url+"/api/live/stat",callbackName:"callback",time:"30000",data:{roomid:t.roomid},success:function(i){"OK"===i.result?!0===i.started?n.publishLocalStream(t,e):(console.log("直播未开始，不能推流"),"function"==typeof e.fail&&e.fail("直播未开始，不能推流")):(console.log(i.errorMsg),"function"==typeof e.fail&&e.fail(i.errorMsg))},error:function(){console.log("查询直播状态失败，导致没有推流"),"function"==typeof e.fail&&e.fail("查询直播状态失败，导致没有推流"),t.emit("local_stream_publish_failed","推流查询直播状态失败，导致没有推流")}})},t.prototype.unPublish=function(e){n.unPublish(this,e)},t.prototype.trySubscribeStream=function(e){n.trySubscribeStream(this,e)},t.prototype.unSubscribeStream=function(e){n.unSubscribeStream(this,e)},t.prototype.pauseVideo=function(e){n.pauseVideo(e)},t.prototype.playVideo=function(e){n.playVideo(e)},t.prototype.pauseAudio=function(e){n.pauseAudio(e)},t.prototype.playAudio=function(e){n.playAudio(e)},t.prototype.addExternalOutput=function(e){n.addExternalOutput(this,e)},t.prototype.removeExternal=function(e){n.removeExternal(this,e)},t.prototype.updateExternalOutput=function(e){n.updateExternalOutput(e)},t.prototype.setRegion=function(e){n.setRegion(e)},t.prototype.getRegion=function(e){n.getRegion(e)},t.prototype.mix=function(e){n.mix(e)},t.prototype.unMix=function(e){n.unMix(e)},t.prototype.closeRemoteStreams=function(){n.closeRemoteStreams()},t.prototype.closeVideo=function(e){n.closeVideo(e)},t.prototype.getConnectionStats=function(e){n.getConnectionStats(e)},t.prototype.startRecorder=function(e){n.startRecorder(e)},t.prototype.stopRecorder=function(e){n.stopRecorder(e)},t.prototype.publishStreamAdd=function(e){i.publishStreamAdd(this,e)},t.prototype.unPublishStreamRemoved=function(e,t){i.unPublishStreamRemoved(this,e,t)},t.prototype.streamSubscribe=function(e){i.streamSubscribe(this,e)},t.prototype.unStreamSubscribe=function(e){i.unStreamSubscribe(this,e)},t.prototype.getLiveStat=function(e){i.getLiveStat(this,e)},t.prototype.startLive=function(e){i.startLive(this,e)},t.prototype.stopLive=function(e){i.stopLive(this,e)},t.prototype.streamBreak=function(){i.streamBreak(this)},t.prototype.getNetPoint=function(e){i.getNetPoint(this,e)},t.prototype.getDevice=function(e){o.getDevice(e)},t.prototype.getHistory=function(e){i.getHistory(this,e)},t.prototype.socket_disconnect=function(){r.socket_disconnect()},t.prototype.socket_init=function(){r.init(this)},t.prototype.sendMsg=function(e){r.send(e)},t.prototype.sendImg=function(e){r.media(e)},t.prototype.moveInBlacklist=function(e,t){r.moveInBlacklist(e,t)},t.prototype.moveOutFromAllList=function(e,t){r.moveOutFromAllList(e,t)},t.prototype.kickOut=function(e,t){r.kickOut(e,t)},t.prototype.silenceChat=function(){r.silenceChat()},t.prototype.unSilenceChat=function(){r.unSilenceChat()},t.prototype.flip=function(e){r.flip(e,this)},t.prototype.do_animation=function(e){r.do_animation(e,this)},t.prototype.draw=function(e,t,n){r.draw(e,t,n,this)},t.prototype.videoDraw=function(e,t){r.videoDraw(e,t,this)},t.prototype.startRollcall=function(e,t){r.startRollcall(e,t,this)},t.prototype.answerRollcall=function(e,t){r.answerRollcall(e,t,this)},t.prototype.switchUserSetting=function(e,t,n,i){r.switchUserSetting(e,t,n,i)},t.prototype.warnDown=function(e){r.warnDown(e)},t.prototype.mediaPlayer=function(e){r.mediaPlayer(e)},t.prototype.sendPublishMessage=function(e){r.sendPublishMessage(e)},t.prototype.sendCard=function(e,t,n,i){r.sendCard(e,t,n,i)},t.prototype.stopAnswer=function(e){r.stopAnswer(e)},t.prototype.sendAnswer=function(e,t,n,i){r.sendAnswer(e,t,n,i)},t.prototype.send_card_result=function(e){r.send_card_result(e)};var n={conference:Woogeen.ConferenceClient.create({}),localStreams:{},share_stream_pub:null,add_timer:null,connect:0,mixStream:"",reconnect:!1,AtlasJoin:function(e,t){var i=this;n.conference.join(t,function(t){clearTimeout(e.join_timeout);var r=t.streams;n.connect=1,r.map(function(t){a.streams.push(t),a.allow_streams.push(t),t instanceof Woogeen.RemoteMixedStream&&(i.mixStream=t),e.emit("allow_sub",t),a.allow_streams.push(t)}),e.emit("conference_join",r),console.log("conference_join",r)},function(t){clearTimeout(e.join_timeout),e.emit("conference_join_failed",t),console.log("conference_join_failed",t)})},init:function(e){var t=this;this.conference.on("stream-added",function(n){var i=n.stream,r=!1;if(i instanceof Woogeen.RemoteMixedStream&&(t.mixStream=i),!i.isScreen()){for(var o in t.conference.localStreams)if(t.conference.localStreams.hasOwnProperty(o)&&t.conference.localStreams[o].id()===i.id()){r=!0;break}if(r)return}if(a.streams.push(i),i.isScreen())return e.emit("allow_sub",i),void a.allow_streams.push(i);"function"==typeof t.ChoicePhoneInit?e.emit("stream_added",i):(e.emit("allow_sub",i),a.allow_streams.push(i))}),this.conference.on("stream-removed",function(t){var n=t.stream;if(void 0!==n){var i=n.attr("userid"),r=n.id();console.log("stream_removed",n),e.unPublishStreamRemoved(i,r)}if(n.attr("userid")!==e.viewerid||n.isScreen()){a.remove_streams.push(n.id());for(var o=0;o<a.streams.length;o++)a.streams[o].id()===n.id()&&a.streams.splice(o,1);for(var s=0;s<a.allow_streams.length;s++)a.allow_streams[s].id()===n.id()&&a.allow_streams.splice(s,1);for(var c=0;c<a.has_sub_streams.length;c++)a.has_sub_streams[c].id()===n.id()&&e.emit("unSub",n);e.emit("stream_removed",n)}else e.emit("stream_removed",n)}),this.conference.on("server-disconnected",function(n){t.connect=0,e.emit("server_disconnected"),console.log("server_disconnected",n)}),this.conference.on("stream-failed",function(t){e.emit("stream_failed"),console.log("stream_failed",t)})},leave:function(){this.conference.leave()},isHasLocalStream:function(e,t){var n=this;return"main"!==e.streamName&&"assist"!==e.streamName&&"picture"!==e.streamName?(e&&"function"==typeof e.fail&&e.fail("streamName为不合法的值"),console.log(t,"streamName为不合法的值"),!1):!(!n.localStreams[e.streamName]||n.localStreams[e.streamName].attr("streamName")!==e.streamName)||(e&&"function"==typeof e.fail&&e.fail("streamName为"+e.streamName+"的本地流不存在"),console.log(t,"streamName为"+e.streamName+"的本地流不存在"),!1)},setRegion:function(e){var t=e.regionObj;this.conference.setRegion(t,function(){L.Logger.info("setRegion succeeded"),e&&"function"==typeof e.success&&e.success("setRegion succeeded")},function(t){L.Logger.error("setRegion failed:",t),e&&"function"==typeof e.fail&&e.fail("setRegion failed:"+t)})},getRegion:function(e){var t=e.regionObj;this.conference.getRegion(t,function(t){L.Logger.info("Region for streamId: ",t.region),e&&"function"==typeof e.success&&e.success(t.region)},function(t){L.Logger.error("getRegion failed:",t),e&&"function"==typeof e.fail&&e.fail(t)})},createLocalStream:function(e,t){var n=this;if("main"!==t.streamName&&"assist"!==t.streamName&&"picture"!==t.streamName)return t&&"function"==typeof t.fail&&t.fail("streamName为不合法的值"),void console.log("创建本地流失败","streamName为不合法的值");if("doing"===n.localStreams[t.streamName])return"function"==typeof t.fail&&t.fail("streamName为"+t.streamName+"的本地流正在创建中，不要重复创建"),void console.log("创建本地流失败","streamName为"+t.streamName+"的本地流正在创建中，不要重复创建");if(n.localStreams[t.streamName]&&n.localStreams[t.streamName].attr("streamName")===t.streamName)return"function"==typeof t.fail&&t.fail("streamName为"+t.streamName+"的本地流已存在"),void console.log("创建本地流失败","streamName为"+t.streamName+"的本地流已存在");n.localStreams[t.streamName]="doing";var i=window.localStorage,r=i.getItem("video_device_id"),o=i.getItem("audio_device_id"),a=i.getItem("video_device_resolution"),s=null;if(t.createData)s=t.createData;else{var c={device:"camera",resolution:a||"hd720p",frameRate:15},d=!0;r&&(c.deviceId=r),o&&(d=d.deviceId=o),s={video:c,audio:d}}console.log(s,"sdk创建本地流音视频对象"),Woogeen.LocalStream.create(s,function(i,r){if(i)return n.localStreams[t.streamName]=null,t&&"function"==typeof t.fail&&t.fail(i),void e.emit("local_stream_create_failed",i);r.attr("userid",e.viewerid),r.attr("streamName",t.streamName),!1!==s.video?r.attr("video","true"):r.attr("video","false"),!1!==s.audio?r.attr("audio","true"):r.attr("audio","false"),n.localStreams[t.streamName]=r,t&&"function"==typeof t.success&&t.success(r)})},publishLocalStream:function(e,t){if(this.isHasLocalStream(t,"推流失败")){var n=this.localStreams[t.streamName],r={},o="timer"+(new Date).valueOf();r[o]=setTimeout(function(){console.log("推送本地流无回调"),e.emit("local_stream_publish_failed","推流无回调"),t&&"function"==typeof t.fail&&t.fail("推流无回调")},1e4),t.audioRate||(t.audioRate=50),t.videoRate||(t.videoRate=200);var a={videoCodec:"h264",maxVideoBW:t.videoRate,maxAudioBW:t.audioRate};this.conference.publish(n,a,function(n){clearTimeout(r[o]),t&&"function"==typeof t.success&&t.success(n),i.publishStreamAdd(e,n,t.videoRate,t.audioRate)},function(n){clearTimeout(r[o]),t&&"function"==typeof t.fail&&t.fail(n),console.log("推流失败",n),e.emit("local_stream_publish_failed",n)})}},unPublish:function(e,t){if(this.isHasLocalStream(t,"停止推流失败")){var n=this.localStreams[t.streamName],r=n.attr("userid"),o=n.id();this.conference.unpublish(n,function(){t&&"function"==typeof t.success&&t.success(o),i.unPublishStreamRemoved(e,r,o)},function(e){t&&"function"==typeof t.fail&&t.fail(e),console.log("停止推流失败",e)})}},addExternalOutput:function(e,t){var n=this;if(t&&t.url)var i=t.url;i||(i=e.extUrl?e.extUrl+e.roomid:"rtmp://push-cc1.csslcloud.net/origin/"+e.roomid),n.add_timer=setTimeout(function(){t&&"function"==typeof t.fail&&t.fail("cdn推流无回调"),L.Logger.error("cdn推流无回调")},1e4),L.Logger.info("External OutPut: "+i);var r=t.streamId;r?this.conference.addExternalOutput(i,{streamId:r},function(){clearTimeout(n.add_timer),L.Logger.info("started external streaming"),t&&"function"==typeof t.success&&t.success("started external streaming")},function(e){clearTimeout(n.add_timer),L.Logger.error("Start external streaming failed:",e,i),t&&"function"==typeof t.fail&&t.fail("Start external streaming failed:"+e+i)}):this.conference.addExternalOutput(i,function(){clearTimeout(n.add_timer),L.Logger.info("started external streaming"),t&&"function"==typeof t.success&&t.success("started external streaming")},function(e){clearTimeout(n.add_timer),L.Logger.error("Start external streaming failed:",e,i),t&&"function"==typeof t.fail&&t.fail("Start external streaming failed:"+e+i)})},removeExternal:function(e,t){if(t&&t.url)var n=t.url;n||(n=e.extUrl?e.extUrl+e.roomid:"rtmp://push-cc1.csslcloud.net/origin/"+e.roomid),this.conference.removeExternalOutput(n,function(){L.Logger.info("Stop external streaming success."),t&&"function"==typeof t.success&&t.success("Stop external streaming success.")},function(e){L.Logger.error("Stop external streaming failed:",e),t&&"function"==typeof t.fail&&t.fail(e)})},updateExternalOutput:function(e){this.conference.updateExternalOutput(e.url,function(){L.Logger.info("Update external streaming success"),e&&"function"==typeof e.success&&e.success("Update external streaming success")},function(t){L.Logger.error("Update external streaming failed:",t),e&&"function"==typeof e.fail&&e.fail("Update external streaming failed:"+t)})},pauseVideo:function(e){this.isHasLocalStream(e,"关闭视频画面失败")&&(this.localStreams[e.streamName].disableVideo(),e&&"function"==typeof e.success&&e.success())},playVideo:function(e){this.isHasLocalStream(e,"开启视频画面失败")&&(this.localStreams[e.streamName].enableVideo(),e&&"function"==typeof e.success&&e.success())},pauseAudio:function(e){this.isHasLocalStream(e,"关闭音频失败")&&(this.localStreams[e.streamName].disableAudio(),e&&"function"==typeof e.success&&e.success())},playAudio:function(e){this.isHasLocalStream(e,"开启音频失败")&&(this.localStreams[e.streamName].enableAudio(),e&&"function"==typeof e.success&&e.success())},trySubscribeStream:function(e,t){for(var n=t.tryStream,r=0;r<a.remove_streams.length;r++)if(a.remove_streams[r]===n.id())return e.emit("stream_subscribed_failed","该流已被移除",n.id()),void(t&&"function"==typeof t.fail&&t.fail("该流已被移除"));for(var o=0;o<a.has_sub_streams.length;o++)if(a.has_sub_streams[o].id()===n.id())return e.emit("stream_subscribed_failed","该流已被订阅",n.id()),void(t&&"function"==typeof t.fail&&t.fail("该流在已订阅列表存在"));t.tryData?this.conference.subscribe(n,t.tryData,function(){t&&"function"==typeof t.success&&t.success(n),e.emit("stream_subscribed",n),a.has_sub_streams.push(n);for(var r=0;r<a.streams.length;r++)if(a.streams[r].id()===n.id()){a.streams.splice(r,1);break}i.streamSubscribe(e,n)},function(i){console.log("stream_subscribed_failed",i),e.emit("stream_subscribed_failed",i,n.id()),t&&"function"==typeof t.fail&&t.fail(i)}):this.conference.subscribe(n,function(){t&&"function"==typeof t.success&&t.success(n),e.emit("stream_subscribed",n),a.has_sub_streams.push(n);for(var r=0;r<a.streams.length;r++)if(a.streams[r].id()===n.id()){a.streams.splice(r,1);break}i.streamSubscribe(e,n)},function(i){console.log("stream_subscribed_failed",i,n.id()),e.emit("stream_subscribed_failed",i,n.id()),t&&"function"==typeof t.fail&&t.fail(i)})},unSubscribeStream:function(e,t){for(var n=t.unSubStream,r=!1,o=0;o<a.has_sub_streams.length;o++)if(a.has_sub_streams[o].id()===n.id()){r=!0;break}r?this.conference.unsubscribe(n,function(r){L.Logger.info("stream unsubscribed:",n.id());for(var o=0;o<a.has_sub_streams.length;o++)a.has_sub_streams[o].id()===n.id()&&a.has_sub_streams.splice(o,1);for(var s=!1,c=0;c<a.remove_streams.length;c++)if(a.remove_streams[c]===n.id()){s=!0;break}s||a.streams.push(n),e.emit("unsub_success",n.id()),console.log("取消订阅成功",n.id()),t&&"function"==typeof t.success&&t.success(n.id()),i.unStreamSubscribe(e,n)},function(e){L.Logger.error("unsubscribe failed:",e),t&&"function"==typeof t.fail&&t.fail(e)}):t&&"function"==typeof t.fail&&t.fail("已订阅列表不存在")},mix:function(e){var t=this,n=e.stream;this.conference.mix(n,[t.mixStream],function(){L.Logger.info("mix success"),e&&"function"==typeof e.success&&e.success("mix success")},function(t){L.Logger.error("mix failed:",t),e&&"function"==typeof e.fail&&e.fail("mix failed:"+t)})},unMix:function(e){var t=this,n=e.stream;this.conference.unmix(n,[t.mixStream],function(){L.Logger.info("unMix success"),e&&"function"==typeof e.success&&e.success("unMix success")},function(t){L.Logger.error("unMix failed:",t),e&&"function"==typeof e.fail&&e.fail("unMix failed:"+t)})},closeVideo:function(e){if(this.isHasLocalStream(e,"关闭本地流失败")){var t=this.localStreams[e.streamName];t.close(),t.channel&&"function"==typeof t.channel.close&&t.channel.close(),this.localStreams[e.streamName]=null,e&&"function"==typeof e.success&&e.success()}},closeRemoteStreams:function(){for(var e in this.conference.remoteStreams)if(this.conference.remoteStreams.hasOwnProperty(e)){var t=this.conference.remoteStreams[e];t.close(),t.channel&&"function"==typeof t.channel.close&&t.channel.close(),delete this.conference.remoteStreams[e]}},detectExtension:function(e){var t,n;n="lafaooeojkcadiliheobbkkpkbnmdhgh",(t=new Image).src="chrome-extension://"+n+"/woogeen_icon_128.png",t.onload=function(){e&&"function"==typeof e.success&&e.success()},t.onerror=function(){e&&"function"==typeof e.fail&&e.fail()}},publishShareStream:function(e,t){var n=this;Woogeen.LocalStream.create({video:{device:"screen",resolution:"hd1080p",frameRate:15,extensionId:"lafaooeojkcadiliheobbkkpkbnmdhgh"},audio:!0},function(i,r){if(i)console.log("create share screen error ",i),t&&"function"==typeof t.fail&&t.fail(i);else{r.attr("userid",e.viewerid),r.attr("name",e.name),n.share_stream_pub=r,t.audioRate||(t.audioRate=50),t.videoRate||(t.videoRate=200);var o={videoCodec:"h264",maxVideoBW:t.videoRate,maxAudioBW:t.audioRate,transport:"tcp"};n.conference.publish(r,o,function(i){""!==n.mixStream&&setTimeout(function(){"presenter"===e.userRole&&n.mix({stream:i,success:function(e){console.log("共享桌面混流成功",e)},fail:function(e){console.log("共享桌面混流失败",e)}})},1e3),t&&"function"==typeof t.success&&t.success(i),console.log("share_stream_published",i)},function(){t&&"function"==typeof t.fail&&t.fail(i),console.log("share_stream_publish_failed",i)})}})},unPubShareStream:function(){var e=this;this.conference.unpublish(e.share_stream_pub,function(){e.share_stream_pub=null},function(t){e.share_stream_pub=null,console.log("取消桌面共享推流失败"+t)})},getConnectionStats:function(e){var t=e.stream;this.conference.getConnectionStats(t,function(t){e&&"function"==typeof e.success&&e.success(t)},function(t){e&&"function"==typeof e.fail&&e.fail(t)})},startRecorder:function(e){var t=this;this.conference.startRecorder({},function(n){console.log("开始记录成功",n),L.Logger.info("Stream recording with recorder ID: ",n.recorderId),t.record=n.recorderId,e&&"function"==typeof e.success&&e.success(n.recorderId)},function(t){console.log("开始记录失败"),L.Logger.error("Media recorder failed:",t),e&&"function"==typeof e.fail&&e.fail(t)})},stopRecorder:function(e){var t=this;this.conference.stopRecorder({recorderId:t.record},function(t){console.log("停止记录成功"),L.Logger.info("Stream recorded with recorder ID: ",t.recorderId),e&&"function"==typeof e.success&&e.success(t.recorderId)},function(t){console.log("停止记录失败"),L.Logger.error("Media recorder cannot stop with failure: ",t),e&&"function"==typeof e.fail&&e.fail(t)})}},i={publishStreamAdd:function(e,t,n,i){e.jsonp({url:"https://"+main_url+"/api/atlas/stream/added",callbackName:"callback",time:"30000",data:{roomid:e.roomid,userid:t.attr("userid"),streamid:t.id(),video_bitrate:n,audio_bitrate:i,time:(new Date).getTime()},success:function(e){"OK"===e.result?console.log("ccapi/stream/added","ok"):console.log("ccapi/stream/added",e.errorMsg)}})},unPublishStreamRemoved:function(e,t,n){e.jsonp({url:"https://"+main_url+"/api/atlas/stream/remove",callbackName:"callback",time:"30000",data:{roomid:e.roomid,userid:t,streamid:n,time:(new Date).getTime()},success:function(e){"OK"===e.result?console.log("ccapi/stream/remove","ok"):console.log("ccapi/stream/remove",e.errorMsg)}})},streamSubscribe:function(e,t){e.jsonp({url:"https://"+main_url+"/api/atlas/stream/subscribe",callbackName:"callback",time:"30000",data:{roomid:e.roomid,userid:e.viewerid,streamid:t.id(),time:(new Date).getTime()},success:function(e){"OK"===e.result?console.log("ccapi/stream/subscribe","ok"):console.log("ccapi/stream/subscribe",e.errorMsg)}})},unStreamSubscribe:function(e,t){e.jsonp({url:"https://"+main_url+"/api/atlas/stream/unsubscribe",callbackName:"callback",time:"30000",data:{roomid:e.roomid,userid:e.viewerid,streamid:t.id(),time:(new Date).getTime()},success:function(e){"OK"===e.result?console.log("ccapi/stream/unsubscribe","ok"):console.log("ccapi/stream/unsubscribe",e.errorMsg)}})},getLiveStat:function(e,t){e.jsonp({url:"https://"+main_url+"/api/live/stat",callbackName:"callback",time:"30000",data:{roomid:e.roomid},success:function(e){"OK"===e.result?!0===e.started?(t&&"function"==typeof t.success&&t.success(!0,e),console.log("直播开始状态",e)):(t&&"function"==typeof t.fail&&t.fail("直播关闭状态"),console.log("直播关闭状态",e)):(t&&"function"==typeof t.fail&&t.fail(e.errorMsg),console.log("查询直播出错",e.errorMsg))}})},startLive:function(e,t){e.jsonp({url:"https://"+main_url+"/api/live/start",callbackName:"callback",time:"30000",data:{roomid:e.roomid,userid:e.userid},beforeSend:function(){e.emit("live_before_send")},success:function(n){"OK"===n.result?(e.emit("live_start",n),t&&"function"==typeof t.success&&t.success(n),console.log("成功开始直播")):(e.emit("live_start_err"),t&&"function"==typeof t.fail&&t.fail("开始直播调用失败"),console.log("发送开始直播事件失败"))}})},stopLive:function(e,t){e.jsonp({url:"https://"+main_url+"/api/live/stop",callbackName:"callback",time:"30000",data:{roomid:e.roomid,userid:e.userid,loginid:e.viewerid},success:function(n){"OK"===n.result?(e.emit("end_live"),t&&"function"==typeof t.success&&t.success("结束直播调用成功"),console.log("成功发送结束直播事件")):(e.emit("end_live_err"),t&&"function"==typeof t.fail&&callback(!1,"结束直播调用失败"),console.log("发送结束直播事件失败"))}})},streamBreak:function(e){e.jsonp({url:"https://"+main_url+"/api/atlas/stream/break",callbackName:"callback",time:"30000",data:{roomid:e.roomid,userid:e.viewerid},success:function(e){e.result,console.log("通知api")}})},getNetPoint:function(e,t){e.jsonp({url:"https://"+main_url+"/api/dispatch",callbackName:"callback",time:"30000",data:{},success:function(e){"OK"===e.result?t&&"function"==typeof t.success&&t.success(e.data):t&&"function"==typeof t.fail&&t.fail(e)}})},getHistory:function(e,t){e.jsonp({url:"https://view.csslcloud.net/api/view/info",callbackName:"callback",time:"30000",data:{roomid:e.roomid,userid:e.userid},success:function(n){n.startLiveTime=e.startTime,n.success?(t&&"function"==typeof t.success&&t.success(n),e.emit("get_history",n)):(t&&"function"==typeof t.fail&&t.fail("初始化文档失败:"+n.msg),console.log("初始化文档失败:"+n.msg))}})}},r={things_arr:["chat_message","media_chat","page_change","draw","room_user_count","room_user_list","switch_settings","silence_user_chat_message","recover_user_chat_message","switch_user_settings","start_rollcall","answer_rollcall","rollcall_list","room_timer","start_vote","stop_vote","reply_vote","vote_result","speak_lock","speak_rotate","device_fail","animation_change"],user:!1,init:function(e){var t=this;this.socket=io.connect(e.socket_address+"/"+e.roomid,{query:"sessionid="+e.sessionid,secure:!0}),new SocketSentinel(this.socket,e.socket_spare_address+"/"+e.roomid),this.socket.on("reconnect",function(t){console.log("成功重连"),e.emit("reconnect_user",t)}),this.socket.on("reconnecting",function(t){console.log("正在重连"),e.emit("reconnecting_user",t)}),this.socket.on("disconnect",function(t){console.log("断开连接"),e.emit("disconnect_user",t)}),this.socket.on("connect",function(t){console.log("连接成功"),e.emit("connect_user",t)}),this.socket.on("warn_teacher_selfdown",function(t){e.emit("warn_down",t)}),this.socket.on("kick_out",function(t){n.leave(),this.emit("disconnect"),e.emit("kick_out",t)}),this.socket.on("router",function(t){var n=JSON.parse(t);"avMedia"===n.action?"audioMedia"===n.type?e.emit("audio_player",n):"videoMedia"===n.type&&e.emit("video_player",n):"video_scale"===n.action&&e.emit("video_scale",n),"lock_screen"===n.type?"lock_screen_open"===n.action?e.emit("lock_screen_open",n):"lock_screen_close"===n.action&&e.emit("lock_screen_close",n):"republish"===n.type?e.emit("republish",n):"brainstom"===n.type?"send_brainstom"===n.action?e.emit("presenter_brainstom",n):"reply_brainstom"===n.action?e.emit("talker_brainstom",n):"end_brainstom"===n.action&&e.emit("end_brainstom",n):"vote"===n.type?"send_vote"===n.action?e.emit("presenter_vote",n):"reply_vote"===n.action?e.emit("talker_vote",n):"end_vote"===n.action&&e.emit("end_vote",n):"publish_message"===n.type&&"publish_message"===n.action&&e.emit("publish_message",n.data)}),this.socket.on("room_context",function(t){a.roomContext(t,e),e.emit("room_context",t)}),this.socket.on("speak_context",function(t){a.speakContext(t,e),e.emit("speak_context",t)}),this.socket.on("publish_stream",function(t){e.startTime=(new Date).getTime(),e.emit("publish_stream",t)}),this.socket.on("end_stream",function(t){e.startTime=0,e.emit("end_stream",t)});for(var i=0;i<this.things_arr.length;i++)!function(n){t.socket.on(n,function(t){e.emit(n,t)})}(this.things_arr[i]);setTimeout(function(){try{r.socket.emit("room_user_count")}catch(e){}},1500),setInterval(function(){try{r.socket.emit("room_user_count")}catch(e){}},3e3)},socket_disconnect:function(){this.socket.disconnect()},send:function(e){return""!==e?(this.socket.emit("chat_message",e),!0):(console.log("msg is null"),!1)},media:function(e){return""!==e?(this.socket.emit("media_chat",e),!0):(console.log("msg is null"),!1)},flip:function(e,t){var n=t.startTime,i=Math.floor(((new Date).getTime()-n)/1e3),r={action:"page_change",value:{fileName:e.n,docid:e.id,totalPage:e.t,url:e.u,page:e.p,useSDK:e.useSDK,mode:e.mode,width:e.w,height:e.h,pageTitle:""+e.r,userid:t.viewerid},time:i};this.socket.emit("page_change",JSON.stringify(r))},do_animation:function(e,t){var n=t.startTime,i=Math.floor(((new Date).getTime()-n)/1e3),r={action:"animation_change",value:{docid:e.id,step:e.s,page:e.n},time:i};this.socket.emit("animation_change",JSON.stringify(r))},draw:function(e,t,n,i){var r=i.startTime,o={action:"draw",value:{fileName:e,page:t,data:n},time:Math.floor(((new Date).getTime()-r)/1e3)};this.socket.emit("draw",JSON.stringify(o))},videoDraw:function(e,t,n){var i=n.startTime,r={action:"draw",value:{value_type:"video_draw",fileName:e,page:-1,data:t},time:Math.floor(((new Date).getTime()-i)/1e3)};this.socket.emit("draw",JSON.stringify(r))},startRollcall:function(e,t,n){var i={rollcallId:t,publisherId:n.viewerid,duration:e};this.socket.emit("start_rollcall",JSON.stringify(i))},answerRollcall:function(e,t,n){var i={rollcallId:e,userId:n.viewerid,userName:n.name,publisherId:t};this.socket.emit("answer_rollcall",JSON.stringify(i))},moveInBlacklist:function(e,t){var n=void 0;try{if(!e)throw"输入操作用户的ID";var i={userId:e};this.socket.emit("blacklist_user",JSON.stringify(i))}catch(e){n=e}finally{"function"==typeof t&&t(n)}},moveOutFromAllList:function(e,t){var n=void 0;try{if(!e)throw"输入操作用户的ID";var i={userId:e};this.socket.emit("remove_list",JSON.stringify(i))}catch(e){n=e}finally{"function"==typeof t&&t(n)}},silenceChat:function(e){var t=void 0;try{this.socket.emit("silence_room_chat")}catch(e){t=e}finally{"function"==typeof e&&e(t)}},unSilenceChat:function(e){var t=void 0;try{this.socket.emit("recover_silence_room_chat")}catch(e){t=e}finally{"function"==typeof e&&e(t)}},switchUserSetting:function(e,t,n,i){var r={changed:e,userId:t,value:n,role:i};this.socket.emit("switch_user_settings",JSON.stringify(r))},kickOut:function(e,t){var n=void 0;try{if(!e)throw"参数错误";var i={userId:e};this.socket.emit("kick_out",JSON.stringify(i))}catch(e){n=e}finally{"function"==typeof t&&t(n)}},warnDown:function(e){var t={teacherId:e};this.socket.emit("warn_teacher_selfdown",JSON.stringify(t))},mediaPlayer:function(e){this.socket.emit("router",JSON.stringify(e))},sendPublishMessage:function(e){var t={type:"publish_message",action:"publish_message",data:e};this.socket.emit("router",JSON.stringify(t))},sendCard:function(e,t,n,i){var r={publisherId:e,voteCount:t,voteId:n,voteType:i};this.socket.emit("start_vote",JSON.stringify(r))},stopAnswer:function(e){var t={voteId:e};this.socket.emit("stop_vote",JSON.stringify(t))},sendAnswer:function(e,t,n,i){var r={voteId:e,voteOption:t,publisherId:n,userName:i};this.socket.emit("reply_vote",JSON.stringify(r))},send_card_result:function(e){this.socket.emit("vote_result",JSON.stringify(e))}},o={getDevice:function(e){navigator.mediaDevices.enumerateDevices().then(function(t){if(t.length>0){console.log(t);var n={};n.video=[],n.audio=[];for(var i in t){var r=t[i];"videoinput"===r.kind&&n.video.push(r),"audioinput"===r.kind&&n.audio.push(r)}e&&"function"==typeof e.success&&e.success(n)}else e&&"function"==typeof e.fail&&e.fail("没有获取到设备")})}},a={streams:[],allow_streams:[],has_sub_streams:[],remove_streams:[],onlineUsers:[],userSettings:[],roomOptions:{},time:0,comPareArr:function(e,t){for(var n=[],i=0;i<e.length;i++){for(var r=!1,o=0;o<t.length;o++)if(e[i].id===t[o].id){r=!0;break}r||n.push(e[i])}return n},roomContext:function(e,t){var n=JSON.parse(e),i=n.onlineUsers,r=n.time;if(this.userSettings=n.userSettings,console.log("room_context",n),!(this.time>r)){this.time=r;var o=i,s=a.onlineUsers;if(0!==o.length&&0!==s.length){var c=a.comPareArr(o,s),d=a.comPareArr(s,o);console.log(c,d);for(u=0;u<c.length;u++)(l={}).id=c[u].id,l.name=c[u].name,t.emit("join_room_user",l);for(var u=0;u<d.length;u++){var l={};l.id=d[u].id,l.name=d[u].name,t.emit("exit_room_user",l)}}this.onlineUsers=i,t.emit("online_users",i)}},speakContext:function(e,t){var n=JSON.parse(e),i=n.down_by,r=n.onlineUsers;this.time=n.time,console.log("speak_context",n),i&&t.emit("teacher_down_by",i),this.onlineUsers=r,t.emit("online_users",r)}};window.Rtc=t,window.Speaker=a}(window);